<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A programming framework for agentic AI"><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://docs.ag2.ai/latest/docs/user-guide/basic-concepts/structured-outputs/ rel=canonical><link href=../introducing-tools/ rel=prev><link href=../../advanced-concepts/llm-configuration-deep-dive/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>Structured Outputs: Ensuring Consistent Responses - AG2</title><link rel=stylesheet href=../../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../css/timeago.css><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../stylesheets/extra.ff0633.min.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - Structured Outputs: Ensuring Consistent Responses"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://docs.ag2.ai/latest/docs/user-guide/basic-concepts/structured-outputs/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - Structured Outputs: Ensuring Consistent Responses"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon-dark.svg type=image/x-icon media="(prefers-color-scheme: light)"><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon media="(prefers-color-scheme: dark)"><link href=../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#the-need-for-structured-outputs class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Structured Outputs: Ensuring Consistent Responses </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../quick-start/ class=md-tabs__link> Quick Start </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../api-reference/autogen/Agent/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> <li class=md-tabs__item> <a href=../../../use-cases/use-cases/customer-service/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-tabs__link> Community Insights </a> </li> <li class=md-tabs__item> <a href=../../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../installing-ag2/ class=md-nav__link> <span class=md-ellipsis> Installing AG2 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Basic Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Basic Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../llm-configuration/ class=md-nav__link> <span class=md-ellipsis> LLM Configuration: Powering Agent Intelligence </span> </a> </li> <li class=md-nav__item> <a href=../conversable-agent/ class=md-nav__link> <span class=md-ellipsis> ConversableAgent: Building Intelligent Agents </span> </a> </li> <li class=md-nav__item> <a href=../human-in-the-loop/ class=md-nav__link> <span class=md-ellipsis> Human in the Loop: Adding Human Oversight </span> </a> </li> <li class=md-nav__item> <a href=../introducing-group-chat/ class=md-nav__link> <span class=md-ellipsis> Agent Orchestration: Coordinating Multiple Agents </span> </a> </li> <li class=md-nav__item> <a href=../introducing-tools/ class=md-nav__link> <span class=md-ellipsis> Tools: Extending Agent Capabilities </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Structured Outputs: Ensuring Consistent Responses </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Structured Outputs: Ensuring Consistent Responses </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#the-need-for-structured-outputs class=md-nav__link> <span class=md-ellipsis> The Need for Structured Outputs </span> </a> </li> <li class=md-nav__item> <a href=#from-concept-to-implementation class=md-nav__link> <span class=md-ellipsis> From Concept to Implementation </span> </a> </li> <li class=md-nav__item> <a href=#enhancing-our-financial-compliance-system-with-structured-outputs class=md-nav__link> <span class=md-ellipsis> Enhancing Our Financial Compliance System with Structured Outputs </span> </a> <nav class=md-nav aria-label="Enhancing Our Financial Compliance System with Structured Outputs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defining-the-structured-output-model class=md-nav__link> <span class=md-ellipsis> Defining the Structured Output Model </span> </a> </li> <li class=md-nav__item> <a href=#creating-the-summary-agent-with-structured-output class=md-nav__link> <span class=md-ellipsis> Creating the Summary Agent with Structured Output </span> </a> </li> <li class=md-nav__item> <a href=#updating-the-termination-condition class=md-nav__link> <span class=md-ellipsis> Updating the Termination Condition </span> </a> </li> <li class=md-nav__item> <a href=#using-the-structured-output class=md-nav__link> <span class=md-ellipsis> Using the Structured Output </span> </a> </li> <li class=md-nav__item> <a href=#understanding-the-enhanced-workflow class=md-nav__link> <span class=md-ellipsis> Understanding the Enhanced Workflow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#complete-code-example class=md-nav__link> <span class=md-ellipsis> Complete Code Example </span> </a> </li> <li class=md-nav__item> <a href=#example-output class=md-nav__link> <span class=md-ellipsis> Example Output </span> </a> </li> <li class=md-nav__item> <a href=#key-benefits-of-structured-outputs class=md-nav__link> <span class=md-ellipsis> Key Benefits of Structured Outputs </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../advanced-concepts/llm-configuration-deep-dive/ class=md-nav__link> <span class=md-ellipsis> Advanced Concepts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../models/amazon-bedrock/ class=md-nav__link> <span class=md-ellipsis> Model Providers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../reference-agents/ class=md-nav__link> <span class=md-ellipsis> Reference Agents </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../reference-tools/ class=md-nav__link> <span class=md-ellipsis> Reference Tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../faq/FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api-reference/autogen/Agent/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../use-cases/use-cases/customer-service/ class=md-nav__link> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-nav__link> <span class=md-ellipsis> Community Insights </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#the-need-for-structured-outputs class=md-nav__link> <span class=md-ellipsis> The Need for Structured Outputs </span> </a> </li> <li class=md-nav__item> <a href=#from-concept-to-implementation class=md-nav__link> <span class=md-ellipsis> From Concept to Implementation </span> </a> </li> <li class=md-nav__item> <a href=#enhancing-our-financial-compliance-system-with-structured-outputs class=md-nav__link> <span class=md-ellipsis> Enhancing Our Financial Compliance System with Structured Outputs </span> </a> <nav class=md-nav aria-label="Enhancing Our Financial Compliance System with Structured Outputs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defining-the-structured-output-model class=md-nav__link> <span class=md-ellipsis> Defining the Structured Output Model </span> </a> </li> <li class=md-nav__item> <a href=#creating-the-summary-agent-with-structured-output class=md-nav__link> <span class=md-ellipsis> Creating the Summary Agent with Structured Output </span> </a> </li> <li class=md-nav__item> <a href=#updating-the-termination-condition class=md-nav__link> <span class=md-ellipsis> Updating the Termination Condition </span> </a> </li> <li class=md-nav__item> <a href=#using-the-structured-output class=md-nav__link> <span class=md-ellipsis> Using the Structured Output </span> </a> </li> <li class=md-nav__item> <a href=#understanding-the-enhanced-workflow class=md-nav__link> <span class=md-ellipsis> Understanding the Enhanced Workflow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#complete-code-example class=md-nav__link> <span class=md-ellipsis> Complete Code Example </span> </a> </li> <li class=md-nav__item> <a href=#example-output class=md-nav__link> <span class=md-ellipsis> Example Output </span> </a> </li> <li class=md-nav__item> <a href=#key-benefits-of-structured-outputs class=md-nav__link> <span class=md-ellipsis> Key Benefits of Structured Outputs </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/edit/main/website/docs/user-guide/basic-concepts/structured-outputs.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg> </a> <h1>Structured Outputs: Ensuring Consistent Responses</h1> <p>In our financial compliance system, we've built a workflow that checks transactions, detects duplicates, and generates summary reports. Everything seems to be working well, but then we get a new requirement:</p> <p><em>The risk management team needs to integrate our transaction summary reports with their systems, and they need the data in a specific format.</em></p> <p>Our summary agent currently produces nice-looking reports, but the output format isn't guaranteed. The agent decides how to format the data based on its system message instructions. This inconsistency makes it impossible for the risk management system to reliably extract the data it needs.</p> <p>What we need is a way to ensure our summary bot always produces reports in exactly the same structured format, regardless of the specific transactions being processed.</p> <h2 id=the-need-for-structured-outputs>The Need for Structured Outputs<a class=headerlink href=#the-need-for-structured-outputs title="Permanent link">#</a></h2> <p>We're faced with a common challenge in AI systems: how do we get our agents to output information in a consistent, predictable format that other systems can understand?</p> <p>Think about it like this - our finance bot and summary bot are doing great work analyzing transactions, but if we want to connect them to other business systems, we need something more reliable than hoping they'll format data consistently each time.</p> <p>This is where structured outputs come in - they provide a way to define the exact structure your agent's responses should follow.</p> <p><strong>An Analogy for Structured Outputs:</strong></p> <p>Continuing our hospital emergency room analogy:</p> <ul> <li>Think of structured outputs like standardized medical forms used in the hospital</li> <li>Without standardized forms, each doctor might document patient information differently (freeform text)</li> <li>With standardized forms, all required fields must be completed and in the correct format</li> <li>Technicians know exactly where to find vitals, lab results, and medications without guessing</li> <li>Downstream systems (insurance, billing, pharmacy) can reliably process these forms</li> <li>The forms act as guardrails, ensuring all necessary information is captured and consistently structured</li> </ul> <p>Just as standardized medical forms ensure complete and consistent documentation across different healthcare providers, structured outputs ensure your agents produce responses in a predictable format that can be reliably processed by other systems.</p> <h2 id=from-concept-to-implementation>From Concept to Implementation<a class=headerlink href=#from-concept-to-implementation title="Permanent link">#</a></h2> <p>Implementing structured outputs in AG2 is straightforward using Pydantic models and the <a href=../../../api-reference/autogen/llm_config/LLMConfigEntry#autogen.llm_config.LLMConfigEntry.response_format><code>response_format</code></a> parameter:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Not all model providers support structured outputs. For a current list of supported providers, see <a href="https://docs.ag2.ai/latest/docs/use-cases/notebooks/notebooks/agentchat_structured_outputs/?h=structured#supported-model-providers">here</a>.</p> </div> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1># 1. Define your structured output model with Pydantic</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=hll><span class=k>class</span><span class=w> </span><span class=nc>ResponseModel</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=hll>    <span class=n>field1</span><span class=p>:</span> <span class=nb>str</span>
</span><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=hll>    <span class=n>field2</span><span class=p>:</span> <span class=nb>int</span>
</span><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=hll>    <span class=n>field3</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=c1># 2. Create LLM configuration with the structured output model</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=n>api_type</span><span class=o>=</span><span class=s2>&quot;openai&quot;</span><span class=p>,</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=hll>    <span class=n>response_format</span><span class=o>=</span><span class=n>ResponseModel</span><span class=p>,</span>  <span class=c1># Specify the response format</span>
</span><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=p>)</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=c1># 3. Create agent with structured output configuration</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=k>with</span> <span class=n>llm_config</span><span class=p>:</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>    <span class=n>structured_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;structured_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You provide information in a structured format.&quot;</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>    <span class=p>)</span>
</code></pre></div> <p>With this setup:</p> <ul> <li>The agent will always return responses that match the <code>ResponseModel</code> structure</li> <li>All required fields will be present and correctly typed</li> <li>You no longer need formatting instructions in the system message</li> <li>The responses can be easily parsed and processed by other systems</li> </ul> <h2 id=enhancing-our-financial-compliance-system-with-structured-outputs>Enhancing Our Financial Compliance System with Structured Outputs<a class=headerlink href=#enhancing-our-financial-compliance-system-with-structured-outputs title="Permanent link">#</a></h2> <p>Now, let's enhance our financial compliance system by adding structured outputs to our summary agent:</p> <h3 id=defining-the-structured-output-model>Defining the Structured Output Model<a class=headerlink href=#defining-the-structured-output-model title="Permanent link">#</a></h3> <p>First, let's define our structured output model for transaction audit logs:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1># Define structured output for audit logs</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=k>class</span><span class=w> </span><span class=nc>TransactionAuditEntry</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=n>vendor</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>    <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>    <span class=n>memo</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>    <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=k>class</span><span class=w> </span><span class=nc>AuditLogSummary</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>    <span class=n>total_transactions</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>    <span class=n>approved_count</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>    <span class=n>rejected_count</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>    <span class=n>transactions</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>TransactionAuditEntry</span><span class=p>]</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>    <span class=n>summary_generated_time</span><span class=p>:</span> <span class=nb>str</span>
</code></pre></div> <h3 id=creating-the-summary-agent-with-structured-output>Creating the Summary Agent with Structured Output<a class=headerlink href=#creating-the-summary-agent-with-structured-output title="Permanent link">#</a></h3> <p>Next, let's update our summary agent to use this structured output model:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Configure the LLM for summary bot with structured output</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>summary_llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=n>api_type</span><span class=o>=</span><span class=s2>&quot;openai&quot;</span><span class=p>,</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>    <span class=n>api_key</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>),</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>    <span class=n>temperature</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=hll>    <span class=n>response_format</span><span class=o>=</span><span class=n>AuditLogSummary</span><span class=p>,</span>  <span class=c1># Using our Pydantic model for structured output</span>
</span><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=p>)</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=c1># Define the system message for the summary agent</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=c1># Note: No formatting instructions needed!</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=hll><span class=n>summary_system_message</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
</span><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=hll><span class=s2>You are a financial summary assistant that generates audit logs.</span>
</span><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=hll><span class=s2>Analyze the transaction details and their approval status from the conversation.</span>
</span><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=hll><span class=s2>Include each transaction with its vendor, amount, memo, status and reason.</span>
</span><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=hll><span class=s2>&quot;&quot;&quot;</span>
</span><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=c1># Create the summary agent with structured output</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=k>with</span> <span class=n>summary_llm_config</span><span class=p>:</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>    <span class=n>summary_bot</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;summary_bot&quot;</span><span class=p>,</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>        <span class=n>system_message</span><span class=o>=</span><span class=n>summary_system_message</span><span class=p>,</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>    <span class=p>)</span>
</code></pre></div> <p>Notice how much simpler the system message is now - we no longer need to include detailed formatting instructions because the structure is enforced by the Pydantic model.</p> <h3 id=updating-the-termination-condition>Updating the Termination Condition<a class=headerlink href=#updating-the-termination-condition title="Permanent link">#</a></h3> <p>We'll also update our termination condition to recognize the structured output:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>def</span><span class=w> </span><span class=nf>is_termination_msg</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=n>content</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>        <span class=c1># Try to parse the content as JSON (structured output)</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>        <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>        <span class=k>return</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;summary_generated_time&quot;</span> <span class=ow>in</span> <span class=n>data</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>        <span class=c1># If not JSON, check for text marker (fallback)</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>        <span class=k>return</span> <span class=p>(</span><span class=n>content</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;==== SUMMARY GENERATED ====&quot;</span> <span class=ow>in</span> <span class=n>content</span>
</code></pre></div> <h3 id=using-the-structured-output>Using the Structured Output<a class=headerlink href=#using-the-structured-output title="Permanent link">#</a></h3> <p>After the Group Chat completes, we can easily get the final message and parse it as JSON. For example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>finance_bot</span><span class=p>,</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>finance_bot</span><span class=p>,</span> <span class=n>summary_bot</span><span class=p>],</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>human</span><span class=p>,</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=n>group_manager_args</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>        <span class=s2>&quot;llm_config&quot;</span><span class=p>:</span> <span class=n>finance_llm_config</span><span class=p>,</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>        <span class=s2>&quot;is_termination_msg&quot;</span><span class=p>:</span> <span class=n>is_termination_msg</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=p>},</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=p>)</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=n>result</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>initiate_group_chat</span><span class=p>(</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>    <span class=n>pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>    <span class=n>messages</span><span class=o>=</span><span class=n>initial_prompt</span><span class=p>,</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=p>)</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=hll><span class=n>final_message</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>chat_history</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>]</span>
</span><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=hll><span class=n>structured_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>final_message</span><span class=p>)</span>
</span><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=hll><span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>structured_data</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>))</span>
</span></code></pre></div> <h3 id=understanding-the-enhanced-workflow>Understanding the Enhanced Workflow<a class=headerlink href=#understanding-the-enhanced-workflow title="Permanent link">#</a></h3> <p>With structured outputs added to our financial compliance system, our workflow becomes much more reliable:</p> <pre class=mermaid><code>flowchart TD
    User([User]) --&gt; |"Submits transactions"| Finance[Finance Bot]
    Finance --&gt; |"Processes transactions"| Human[Human Agent]
    Human --&gt; |"Approves/rejects"| Finance
    Finance --&gt; |"Handoff"| Summary[Summary Bot with Structured Output]
    Summary --&gt; |"Generates structured audit log"| Output[["JSON in exact required format"]]
    Output --&gt; RiskSystem[Risk Management System]
    Output --&gt; Dashboard[Finance Dashboard]
    Output --&gt; Database[(Transaction Database)]

    style Finance fill:#e3f2fd,stroke:#1976d2
    style Human fill:#f3e5f5,stroke:#7b1fa2
    style Summary fill:#e8f5e9,stroke:#4caf50
    style Output fill:#fff8e1,stroke:#ffa000
    style RiskSystem fill:#e8f5e9,stroke:#4caf50
    style Dashboard fill:#e0f2f1,stroke:#009688
    style Database fill:#f3e5f5,stroke:#7b1fa2</code></pre> <h2 id=complete-code-example>Complete Code Example<a class=headerlink href=#complete-code-example title="Permanent link">#</a></h2> <p>Here's the complete, ready-to-run code for our financial compliance system with structured outputs:</p> <details class=info open=open> <summary>Complete Code Example</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=kn>import</span><span class=w> </span><span class=nn>random</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Annotated</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat</span><span class=w> </span><span class=kn>import</span> <span class=n>initiate_group_chat</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group.patterns</span><span class=w> </span><span class=kn>import</span> <span class=n>AutoPattern</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=c1># Mock database of previous transactions</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=k>def</span><span class=w> </span><span class=nf>get_previous_transactions</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    <span class=n>today</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>    <span class=k>return</span> <span class=p>[</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>        <span class=p>{</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>            <span class=s2>&quot;vendor&quot;</span><span class=p>:</span> <span class=s2>&quot;Staples&quot;</span><span class=p>,</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>            <span class=s2>&quot;amount&quot;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>            <span class=s2>&quot;date&quot;</span><span class=p>:</span> <span class=p>(</span><span class=n>today</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>3</span><span class=p>))</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2>&quot;</span><span class=p>),</span>  <span class=c1># 3 days ago</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>            <span class=s2>&quot;memo&quot;</span><span class=p>:</span> <span class=s2>&quot;Quarterly supplies&quot;</span><span class=p>,</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>        <span class=p>},</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>        <span class=p>{</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>            <span class=s2>&quot;vendor&quot;</span><span class=p>:</span> <span class=s2>&quot;Acme Corp&quot;</span><span class=p>,</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>            <span class=s2>&quot;amount&quot;</span><span class=p>:</span> <span class=mi>1500</span><span class=p>,</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>            <span class=s2>&quot;date&quot;</span><span class=p>:</span> <span class=p>(</span><span class=n>today</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>10</span><span class=p>))</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2>&quot;</span><span class=p>),</span>  <span class=c1># 10 days ago</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>            <span class=s2>&quot;memo&quot;</span><span class=p>:</span> <span class=s2>&quot;NDA services&quot;</span><span class=p>,</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>        <span class=p>},</span>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>        <span class=p>{</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>            <span class=s2>&quot;vendor&quot;</span><span class=p>:</span> <span class=s2>&quot;Globex&quot;</span><span class=p>,</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>            <span class=s2>&quot;amount&quot;</span><span class=p>:</span> <span class=mi>12000</span><span class=p>,</span>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>            <span class=s2>&quot;date&quot;</span><span class=p>:</span> <span class=p>(</span><span class=n>today</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>5</span><span class=p>))</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2>&quot;</span><span class=p>),</span>  <span class=c1># 5 days ago</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>            <span class=s2>&quot;memo&quot;</span><span class=p>:</span> <span class=s2>&quot;Confidential&quot;</span><span class=p>,</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>        <span class=p>},</span>
<a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>    <span class=p>]</span>
<a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>
<a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=c1># Simple duplicate detection function</span>
<a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=k>def</span><span class=w> </span><span class=nf>check_duplicate_payment</span><span class=p>(</span>
<a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>    <span class=n>vendor</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=s2>&quot;The vendor name&quot;</span><span class=p>],</span>
<a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>    <span class=n>amount</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=s2>&quot;The transaction amount&quot;</span><span class=p>],</span>
<a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>    <span class=n>memo</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=s2>&quot;The transaction memo&quot;</span><span class=p>]</span>
<a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if a transaction appears to be a duplicate of a recent payment&quot;&quot;&quot;</span>
<a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>    <span class=n>previous_transactions</span> <span class=o>=</span> <span class=n>get_previous_transactions</span><span class=p>()</span>
<a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a>
<a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>    <span class=n>today</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
<a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a>
<a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a>    <span class=k>for</span> <span class=n>tx</span> <span class=ow>in</span> <span class=n>previous_transactions</span><span class=p>:</span>
<a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a>        <span class=n>tx_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>tx</span><span class=p>[</span><span class=s2>&quot;date&quot;</span><span class=p>],</span> <span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a>        <span class=n>date_diff</span> <span class=o>=</span> <span class=p>(</span><span class=n>today</span> <span class=o>-</span> <span class=n>tx_date</span><span class=p>)</span><span class=o>.</span><span class=n>days</span>
<a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a>
<a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a>        <span class=c1># If vendor, memo and amount match, and transaction is within 7 days</span>
<a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a>        <span class=k>if</span> <span class=p>(</span>
<a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a>            <span class=n>tx</span><span class=p>[</span><span class=s2>&quot;vendor&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>vendor</span> <span class=ow>and</span>
<a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a>            <span class=n>tx</span><span class=p>[</span><span class=s2>&quot;memo&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>memo</span> <span class=ow>and</span>
<a id=__codelineno-5-55 name=__codelineno-5-55 href=#__codelineno-5-55></a>            <span class=n>tx</span><span class=p>[</span><span class=s2>&quot;amount&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>amount</span> <span class=ow>and</span>
<a id=__codelineno-5-56 name=__codelineno-5-56 href=#__codelineno-5-56></a>            <span class=n>date_diff</span> <span class=o>&lt;=</span> <span class=mi>7</span>
<a id=__codelineno-5-57 name=__codelineno-5-57 href=#__codelineno-5-57></a>        <span class=p>):</span>
<a id=__codelineno-5-58 name=__codelineno-5-58 href=#__codelineno-5-58></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-5-59 name=__codelineno-5-59 href=#__codelineno-5-59></a>                <span class=s2>&quot;is_duplicate&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-5-60 name=__codelineno-5-60 href=#__codelineno-5-60></a>                <span class=s2>&quot;reason&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Duplicate payment to </span><span class=si>{</span><span class=n>vendor</span><span class=si>}</span><span class=s2> for $</span><span class=si>{</span><span class=n>amount</span><span class=si>}</span><span class=s2> on </span><span class=si>{</span><span class=n>tx</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-5-61 name=__codelineno-5-61 href=#__codelineno-5-61></a>            <span class=p>}</span>
<a id=__codelineno-5-62 name=__codelineno-5-62 href=#__codelineno-5-62></a>
<a id=__codelineno-5-63 name=__codelineno-5-63 href=#__codelineno-5-63></a>    <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-5-64 name=__codelineno-5-64 href=#__codelineno-5-64></a>        <span class=s2>&quot;is_duplicate&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-5-65 name=__codelineno-5-65 href=#__codelineno-5-65></a>        <span class=s2>&quot;reason&quot;</span><span class=p>:</span> <span class=s2>&quot;No recent duplicates found&quot;</span>
<a id=__codelineno-5-66 name=__codelineno-5-66 href=#__codelineno-5-66></a>    <span class=p>}</span>
<a id=__codelineno-5-67 name=__codelineno-5-67 href=#__codelineno-5-67></a>
<a id=__codelineno-5-68 name=__codelineno-5-68 href=#__codelineno-5-68></a><span class=c1># Configure the LLM for finance bot (standard configuration)</span>
<a id=__codelineno-5-69 name=__codelineno-5-69 href=#__codelineno-5-69></a><span class=n>finance_llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-5-70 name=__codelineno-5-70 href=#__codelineno-5-70></a>    <span class=n>api_type</span><span class=o>=</span><span class=s2>&quot;openai&quot;</span><span class=p>,</span>
<a id=__codelineno-5-71 name=__codelineno-5-71 href=#__codelineno-5-71></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span>
<a id=__codelineno-5-72 name=__codelineno-5-72 href=#__codelineno-5-72></a>    <span class=n>api_key</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>),</span>
<a id=__codelineno-5-73 name=__codelineno-5-73 href=#__codelineno-5-73></a>    <span class=n>temperature</span><span class=o>=</span><span class=mf>0.2</span>
<a id=__codelineno-5-74 name=__codelineno-5-74 href=#__codelineno-5-74></a><span class=p>)</span>
<a id=__codelineno-5-75 name=__codelineno-5-75 href=#__codelineno-5-75></a>
<a id=__codelineno-5-76 name=__codelineno-5-76 href=#__codelineno-5-76></a><span class=c1># Define the system message for our finance bot</span>
<a id=__codelineno-5-77 name=__codelineno-5-77 href=#__codelineno-5-77></a><span class=n>finance_system_message</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-5-78 name=__codelineno-5-78 href=#__codelineno-5-78></a><span class=s2>You are a financial compliance assistant. You will be given a set of transaction descriptions.</span>
<a id=__codelineno-5-79 name=__codelineno-5-79 href=#__codelineno-5-79></a>
<a id=__codelineno-5-80 name=__codelineno-5-80 href=#__codelineno-5-80></a><span class=s2>For each transaction:</span>
<a id=__codelineno-5-81 name=__codelineno-5-81 href=#__codelineno-5-81></a><span class=s2>1. First, extract the vendor name, amount, and memo</span>
<a id=__codelineno-5-82 name=__codelineno-5-82 href=#__codelineno-5-82></a><span class=s2>2. Check if the transaction is a duplicate using the check_duplicate_payment tool</span>
<a id=__codelineno-5-83 name=__codelineno-5-83 href=#__codelineno-5-83></a><span class=s2>3. If the tool identifies a duplicate, automatically reject the transaction</span>
<a id=__codelineno-5-84 name=__codelineno-5-84 href=#__codelineno-5-84></a><span class=s2>4. If not a duplicate, continue with normal evaluation:</span>
<a id=__codelineno-5-85 name=__codelineno-5-85 href=#__codelineno-5-85></a><span class=s2>    - If it seems suspicious (e.g., amount &gt; $10,000, vendor is unusual, memo is vague), ask the human agent for approval</span>
<a id=__codelineno-5-86 name=__codelineno-5-86 href=#__codelineno-5-86></a><span class=s2>    - Otherwise, approve it automatically</span>
<a id=__codelineno-5-87 name=__codelineno-5-87 href=#__codelineno-5-87></a>
<a id=__codelineno-5-88 name=__codelineno-5-88 href=#__codelineno-5-88></a><span class=s2>Provide clear explanations for your decisions, especially for duplicates or suspicious transactions.</span>
<a id=__codelineno-5-89 name=__codelineno-5-89 href=#__codelineno-5-89></a><span class=s2>When all transactions are processed, summarize the results and say &quot;You can type exit to finish&quot;.</span>
<a id=__codelineno-5-90 name=__codelineno-5-90 href=#__codelineno-5-90></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-5-91 name=__codelineno-5-91 href=#__codelineno-5-91></a>
<a id=__codelineno-5-92 name=__codelineno-5-92 href=#__codelineno-5-92></a><span class=c1># Create the agents with respective LLM configurations</span>
<a id=__codelineno-5-93 name=__codelineno-5-93 href=#__codelineno-5-93></a><span class=k>with</span> <span class=n>finance_llm_config</span><span class=p>:</span>
<a id=__codelineno-5-94 name=__codelineno-5-94 href=#__codelineno-5-94></a>    <span class=n>finance_bot</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-5-95 name=__codelineno-5-95 href=#__codelineno-5-95></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;finance_bot&quot;</span><span class=p>,</span>
<a id=__codelineno-5-96 name=__codelineno-5-96 href=#__codelineno-5-96></a>        <span class=n>system_message</span><span class=o>=</span><span class=n>finance_system_message</span><span class=p>,</span>
<a id=__codelineno-5-97 name=__codelineno-5-97 href=#__codelineno-5-97></a>        <span class=n>functions</span><span class=o>=</span><span class=p>[</span><span class=n>check_duplicate_payment</span><span class=p>],</span>
<a id=__codelineno-5-98 name=__codelineno-5-98 href=#__codelineno-5-98></a>    <span class=p>)</span>
<a id=__codelineno-5-99 name=__codelineno-5-99 href=#__codelineno-5-99></a>
<a id=__codelineno-5-100 name=__codelineno-5-100 href=#__codelineno-5-100></a><span class=c1># Create the human agent for oversight</span>
<a id=__codelineno-5-101 name=__codelineno-5-101 href=#__codelineno-5-101></a><span class=n>human</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-5-102 name=__codelineno-5-102 href=#__codelineno-5-102></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;human&quot;</span><span class=p>,</span>
<a id=__codelineno-5-103 name=__codelineno-5-103 href=#__codelineno-5-103></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;ALWAYS&quot;</span><span class=p>,</span>  <span class=c1># Always ask for human input</span>
<a id=__codelineno-5-104 name=__codelineno-5-104 href=#__codelineno-5-104></a><span class=p>)</span>
<a id=__codelineno-5-105 name=__codelineno-5-105 href=#__codelineno-5-105></a>
<a id=__codelineno-5-106 name=__codelineno-5-106 href=#__codelineno-5-106></a><span class=c1># Define structured output for audit logs</span>
<a id=__codelineno-5-107 name=__codelineno-5-107 href=#__codelineno-5-107></a><span class=k>class</span><span class=w> </span><span class=nc>TransactionAuditEntry</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
<a id=__codelineno-5-108 name=__codelineno-5-108 href=#__codelineno-5-108></a>    <span class=n>vendor</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-5-109 name=__codelineno-5-109 href=#__codelineno-5-109></a>    <span class=n>amount</span><span class=p>:</span> <span class=nb>float</span>
<a id=__codelineno-5-110 name=__codelineno-5-110 href=#__codelineno-5-110></a>    <span class=n>memo</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-5-111 name=__codelineno-5-111 href=#__codelineno-5-111></a>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>  <span class=c1># &quot;approved&quot; or &quot;rejected&quot;</span>
<a id=__codelineno-5-112 name=__codelineno-5-112 href=#__codelineno-5-112></a>    <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-5-113 name=__codelineno-5-113 href=#__codelineno-5-113></a>
<a id=__codelineno-5-114 name=__codelineno-5-114 href=#__codelineno-5-114></a><span class=k>class</span><span class=w> </span><span class=nc>AuditLogSummary</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
<a id=__codelineno-5-115 name=__codelineno-5-115 href=#__codelineno-5-115></a>    <span class=n>total_transactions</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-5-116 name=__codelineno-5-116 href=#__codelineno-5-116></a>    <span class=n>approved_count</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-5-117 name=__codelineno-5-117 href=#__codelineno-5-117></a>    <span class=n>rejected_count</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-5-118 name=__codelineno-5-118 href=#__codelineno-5-118></a>    <span class=n>transactions</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>TransactionAuditEntry</span><span class=p>]</span>
<a id=__codelineno-5-119 name=__codelineno-5-119 href=#__codelineno-5-119></a>    <span class=n>summary_generated_time</span><span class=p>:</span> <span class=nb>str</span>
<a id=__codelineno-5-120 name=__codelineno-5-120 href=#__codelineno-5-120></a>
<a id=__codelineno-5-121 name=__codelineno-5-121 href=#__codelineno-5-121></a><span class=c1># Configure the LLM for summary bot with structured output</span>
<a id=__codelineno-5-122 name=__codelineno-5-122 href=#__codelineno-5-122></a><span class=n>summary_llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-5-123 name=__codelineno-5-123 href=#__codelineno-5-123></a>    <span class=n>api_type</span><span class=o>=</span><span class=s2>&quot;openai&quot;</span><span class=p>,</span>
<a id=__codelineno-5-124 name=__codelineno-5-124 href=#__codelineno-5-124></a>    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span>
<a id=__codelineno-5-125 name=__codelineno-5-125 href=#__codelineno-5-125></a>    <span class=n>api_key</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>),</span>
<a id=__codelineno-5-126 name=__codelineno-5-126 href=#__codelineno-5-126></a>    <span class=n>temperature</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span>
<a id=__codelineno-5-127 name=__codelineno-5-127 href=#__codelineno-5-127></a>    <span class=n>response_format</span><span class=o>=</span><span class=n>AuditLogSummary</span><span class=p>,</span>  <span class=c1># Using the Pydantic model for structured output</span>
<a id=__codelineno-5-128 name=__codelineno-5-128 href=#__codelineno-5-128></a><span class=p>)</span>
<a id=__codelineno-5-129 name=__codelineno-5-129 href=#__codelineno-5-129></a>
<a id=__codelineno-5-130 name=__codelineno-5-130 href=#__codelineno-5-130></a><span class=c1># Define the system message for the summary agent</span>
<a id=__codelineno-5-131 name=__codelineno-5-131 href=#__codelineno-5-131></a><span class=c1># Note: No formatting instructions needed!</span>
<a id=__codelineno-5-132 name=__codelineno-5-132 href=#__codelineno-5-132></a><span class=n>summary_system_message</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-5-133 name=__codelineno-5-133 href=#__codelineno-5-133></a><span class=s2>You are a financial summary assistant that generates audit logs.</span>
<a id=__codelineno-5-134 name=__codelineno-5-134 href=#__codelineno-5-134></a><span class=s2>Analyze the transaction details and their approval status from the conversation.</span>
<a id=__codelineno-5-135 name=__codelineno-5-135 href=#__codelineno-5-135></a><span class=s2>Include each transaction with its vendor, amount, memo, status and reason.</span>
<a id=__codelineno-5-136 name=__codelineno-5-136 href=#__codelineno-5-136></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-5-137 name=__codelineno-5-137 href=#__codelineno-5-137></a>
<a id=__codelineno-5-138 name=__codelineno-5-138 href=#__codelineno-5-138></a><span class=k>with</span> <span class=n>summary_llm_config</span><span class=p>:</span>
<a id=__codelineno-5-139 name=__codelineno-5-139 href=#__codelineno-5-139></a>    <span class=n>summary_bot</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-5-140 name=__codelineno-5-140 href=#__codelineno-5-140></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;summary_bot&quot;</span><span class=p>,</span>
<a id=__codelineno-5-141 name=__codelineno-5-141 href=#__codelineno-5-141></a>        <span class=n>system_message</span><span class=o>=</span><span class=n>summary_system_message</span><span class=p>,</span>
<a id=__codelineno-5-142 name=__codelineno-5-142 href=#__codelineno-5-142></a>    <span class=p>)</span>
<a id=__codelineno-5-143 name=__codelineno-5-143 href=#__codelineno-5-143></a>
<a id=__codelineno-5-144 name=__codelineno-5-144 href=#__codelineno-5-144></a><span class=k>def</span><span class=w> </span><span class=nf>is_termination_msg</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<a id=__codelineno-5-145 name=__codelineno-5-145 href=#__codelineno-5-145></a>    <span class=n>content</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-5-146 name=__codelineno-5-146 href=#__codelineno-5-146></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-5-147 name=__codelineno-5-147 href=#__codelineno-5-147></a>        <span class=c1># Try to parse the content as JSON (structured output)</span>
<a id=__codelineno-5-148 name=__codelineno-5-148 href=#__codelineno-5-148></a>        <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
<a id=__codelineno-5-149 name=__codelineno-5-149 href=#__codelineno-5-149></a>        <span class=k>return</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;summary_generated_time&quot;</span> <span class=ow>in</span> <span class=n>data</span>
<a id=__codelineno-5-150 name=__codelineno-5-150 href=#__codelineno-5-150></a>    <span class=k>except</span><span class=p>:</span>
<a id=__codelineno-5-151 name=__codelineno-5-151 href=#__codelineno-5-151></a>        <span class=c1># If not JSON, check for text marker</span>
<a id=__codelineno-5-152 name=__codelineno-5-152 href=#__codelineno-5-152></a>        <span class=k>return</span> <span class=p>(</span><span class=n>content</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;==== SUMMARY GENERATED ====&quot;</span> <span class=ow>in</span> <span class=n>content</span>
<a id=__codelineno-5-153 name=__codelineno-5-153 href=#__codelineno-5-153></a>
<a id=__codelineno-5-154 name=__codelineno-5-154 href=#__codelineno-5-154></a><span class=c1># Generate new transactions including a duplicate</span>
<a id=__codelineno-5-155 name=__codelineno-5-155 href=#__codelineno-5-155></a><span class=n>transactions</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-5-156 name=__codelineno-5-156 href=#__codelineno-5-156></a>    <span class=s2>&quot;Transaction: $500 to Staples. Memo: Quarterly supplies.&quot;</span><span class=p>,</span>  <span class=c1># Duplicate</span>
<a id=__codelineno-5-157 name=__codelineno-5-157 href=#__codelineno-5-157></a>    <span class=s2>&quot;Transaction: $4000 to Unicorn LLC. Memo: Reimbursement.&quot;</span><span class=p>,</span>
<a id=__codelineno-5-158 name=__codelineno-5-158 href=#__codelineno-5-158></a>    <span class=s2>&quot;Transaction: $12000 to Globex. Memo: Confidential.&quot;</span><span class=p>,</span>  <span class=c1># Duplicate</span>
<a id=__codelineno-5-159 name=__codelineno-5-159 href=#__codelineno-5-159></a>    <span class=s2>&quot;Transaction: $22000 to Initech. Memo: Urgent request.&quot;</span>
<a id=__codelineno-5-160 name=__codelineno-5-160 href=#__codelineno-5-160></a><span class=p>]</span>
<a id=__codelineno-5-161 name=__codelineno-5-161 href=#__codelineno-5-161></a>
<a id=__codelineno-5-162 name=__codelineno-5-162 href=#__codelineno-5-162></a><span class=c1># Format the initial message</span>
<a id=__codelineno-5-163 name=__codelineno-5-163 href=#__codelineno-5-163></a><span class=n>initial_prompt</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-5-164 name=__codelineno-5-164 href=#__codelineno-5-164></a>    <span class=s2>&quot;Please process the following transactions one at a time, checking for duplicates:</span><span class=se>\n\n</span><span class=s2>&quot;</span> <span class=o>+</span>
<a id=__codelineno-5-165 name=__codelineno-5-165 href=#__codelineno-5-165></a>    <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>. </span><span class=si>{</span><span class=n>tx</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>tx</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>transactions</span><span class=p>)])</span>
<a id=__codelineno-5-166 name=__codelineno-5-166 href=#__codelineno-5-166></a><span class=p>)</span>
<a id=__codelineno-5-167 name=__codelineno-5-167 href=#__codelineno-5-167></a>
<a id=__codelineno-5-168 name=__codelineno-5-168 href=#__codelineno-5-168></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-5-169 name=__codelineno-5-169 href=#__codelineno-5-169></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>finance_bot</span><span class=p>,</span>
<a id=__codelineno-5-170 name=__codelineno-5-170 href=#__codelineno-5-170></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>finance_bot</span><span class=p>,</span> <span class=n>summary_bot</span><span class=p>],</span>
<a id=__codelineno-5-171 name=__codelineno-5-171 href=#__codelineno-5-171></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>human</span><span class=p>,</span>
<a id=__codelineno-5-172 name=__codelineno-5-172 href=#__codelineno-5-172></a>    <span class=n>group_manager_args</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-5-173 name=__codelineno-5-173 href=#__codelineno-5-173></a>        <span class=s2>&quot;llm_config&quot;</span><span class=p>:</span> <span class=n>finance_llm_config</span><span class=p>,</span>
<a id=__codelineno-5-174 name=__codelineno-5-174 href=#__codelineno-5-174></a>        <span class=s2>&quot;is_termination_msg&quot;</span><span class=p>:</span> <span class=n>is_termination_msg</span>
<a id=__codelineno-5-175 name=__codelineno-5-175 href=#__codelineno-5-175></a>    <span class=p>},</span>
<a id=__codelineno-5-176 name=__codelineno-5-176 href=#__codelineno-5-176></a><span class=p>)</span>
<a id=__codelineno-5-177 name=__codelineno-5-177 href=#__codelineno-5-177></a>
<a id=__codelineno-5-178 name=__codelineno-5-178 href=#__codelineno-5-178></a><span class=n>result</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>initiate_group_chat</span><span class=p>(</span>
<a id=__codelineno-5-179 name=__codelineno-5-179 href=#__codelineno-5-179></a>    <span class=n>pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-5-180 name=__codelineno-5-180 href=#__codelineno-5-180></a>    <span class=n>messages</span><span class=o>=</span><span class=n>initial_prompt</span><span class=p>,</span>
<a id=__codelineno-5-181 name=__codelineno-5-181 href=#__codelineno-5-181></a><span class=p>)</span>
<a id=__codelineno-5-182 name=__codelineno-5-182 href=#__codelineno-5-182></a>
<a id=__codelineno-5-183 name=__codelineno-5-183 href=#__codelineno-5-183></a><span class=c1># Pretty-print the transaction_data</span>
<a id=__codelineno-5-184 name=__codelineno-5-184 href=#__codelineno-5-184></a><span class=n>final_message</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>chat_history</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>]</span>
<a id=__codelineno-5-185 name=__codelineno-5-185 href=#__codelineno-5-185></a><span class=n>structured_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>final_message</span><span class=p>)</span>
<a id=__codelineno-5-186 name=__codelineno-5-186 href=#__codelineno-5-186></a><span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>structured_data</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>))</span>
</code></pre></div> </details> <h2 id=example-output>Example Output<a class=headerlink href=#example-output title="Permanent link">#</a></h2> <p>When you run this code, you'll receive a perfectly structured JSON output (shown here with pretty-printing):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=go>human (to chat_manager):</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=go>Please process the following transactions one at a time, checking for duplicates:</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=go>1. Transaction: $500 to Staples. Memo: Quarterly supplies.</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=go>2. Transaction: $4000 to Unicorn LLC. Memo: Reimbursement.</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=go>3. Transaction: $12000 to Globex. Memo: Confidential.</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=go>4. Transaction: $22000 to Initech. Memo: Urgent request.</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=go>Next speaker: finance_bot</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=go>finance_bot (to chat_manager):</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=go>***** Suggested tool call (call_q0VApe4K0108hQi8o9FUwHWr): check_duplicate_payment *****</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=go>Arguments:</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=go>{&quot;vendor&quot;: &quot;Staples&quot;, &quot;amount&quot;: 500, &quot;memo&quot;: &quot;Quarterly supplies&quot;}</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=go>****************************************************************************************</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=go>***** Suggested tool call (call_1UXAmxxJksTg4ZoVh8ykoZcL): check_duplicate_payment *****</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=go>Arguments:</span>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=go>{&quot;vendor&quot;: &quot;Unicorn LLC&quot;, &quot;amount&quot;: 4000, &quot;memo&quot;: &quot;Reimbursement&quot;}</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=go>****************************************************************************************</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=go>***** Suggested tool call (call_4WbNhWkK1hcGN5aqzWQeW17E): check_duplicate_payment *****</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=go>Arguments:</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=go>{&quot;vendor&quot;: &quot;Globex&quot;, &quot;amount&quot;: 12000, &quot;memo&quot;: &quot;Confidential&quot;}</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=go>****************************************************************************************</span>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=go>***** Suggested tool call (call_7Msq2A1ZmKkcFmlTgC4q8dl2): check_duplicate_payment *****</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=go>Arguments:</span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=go>{&quot;vendor&quot;: &quot;Initech&quot;, &quot;amount&quot;: 22000, &quot;memo&quot;: &quot;Urgent request&quot;}</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=go>****************************************************************************************</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=go>Next speaker: _Group_Tool_Executor</span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING FUNCTION check_duplicate_payment...</span>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a><span class=go>Call ID: call_q0VApe4K0108hQi8o9FUwHWr</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a><span class=go>Input arguments: {&#39;vendor&#39;: &#39;Staples&#39;, &#39;amount&#39;: 500, &#39;memo&#39;: &#39;Quarterly supplies&#39;}</span>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING FUNCTION check_duplicate_payment...</span>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a><span class=go>Call ID: call_1UXAmxxJksTg4ZoVh8ykoZcL</span>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a><span class=go>Input arguments: {&#39;vendor&#39;: &#39;Unicorn LLC&#39;, &#39;amount&#39;: 4000, &#39;memo&#39;: &#39;Reimbursement&#39;}</span>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING FUNCTION check_duplicate_payment...</span>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a><span class=go>Call ID: call_4WbNhWkK1hcGN5aqzWQeW17E</span>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a><span class=go>Input arguments: {&#39;vendor&#39;: &#39;Globex&#39;, &#39;amount&#39;: 12000, &#39;memo&#39;: &#39;Confidential&#39;}</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING FUNCTION check_duplicate_payment...</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a><span class=go>Call ID: call_7Msq2A1ZmKkcFmlTgC4q8dl2</span>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a><span class=go>Input arguments: {&#39;vendor&#39;: &#39;Initech&#39;, &#39;amount&#39;: 22000, &#39;memo&#39;: &#39;Urgent request&#39;}</span>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a><span class=go>_Group_Tool_Executor (to chat_manager):</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a>
<a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a><span class=go>***** Response from calling tool (call_q0VApe4K0108hQi8o9FUwHWr) *****</span>
<a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a><span class=go>{&#39;is_duplicate&#39;: True, &#39;reason&#39;: &#39;Duplicate payment to Staples for $500.0 on 2025-04-20&#39;}</span>
<a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a><span class=go>**********************************************************************</span>
<a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a>
<a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a><span class=go>***** Response from calling tool (call_1UXAmxxJksTg4ZoVh8ykoZcL) *****</span>
<a id=__codelineno-6-61 name=__codelineno-6-61 href=#__codelineno-6-61></a><span class=go>{&#39;is_duplicate&#39;: False, &#39;reason&#39;: &#39;No recent duplicates found&#39;}</span>
<a id=__codelineno-6-62 name=__codelineno-6-62 href=#__codelineno-6-62></a><span class=go>**********************************************************************</span>
<a id=__codelineno-6-63 name=__codelineno-6-63 href=#__codelineno-6-63></a>
<a id=__codelineno-6-64 name=__codelineno-6-64 href=#__codelineno-6-64></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-65 name=__codelineno-6-65 href=#__codelineno-6-65></a><span class=go>***** Response from calling tool (call_4WbNhWkK1hcGN5aqzWQeW17E) *****</span>
<a id=__codelineno-6-66 name=__codelineno-6-66 href=#__codelineno-6-66></a><span class=go>{&#39;is_duplicate&#39;: True, &#39;reason&#39;: &#39;Duplicate payment to Globex for $12000.0 on 2025-04-18&#39;}</span>
<a id=__codelineno-6-67 name=__codelineno-6-67 href=#__codelineno-6-67></a><span class=go>**********************************************************************</span>
<a id=__codelineno-6-68 name=__codelineno-6-68 href=#__codelineno-6-68></a>
<a id=__codelineno-6-69 name=__codelineno-6-69 href=#__codelineno-6-69></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-70 name=__codelineno-6-70 href=#__codelineno-6-70></a><span class=go>***** Response from calling tool (call_7Msq2A1ZmKkcFmlTgC4q8dl2) *****</span>
<a id=__codelineno-6-71 name=__codelineno-6-71 href=#__codelineno-6-71></a><span class=go>{&#39;is_duplicate&#39;: False, &#39;reason&#39;: &#39;No recent duplicates found&#39;}</span>
<a id=__codelineno-6-72 name=__codelineno-6-72 href=#__codelineno-6-72></a><span class=go>**********************************************************************</span>
<a id=__codelineno-6-73 name=__codelineno-6-73 href=#__codelineno-6-73></a>
<a id=__codelineno-6-74 name=__codelineno-6-74 href=#__codelineno-6-74></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-75 name=__codelineno-6-75 href=#__codelineno-6-75></a>
<a id=__codelineno-6-76 name=__codelineno-6-76 href=#__codelineno-6-76></a><span class=go>Next speaker: finance_bot</span>
<a id=__codelineno-6-77 name=__codelineno-6-77 href=#__codelineno-6-77></a>
<a id=__codelineno-6-78 name=__codelineno-6-78 href=#__codelineno-6-78></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-6-79 name=__codelineno-6-79 href=#__codelineno-6-79></a><span class=go>finance_bot (to chat_manager):</span>
<a id=__codelineno-6-80 name=__codelineno-6-80 href=#__codelineno-6-80></a>
<a id=__codelineno-6-81 name=__codelineno-6-81 href=#__codelineno-6-81></a><span class=go>Let&#39;s process the transactions one by one:</span>
<a id=__codelineno-6-82 name=__codelineno-6-82 href=#__codelineno-6-82></a>
<a id=__codelineno-6-83 name=__codelineno-6-83 href=#__codelineno-6-83></a><span class=go>1. **Transaction: $500 to Staples. Memo: Quarterly supplies.**</span>
<a id=__codelineno-6-84 name=__codelineno-6-84 href=#__codelineno-6-84></a><span class=go>   - **Duplicate Check Result:** This transaction is a duplicate. There is a recent payment to Staples for $500.00 on 2025-04-20.</span>
<a id=__codelineno-6-85 name=__codelineno-6-85 href=#__codelineno-6-85></a><span class=go>   - **Decision:** Reject the transaction due to duplication.</span>
<a id=__codelineno-6-86 name=__codelineno-6-86 href=#__codelineno-6-86></a>
<a id=__codelineno-6-87 name=__codelineno-6-87 href=#__codelineno-6-87></a><span class=go>2. **Transaction: $4000 to Unicorn LLC. Memo: Reimbursement.**</span>
<a id=__codelineno-6-88 name=__codelineno-6-88 href=#__codelineno-6-88></a><span class=go>   - **Duplicate Check Result:** No recent duplicates found.</span>
<a id=__codelineno-6-89 name=__codelineno-6-89 href=#__codelineno-6-89></a><span class=go>   - **Evaluation:** The amount is under $10,000, and the vendor is not unusual. The memo is clear.</span>
<a id=__codelineno-6-90 name=__codelineno-6-90 href=#__codelineno-6-90></a><span class=go>   - **Decision:** Approve the transaction automatically.</span>
<a id=__codelineno-6-91 name=__codelineno-6-91 href=#__codelineno-6-91></a>
<a id=__codelineno-6-92 name=__codelineno-6-92 href=#__codelineno-6-92></a><span class=go>3. **Transaction: $12000 to Globex. Memo: Confidential.**</span>
<a id=__codelineno-6-93 name=__codelineno-6-93 href=#__codelineno-6-93></a><span class=go>   - **Duplicate Check Result:** This transaction is a duplicate. There is a recent payment to Globex for $12,000.00 on 2025-04-18.</span>
<a id=__codelineno-6-94 name=__codelineno-6-94 href=#__codelineno-6-94></a><span class=go>   - **Decision:** Reject the transaction due to duplication.</span>
<a id=__codelineno-6-95 name=__codelineno-6-95 href=#__codelineno-6-95></a>
<a id=__codelineno-6-96 name=__codelineno-6-96 href=#__codelineno-6-96></a><span class=go>4. **Transaction: $22000 to Initech. Memo: Urgent request.**</span>
<a id=__codelineno-6-97 name=__codelineno-6-97 href=#__codelineno-6-97></a><span class=go>   - **Duplicate Check Result:** No recent duplicates found.</span>
<a id=__codelineno-6-98 name=__codelineno-6-98 href=#__codelineno-6-98></a><span class=go>   - **Evaluation:** The amount is over $10,000, and the memo is somewhat vague.</span>
<a id=__codelineno-6-99 name=__codelineno-6-99 href=#__codelineno-6-99></a><span class=go>   - **Decision:** This transaction seems suspicious, so I will ask for human approval.</span>
<a id=__codelineno-6-100 name=__codelineno-6-100 href=#__codelineno-6-100></a>
<a id=__codelineno-6-101 name=__codelineno-6-101 href=#__codelineno-6-101></a><span class=gp>#</span><span class=c1>## Summary of Results:</span>
<a id=__codelineno-6-102 name=__codelineno-6-102 href=#__codelineno-6-102></a><span class=go>- **Rejected:** $500 to Staples (duplicate).</span>
<a id=__codelineno-6-103 name=__codelineno-6-103 href=#__codelineno-6-103></a><span class=go>- **Approved:** $4000 to Unicorn LLC.</span>
<a id=__codelineno-6-104 name=__codelineno-6-104 href=#__codelineno-6-104></a><span class=go>- **Rejected:** $12000 to Globex (duplicate).</span>
<a id=__codelineno-6-105 name=__codelineno-6-105 href=#__codelineno-6-105></a><span class=go>- **Pending Approval:** $22000 to Initech (suspicious).</span>
<a id=__codelineno-6-106 name=__codelineno-6-106 href=#__codelineno-6-106></a>
<a id=__codelineno-6-107 name=__codelineno-6-107 href=#__codelineno-6-107></a><span class=go>You can type exit to finish.</span>
<a id=__codelineno-6-108 name=__codelineno-6-108 href=#__codelineno-6-108></a>
<a id=__codelineno-6-109 name=__codelineno-6-109 href=#__codelineno-6-109></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-110 name=__codelineno-6-110 href=#__codelineno-6-110></a>
<a id=__codelineno-6-111 name=__codelineno-6-111 href=#__codelineno-6-111></a><span class=go>Next speaker: human</span>
<a id=__codelineno-6-112 name=__codelineno-6-112 href=#__codelineno-6-112></a>
<a id=__codelineno-6-113 name=__codelineno-6-113 href=#__codelineno-6-113></a><span class=go>Replying as human. Provide feedback to chat_manager. Press enter to skip and use auto-reply, or type &#39;exit&#39; to end the conversation: approve</span>
<a id=__codelineno-6-114 name=__codelineno-6-114 href=#__codelineno-6-114></a><span class=go>human (to chat_manager):</span>
<a id=__codelineno-6-115 name=__codelineno-6-115 href=#__codelineno-6-115></a>
<a id=__codelineno-6-116 name=__codelineno-6-116 href=#__codelineno-6-116></a><span class=go>approve</span>
<a id=__codelineno-6-117 name=__codelineno-6-117 href=#__codelineno-6-117></a>
<a id=__codelineno-6-118 name=__codelineno-6-118 href=#__codelineno-6-118></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-119 name=__codelineno-6-119 href=#__codelineno-6-119></a>
<a id=__codelineno-6-120 name=__codelineno-6-120 href=#__codelineno-6-120></a><span class=go>Next speaker: finance_bot</span>
<a id=__codelineno-6-121 name=__codelineno-6-121 href=#__codelineno-6-121></a>
<a id=__codelineno-6-122 name=__codelineno-6-122 href=#__codelineno-6-122></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-6-123 name=__codelineno-6-123 href=#__codelineno-6-123></a><span class=go>finance_bot (to chat_manager):</span>
<a id=__codelineno-6-124 name=__codelineno-6-124 href=#__codelineno-6-124></a>
<a id=__codelineno-6-125 name=__codelineno-6-125 href=#__codelineno-6-125></a><span class=go>The transaction for $22000 to Initech has been approved.</span>
<a id=__codelineno-6-126 name=__codelineno-6-126 href=#__codelineno-6-126></a>
<a id=__codelineno-6-127 name=__codelineno-6-127 href=#__codelineno-6-127></a><span class=gp>#</span><span class=c1>## Final Summary of Results:</span>
<a id=__codelineno-6-128 name=__codelineno-6-128 href=#__codelineno-6-128></a><span class=go>- **Rejected:** $500 to Staples (duplicate).</span>
<a id=__codelineno-6-129 name=__codelineno-6-129 href=#__codelineno-6-129></a><span class=go>- **Approved:** $4000 to Unicorn LLC.</span>
<a id=__codelineno-6-130 name=__codelineno-6-130 href=#__codelineno-6-130></a><span class=go>- **Rejected:** $12000 to Globex (duplicate).</span>
<a id=__codelineno-6-131 name=__codelineno-6-131 href=#__codelineno-6-131></a><span class=go>- **Approved:** $22000 to Initech.</span>
<a id=__codelineno-6-132 name=__codelineno-6-132 href=#__codelineno-6-132></a>
<a id=__codelineno-6-133 name=__codelineno-6-133 href=#__codelineno-6-133></a><span class=go>All transactions have been processed. You can type exit to finish.</span>
<a id=__codelineno-6-134 name=__codelineno-6-134 href=#__codelineno-6-134></a>
<a id=__codelineno-6-135 name=__codelineno-6-135 href=#__codelineno-6-135></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-136 name=__codelineno-6-136 href=#__codelineno-6-136></a>
<a id=__codelineno-6-137 name=__codelineno-6-137 href=#__codelineno-6-137></a><span class=go>Next speaker: summary_bot</span>
<a id=__codelineno-6-138 name=__codelineno-6-138 href=#__codelineno-6-138></a>
<a id=__codelineno-6-139 name=__codelineno-6-139 href=#__codelineno-6-139></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-6-140 name=__codelineno-6-140 href=#__codelineno-6-140></a><span class=go>summary_bot (to chat_manager):</span>
<a id=__codelineno-6-141 name=__codelineno-6-141 href=#__codelineno-6-141></a>
<a id=__codelineno-6-142 name=__codelineno-6-142 href=#__codelineno-6-142></a><span class=go>{&quot;total_transactions&quot;:4,&quot;approved_count&quot;:2,&quot;rejected_count&quot;:2,&quot;transactions&quot;:[{&quot;vendor&quot;:&quot;Staples&quot;,&quot;amount&quot;:500,&quot;memo&quot;:&quot;Quarterly supplies&quot;,&quot;status&quot;:&quot;Rejected&quot;,&quot;reason&quot;:&quot;Duplicate payment to Staples for $500.0 on 2025-04-20&quot;},{&quot;vendor&quot;:&quot;Unicorn LLC&quot;,&quot;amount&quot;:4000,&quot;memo&quot;:&quot;Reimbursement&quot;,&quot;status&quot;:&quot;Approved&quot;,&quot;reason&quot;:&quot;No recent duplicates found&quot;},{&quot;vendor&quot;:&quot;Globex&quot;,&quot;amount&quot;:12000,&quot;memo&quot;:&quot;Confidential&quot;,&quot;status&quot;:&quot;Rejected&quot;,&quot;reason&quot;:&quot;Duplicate payment to Globex for $12000.0 on 2025-04-18&quot;},{&quot;vendor&quot;:&quot;Initech&quot;,&quot;amount&quot;:22000,&quot;memo&quot;:&quot;Urgent request&quot;,&quot;status&quot;:&quot;Approved&quot;,&quot;reason&quot;:&quot;No recent duplicates found&quot;}],&quot;summary_generated_time&quot;:&quot;2023-10-05T12:00:00Z&quot;}</span>
<a id=__codelineno-6-143 name=__codelineno-6-143 href=#__codelineno-6-143></a>
<a id=__codelineno-6-144 name=__codelineno-6-144 href=#__codelineno-6-144></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-6-145 name=__codelineno-6-145 href=#__codelineno-6-145></a>
<a id=__codelineno-6-146 name=__codelineno-6-146 href=#__codelineno-6-146></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; TERMINATING RUN (c9144262-7977-4ddd-b621-82b07d55b9cb): Termination message condition on the GroupChatManager &#39;chat_manager&#39; met</span>
<a id=__codelineno-6-147 name=__codelineno-6-147 href=#__codelineno-6-147></a><span class=go>{</span>
<a id=__codelineno-6-148 name=__codelineno-6-148 href=#__codelineno-6-148></a><span class=go>    &quot;total_transactions&quot;: 4,</span>
<a id=__codelineno-6-149 name=__codelineno-6-149 href=#__codelineno-6-149></a><span class=go>    &quot;approved_count&quot;: 2,</span>
<a id=__codelineno-6-150 name=__codelineno-6-150 href=#__codelineno-6-150></a><span class=go>    &quot;rejected_count&quot;: 2,</span>
<a id=__codelineno-6-151 name=__codelineno-6-151 href=#__codelineno-6-151></a><span class=go>    &quot;transactions&quot;: [</span>
<a id=__codelineno-6-152 name=__codelineno-6-152 href=#__codelineno-6-152></a><span class=go>        {</span>
<a id=__codelineno-6-153 name=__codelineno-6-153 href=#__codelineno-6-153></a><span class=go>            &quot;vendor&quot;: &quot;Staples&quot;,</span>
<a id=__codelineno-6-154 name=__codelineno-6-154 href=#__codelineno-6-154></a><span class=go>            &quot;amount&quot;: 500,</span>
<a id=__codelineno-6-155 name=__codelineno-6-155 href=#__codelineno-6-155></a><span class=go>            &quot;memo&quot;: &quot;Quarterly supplies&quot;,</span>
<a id=__codelineno-6-156 name=__codelineno-6-156 href=#__codelineno-6-156></a><span class=go>            &quot;status&quot;: &quot;Rejected&quot;,</span>
<a id=__codelineno-6-157 name=__codelineno-6-157 href=#__codelineno-6-157></a><span class=go>            &quot;reason&quot;: &quot;Duplicate payment to Staples for $500.0 on 2025-04-20&quot;</span>
<a id=__codelineno-6-158 name=__codelineno-6-158 href=#__codelineno-6-158></a><span class=go>        },</span>
<a id=__codelineno-6-159 name=__codelineno-6-159 href=#__codelineno-6-159></a><span class=go>        {</span>
<a id=__codelineno-6-160 name=__codelineno-6-160 href=#__codelineno-6-160></a><span class=go>            &quot;vendor&quot;: &quot;Unicorn LLC&quot;,</span>
<a id=__codelineno-6-161 name=__codelineno-6-161 href=#__codelineno-6-161></a><span class=go>            &quot;amount&quot;: 4000,</span>
<a id=__codelineno-6-162 name=__codelineno-6-162 href=#__codelineno-6-162></a><span class=go>            &quot;memo&quot;: &quot;Reimbursement&quot;,</span>
<a id=__codelineno-6-163 name=__codelineno-6-163 href=#__codelineno-6-163></a><span class=go>            &quot;status&quot;: &quot;Approved&quot;,</span>
<a id=__codelineno-6-164 name=__codelineno-6-164 href=#__codelineno-6-164></a><span class=go>            &quot;reason&quot;: &quot;No recent duplicates found&quot;</span>
<a id=__codelineno-6-165 name=__codelineno-6-165 href=#__codelineno-6-165></a><span class=go>        },</span>
<a id=__codelineno-6-166 name=__codelineno-6-166 href=#__codelineno-6-166></a><span class=go>        {</span>
<a id=__codelineno-6-167 name=__codelineno-6-167 href=#__codelineno-6-167></a><span class=go>            &quot;vendor&quot;: &quot;Globex&quot;,</span>
<a id=__codelineno-6-168 name=__codelineno-6-168 href=#__codelineno-6-168></a><span class=go>            &quot;amount&quot;: 12000,</span>
<a id=__codelineno-6-169 name=__codelineno-6-169 href=#__codelineno-6-169></a><span class=go>            &quot;memo&quot;: &quot;Confidential&quot;,</span>
<a id=__codelineno-6-170 name=__codelineno-6-170 href=#__codelineno-6-170></a><span class=go>            &quot;status&quot;: &quot;Rejected&quot;,</span>
<a id=__codelineno-6-171 name=__codelineno-6-171 href=#__codelineno-6-171></a><span class=go>            &quot;reason&quot;: &quot;Duplicate payment to Globex for $12000.0 on 2025-04-18&quot;</span>
<a id=__codelineno-6-172 name=__codelineno-6-172 href=#__codelineno-6-172></a><span class=go>        },</span>
<a id=__codelineno-6-173 name=__codelineno-6-173 href=#__codelineno-6-173></a><span class=go>        {</span>
<a id=__codelineno-6-174 name=__codelineno-6-174 href=#__codelineno-6-174></a><span class=go>            &quot;vendor&quot;: &quot;Initech&quot;,</span>
<a id=__codelineno-6-175 name=__codelineno-6-175 href=#__codelineno-6-175></a><span class=go>            &quot;amount&quot;: 22000,</span>
<a id=__codelineno-6-176 name=__codelineno-6-176 href=#__codelineno-6-176></a><span class=go>            &quot;memo&quot;: &quot;Urgent request&quot;,</span>
<a id=__codelineno-6-177 name=__codelineno-6-177 href=#__codelineno-6-177></a><span class=go>            &quot;status&quot;: &quot;Approved&quot;,</span>
<a id=__codelineno-6-178 name=__codelineno-6-178 href=#__codelineno-6-178></a><span class=go>            &quot;reason&quot;: &quot;No recent duplicates found&quot;</span>
<a id=__codelineno-6-179 name=__codelineno-6-179 href=#__codelineno-6-179></a><span class=go>        }</span>
<a id=__codelineno-6-180 name=__codelineno-6-180 href=#__codelineno-6-180></a><span class=go>    ],</span>
<a id=__codelineno-6-181 name=__codelineno-6-181 href=#__codelineno-6-181></a><span class=go>    &quot;summary_generated_time&quot;: &quot;2023-10-05T12:00:00Z&quot;</span>
<a id=__codelineno-6-182 name=__codelineno-6-182 href=#__codelineno-6-182></a><span class=go>}</span>
</code></pre></div> <h2 id=key-benefits-of-structured-outputs>Key Benefits of Structured Outputs<a class=headerlink href=#key-benefits-of-structured-outputs title="Permanent link">#</a></h2> <p>Structured outputs offer several compelling benefits:</p> <ul> <li><strong>Consistency</strong>: Every response has the same structure, making integration reliable</li> <li><strong>Validation</strong>: Built-in type checking ensures data integrity</li> <li><strong>Simplicity</strong>: Reduced need for complex formatting instructions in system messages</li> <li><strong>Integration</strong>: Easy to parse and use in downstream systems</li> <li><strong>Maintainability</strong>: Schema changes can be managed centrally</li> </ul> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">#</a></h2> <p>You've now learned how to create a complete financial compliance system incorporating the basic concepts of AG2:</p> <ul> <li><strong>LLM Configuration</strong>: Powering our agents with the right language models</li> <li><strong>ConversableAgent</strong>: Creating smart, interactive agents for different tasks</li> <li><strong>Human in the Loop</strong>: Adding human oversight for suspicious transactions</li> <li><strong>Agent Orchestration</strong>: Coordinating multiple specialized agents with the Group Chat pattern</li> <li><strong>Tools</strong>: Extending agent capabilities with duplicate payment detection</li> <li><strong>Structured Outputs</strong>: Ensuring consistent, validated summary reports</li> </ul> <p>In the Advanced Concepts section, you'll learn how to further enhance your AG2 applications with more sophisticated patterns, agent capabilities, and integration options. You'll also find more in-depth explanations of the concepts we've covered here, allowing you to build even more powerful multi-agent systems.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-05-08T13:42:19+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-05-08</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../introducing-tools/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Tools: Extending Agent Capabilities"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Tools: Extending Agent Capabilities </div> </div> </a> <a href=../../advanced-concepts/llm-configuration-deep-dive/ class="md-footer__link md-footer__link--next" aria-label="Next: LLM Configuration Deep Dive"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> LLM Configuration Deep Dive </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../../js/timeago.min.js></script> <script src=../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>