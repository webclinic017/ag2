<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This is a nested chat re-implementation of OptiGuide which is an LLM-based supply chain optimization framework."><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://docs.ag2.ai/latest/docs/use-cases/notebooks/notebooks/agentchat_nestedchat_optiguide/ rel=canonical><link href=../autogen_uniformed_api_calling/ rel=prev><link href=../agentchat_nested_chats_chess_altmodels/ rel=next><link rel=icon href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>OptiGuide with Nested Chats in AG2 - AG2</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../css/timeago.css><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../stylesheets/extra.ff0633.min.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - OptiGuide with Nested Chats in AG2"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://docs.ag2.ai/latest/docs/use-cases/notebooks/notebooks/agentchat_nestedchat_optiguide/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - OptiGuide with Nested Chats in AG2"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon-dark.svg type=image/x-icon media="(prefers-color-scheme: light)"><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon media="(prefers-color-scheme: dark)"><link href=../../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#optiguide-with-nested-chats-in-ag2 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> OptiGuide with Nested Chats in AG2 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../quick-start/ class=md-tabs__link> Quick Start </a> </li> <li class=md-tabs__item> <a href=../../../../user-guide/basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../../api-reference/autogen/Agent/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../use-cases/customer-service/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-tabs__link> Community Insights </a> </li> <li class=md-tabs__item> <a href=../../../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../user-guide/basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../api-reference/autogen/Agent/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../use-cases/customer-service/ class=md-nav__link> <span class=md-ellipsis> Use cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2 checked> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> Notebooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=true> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Notebooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Notebooks/ class=md-nav__link> <span class=md-ellipsis> All Notebooks </span> </a> </li> <li class=md-nav__item> <a href=../tools_perplexity_search/ class=md-nav__link> <span class=md-ellipsis> Perplexity Search Tool </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_human_feedback/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Task Solving with Code Generation, Execution, Debugging & Human Feedback </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_graphrag_telemetry_trip_planner/ class=md-nav__link> <span class=md-ellipsis> Using a local Telemetry server to monitor a GraphRAG agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Task Solving with Provided Tools as Functions </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_gemini_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent with gemini client </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_tabular_data_rag_workflow/ class=md-nav__link> <span class=md-ellipsis> Agentic RAG workflow on tabular data from a PDF file </span> </a> </li> <li class=md-nav__item> <a href=../lats_search/ class=md-nav__link> <span class=md-ellipsis> Language Agent Tree Search </span> </a> </li> <li class=md-nav__item> <a href=../config_loader_utility_functions/ class=md-nav__link> <span class=md-ellipsis> Config loader utility functions </span> </a> </li> <li class=md-nav__item> <a href=../agents_wikipedia/ class=md-nav__link> <span class=md-ellipsis> Wikipedia Agent </span> </a> </li> <li class=md-nav__item> <a href=../tools_google_drive/ class=md-nav__link> <span class=md-ellipsis> Google Drive Tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_finite_state_machine/ class=md-nav__link> <span class=md-ellipsis> FSM - User can input speaker transition constraints </span> </a> </li> <li class=md-nav__item> <a href=../agents_deep_researcher/ class=md-nav__link> <span class=md-ellipsis> DeepResearchAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_RAG/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Retrieval Augmented Generation </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_agentoptimizer/ class=md-nav__link> <span class=md-ellipsis> AgentOptimizer: An Agentic Way to Train Your LLM Agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_qdrant/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat with Qdrant for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_webrtc/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent with WebRTC connection </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_memory_using_mem0/ class=md-nav__link> <span class=md-ellipsis> Agent with memory using Mem0 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_transform_messages/ class=md-nav__link> <span class=md-ellipsis> Preprocessing Chat History with TransformMessages </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_swarm_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_retrieval/ class=md-nav__link> <span class=md-ellipsis> RAG OpenAI Assistants in AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_guidance/ class=md-nav__link> <span class=md-ellipsis> Using Guidance with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_mongodb/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat Powered by MongoDB Atlas for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_graph_rag_neo4j/ class=md-nav__link> <span class=md-ellipsis> Using Neo4j's graph database with AG2 agents for Question & Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_databricks_dbrx/ class=md-nav__link> <span class=md-ellipsis> Use AG2 in Databricks with DBRX </span> </a> </li> <li class=md-nav__item> <a href=../tools_wikipedia_search/ class=md-nav__link> <span class=md-ellipsis> Wikipedia Search Tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nestedchat/ class=md-nav__link> <span class=md-ellipsis> Solving Complex Tasks with Nested Chats </span> </a> </li> <li class=md-nav__item> <a href=../tools_browser_use_deepseek/ class=md-nav__link> <span class=md-ellipsis> DeepSeek: Adding Browsing Capabilities to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nested_sequential_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Complex Tasks with A Sequence of Nested Chats </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nested_chats_chess/ class=md-nav__link> <span class=md-ellipsis> Nested Chats for Tool Use in Conversational Chess </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_twoagents_basic/ class=md-nav__link> <span class=md-ellipsis> OpenAI Assistants in AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_vis/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Coder and Visualization Critic </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_lmm_llava/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with Multimodal Models: LLaVA </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_society_of_mind/ class=md-nav__link> <span class=md-ellipsis> SocietyOfMindAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_mcp_filesystem/ class=md-nav__link> <span class=md-ellipsis> Conversational Workflows with MCP: A Marie Antoinette Take on The Eiffel Tower </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_dalle_and_gpt4v/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with Multimodal Models: DALLE and GPT-4V </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_stateflow/ class=md-nav__link> <span class=md-ellipsis> StateFlow: Build Workflows through State-Oriented Actions </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_small_llm_rag_planning/ class=md-nav__link> <span class=md-ellipsis> Small, Local Model (IBM Granite) Multi-Agent RAG </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_tools/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Tools </span> </a> </li> <li class=md-nav__item> <a href=../tools_duckduckgo_search/ class=md-nav__link> <span class=md-ellipsis> DuckDuckGo Search Tool </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_quickstart_examples/ class=md-nav__link> <span class=md-ellipsis> Load the configuration including the response format </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_gemini_swarm_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../mcp_client/ class=md-nav__link> <span class=md-ellipsis> MCP Clients </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_agentops/ class=md-nav__link> <span class=md-ellipsis> Agent Tracking with AgentOps </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_sql_spider/ class=md-nav__link> <span class=md-ellipsis> SQL Agent for Spider text-to-SQL benchmark </span> </a> </li> <li class=md-nav__item> <a href=../autobuild_basic/ class=md-nav__link> <span class=md-ellipsis> AutoBuild </span> </a> </li> <li class=md-nav__item> <a href=../autobuild_agent_library/ class=md-nav__link> <span class=md-ellipsis> Automatically Build Multi-agent System from Agent Library </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_image_generation_capability/ class=md-nav__link> <span class=md-ellipsis> Generate Dalle Images With Conversable Agents </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_openlit/ class=md-nav__link> <span class=md-ellipsis> Agent Observability with OpenLIT </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_couchbase/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat Powered by Couchbase Capella for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../autogen_uniformed_api_calling/ class=md-nav__link> <span class=md-ellipsis> A Uniform interface to call different LLMs </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> OptiGuide with Nested Chats in AG2 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> OptiGuide with Nested Chats in AG2 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#step-0-prepare-helper-functions class=md-nav__link> <span class=md-ellipsis> Step 0. Prepare Helper Functions </span> </a> <nav class=md-nav aria-label="Step 0. Prepare Helper Functions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#utility-functions class=md-nav__link> <span class=md-ellipsis> Utility Functions </span> </a> </li> <li class=md-nav__item> <a href=#functions-external-code-retrieval class=md-nav__link> <span class=md-ellipsis> Functions External Code Retrieval </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-1-agent-construction class=md-nav__link> <span class=md-ellipsis> Step 1. Agent Construction </span> </a> <nav class=md-nav aria-label="Step 1. Agent Construction"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#classes-defined class=md-nav__link> <span class=md-ellipsis> Classes Defined </span> </a> </li> <li class=md-nav__item> <a href=#agent-instances class=md-nav__link> <span class=md-ellipsis> Agent Instances </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-2-orchestrate-nested-chats class=md-nav__link> <span class=md-ellipsis> Step 2. Orchestrate Nested Chats </span> </a> <nav class=md-nav aria-label="Step 2. Orchestrate Nested Chats"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#let-the-agents-talk class=md-nav__link> <span class=md-ellipsis> Let the agents talk </span> </a> </li> <li class=md-nav__item> <a href=#get-final-results-from-the-returned-chatresult-object class=md-nav__link> <span class=md-ellipsis> Get Final Results from the Returned ChatResult Object </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../agentchat_nested_chats_chess_altmodels/ class=md-nav__link> <span class=md-ellipsis> Conversational Chess using non-OpenAI clients </span> </a> </li> <li class=md-nav__item> <a href=../tools_chat_context_dependency_injection/ class=md-nav__link> <span class=md-ellipsis> Chat Context Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_with_memory/ class=md-nav__link> <span class=md-ellipsis> Agent with memory using Mem0 </span> </a> </li> <li class=md-nav__item> <a href=../run_and_event_processing/ class=md-nav__link> <span class=md-ellipsis> run function examples with event processing </span> </a> </li> <li class=md-nav__item> <a href=../gpt_assistant_agent_function_call/ class=md-nav__link> <span class=md-ellipsis> From Dad Jokes To Sad Jokes: Function Calling with GPTAssistantAgent </span> </a> </li> <li class=md-nav__item> <a href=../JSON_mode_example/ class=md-nav__link> <span class=md-ellipsis> Mitigating Prompt hacking with JSON Mode in Autogen </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_customized/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Customized Speaker Selection Method </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_graphrag_trip_planner/ class=md-nav__link> <span class=md-ellipsis> Trip planning with a FalkorDB GraphRAG agent using a Swarm </span> </a> </li> <li class=md-nav__item> <a href=../tools_tavily_search/ class=md-nav__link> <span class=md-ellipsis> Tavily Search Tool </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_structured_outputs/ class=md-nav__link> <span class=md-ellipsis> Structured output </span> </a> </li> <li class=md-nav__item> <a href=../tools_google_search/ class=md-nav__link> <span class=md-ellipsis> Adding Google Search Capability to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call_async/ class=md-nav__link> <span class=md-ellipsis> Task Solving with Provided Tools as Functions (Asynchronous Function Calls) </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_mcp_wikipedia/ class=md-nav__link> <span class=md-ellipsis> Conversational Workflows with MCP: A French joke on a random Wikipedia article </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_MathChat/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Using MathChat to Solve Math Problems </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_custom_model/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with custom model loading </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_inception_function/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Function Inception </span> </a> </li> <li class=md-nav__item> <a href=../oai_chatgpt_gpt4/ class=md-nav__link> <span class=md-ellipsis> Use AG2 to Tune ChatGPT </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_groupchat/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Group Chat with GPTAssistantAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_graph_rag_falkordb/ class=md-nav__link> <span class=md-ellipsis> Using FalkorGraphRagCapability with agents for GraphRAG Question & Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_multi_task_async_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Multiple Tasks in a Sequence of Async Chats </span> </a> </li> <li class=md-nav__item> <a href=../tools_commsplatforms/ class=md-nav__link> <span class=md-ellipsis> Discord, Slack, and Telegram messaging tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_swarm_webrtc/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration using WebRTC </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_logging/ class=md-nav__link> <span class=md-ellipsis> Runtime Logging with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agents_websurfer/ class=md-nav__link> <span class=md-ellipsis> WebSurferAgent </span> </a> </li> <li class=md-nav__item> <a href=../mongodb_query_engine/ class=md-nav__link> <span class=md-ellipsis> Use MongoDBQueryEngine to query Markdown files </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_mcp_arxiv/ class=md-nav__link> <span class=md-ellipsis> Conversational Workflows with MCP: A Shakespearean Take on arXiv Abstracts </span> </a> </li> <li class=md-nav__item> <a href=../agents_docagent/ class=md-nav__link> <span class=md-ellipsis> RAG with DocAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_multi_task_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Multiple Tasks in a Sequence of Chats </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_captainagent_crosstool/ class=md-nav__link> <span class=md-ellipsis> Cross-Framework LLM Tool for CaptainAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_webscraping_with_apify/ class=md-nav__link> <span class=md-ellipsis> Web Scraping using Apify Tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_planning/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Collaborative Task Solving with Coding and Planning Agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call_currency_calculator/ class=md-nav__link> <span class=md-ellipsis> Currency Calculator: Task Solving with Provided Tools as Functions </span> </a> </li> <li class=md-nav__item> <a href=../Chromadb_query_engine/ class=md-nav__link> <span class=md-ellipsis> Use ChromaDBQueryEngine to query Markdown files </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call_code_writing/ class=md-nav__link> <span class=md-ellipsis> Writing a software application using function calls </span> </a> </li> <li class=md-nav__item> <a href=../tools_web_search_preview/ class=md-nav__link> <span class=md-ellipsis> Using OpenAIâ€™s Web Search Tool with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_pgvector/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat Powered by PGVector for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_enhanced/ class=md-nav__link> <span class=md-ellipsis> Enhanced Swarm Orchestration with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_research/ class=md-nav__link> <span class=md-ellipsis> Perform Research with Multi-Agent Group Chat </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_teaching/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Teaching AI New Skills via Natural Language Interaction </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_cost_token_tracking/ class=md-nav__link> <span class=md-ellipsis> Usage tracking with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_graph_rag_neo4j_native/ class=md-nav__link> <span class=md-ellipsis> Using Neo4j's native GraphRAG SDK with AG2 agents for Question & Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_group_chat_with_llamaindex_agents/ class=md-nav__link> <span class=md-ellipsis> Groupchat with Llamaindex agents </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_azr_ai_search/ class=md-nav__link> <span class=md-ellipsis> Assistants with Azure Cognitive Search and Azure Identity </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm/ class=md-nav__link> <span class=md-ellipsis> Swarm Orchestration with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../tools_dependency_injection/ class=md-nav__link> <span class=md-ellipsis> Tools with Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_structured_outputs_from_config/ class=md-nav__link> <span class=md-ellipsis> Structured output from json configuration </span> </a> </li> <li class=md-nav__item> <a href=../agentchats_sequential_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Multiple Tasks in a Sequence of Chats with Different Conversable Agent Pairs </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_function_call/ class=md-nav__link> <span class=md-ellipsis> Chat with OpenAI Assistant using function call in AG2: OSS Insights for Advanced GitHub Data Analysis </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_two_users/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Collaborative Task Solving with Multiple Agents and Human Users </span> </a> </li> <li class=md-nav__item> <a href=../tools_youtube_search/ class=md-nav__link> <span class=md-ellipsis> Adding YouTube Search Capability to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_teachability/ class=md-nav__link> <span class=md-ellipsis> Chatting with a teachable agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_teachable_oai_assistants/ class=md-nav__link> <span class=md-ellipsis> Making OpenAI Assistants Teachable </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_swarm/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_video_transcript_translate_with_whisper/ class=md-nav__link> <span class=md-ellipsis> Translating Video audio using Whisper and GPT-3.5-turbo </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_assistant_agent_standalone/ class=md-nav__link> <span class=md-ellipsis> Run a standalone AssistantAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_langchain/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Task Solving with Langchain Provided Tools as Functions </span> </a> </li> <li class=md-nav__item> <a href=../LlamaIndex_query_engine/ class=md-nav__link> <span class=md-ellipsis> Use LLamaIndexQueryEngine to query Markdown files </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_code_interpreter/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: GPTAssistant with Code Interpreter </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_stream/ class=md-nav__link> <span class=md-ellipsis> Interactive LLM Agent Dealing with Data Stream </span> </a> </li> <li class=md-nav__item> <a href=../async_human_input/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with Async Human Inputs </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_reasoning_agent/ class=md-nav__link> <span class=md-ellipsis> ReasoningAgent - Advanced LLM Reasoning with Multiple Search Strategies </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_web_info/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Solving Tasks Requiring Web Info </span> </a> </li> <li class=md-nav__item> <a href=../oai_completion/ class=md-nav__link> <span class=md-ellipsis> Use AG2 to Tune OpenAI Models </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_lmm_gpt-4v/ class=md-nav__link> <span class=md-ellipsis> Engaging with Multimodal Models: GPT-4V in AG2 </span> </a> </li> <li class=md-nav__item> <a href=../tools_crawl4ai/ class=md-nav__link> <span class=md-ellipsis> Supercharging Web Crawling with Crawl4AI </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_microsoft_fabric/ class=md-nav__link> <span class=md-ellipsis> Use AG2 in Microsoft Fabric </span> </a> </li> <li class=md-nav__item> <a href=../tools_interoperability/ class=md-nav__link> <span class=md-ellipsis> Cross-Framework LLM Tool Integration with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agenteval_cq_math/ class=md-nav__link> <span class=md-ellipsis> Demonstrating the AgentEval framework using the task of solving math problems as an example </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat/ class=md-nav__link> <span class=md-ellipsis> Group Chat </span> </a> </li> <li class=md-nav__item> <a href=../tools_browser_use/ class=md-nav__link> <span class=md-ellipsis> Adding Browsing Capabilities to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_captainagent/ class=md-nav__link> <span class=md-ellipsis> CaptainAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_w_groupchat_legacy/ class=md-nav__link> <span class=md-ellipsis> (Legacy) Implement Swarm-style orchestration with GroupChat </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_auto_feedback_from_code_execution/ class=md-nav__link> <span class=md-ellipsis> Task Solving with Code Generation, Execution and Debugging </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent with local websocket connection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../community-gallery/community-gallery/ class=md-nav__link> <span class=md-ellipsis> Community Gallery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-nav__link> <span class=md-ellipsis> Community Insights </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#step-0-prepare-helper-functions class=md-nav__link> <span class=md-ellipsis> Step 0. Prepare Helper Functions </span> </a> <nav class=md-nav aria-label="Step 0. Prepare Helper Functions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#utility-functions class=md-nav__link> <span class=md-ellipsis> Utility Functions </span> </a> </li> <li class=md-nav__item> <a href=#functions-external-code-retrieval class=md-nav__link> <span class=md-ellipsis> Functions External Code Retrieval </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-1-agent-construction class=md-nav__link> <span class=md-ellipsis> Step 1. Agent Construction </span> </a> <nav class=md-nav aria-label="Step 1. Agent Construction"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#classes-defined class=md-nav__link> <span class=md-ellipsis> Classes Defined </span> </a> </li> <li class=md-nav__item> <a href=#agent-instances class=md-nav__link> <span class=md-ellipsis> Agent Instances </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-2-orchestrate-nested-chats class=md-nav__link> <span class=md-ellipsis> Step 2. Orchestrate Nested Chats </span> </a> <nav class=md-nav aria-label="Step 2. Orchestrate Nested Chats"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#let-the-agents-talk class=md-nav__link> <span class=md-ellipsis> Let the agents talk </span> </a> </li> <li class=md-nav__item> <a href=#get-final-results-from-the-returned-chatresult-object class=md-nav__link> <span class=md-ellipsis> Get Final Results from the Returned ChatResult Object </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/edit/main/website/docs/use-cases/notebooks/notebooks/agentchat_nestedchat_optiguide.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg> </a> <h1 id=optiguide-with-nested-chats-in-ag2>OptiGuide with Nested Chats in AG2<a class=headerlink href=#optiguide-with-nested-chats-in-ag2 title="Permanent link">#</a></h1> <p><a href=https://colab.research.google.com/github/ag2ai/ag2/blob/main/notebook/agentchat_nestedchat_optiguide.ipynb class=colab-badge target=_blank><img nozoom src=https://colab.research.google.com/assets/colab-badge.svg alt="Open In Colab"></a> <a href=https://github.com/ag2ai/ag2/blob/main/notebook/agentchat_nestedchat_optiguide.ipynb class=github-badge target=_blank><img nozoom src="https://img.shields.io/badge/Open%20on%20GitHub-grey?logo=github" alt="Open on GitHub"></a></p> <p>This is a nested chat re-implementation of <a href=https://github.com/microsoft/OptiGuide>OptiGuide</a>, which is an LLM-based supply chain optimization framework.</p> <p>In addition to AG2, this notebook also requires eventlet and Gurobipy. The eventlet package is used in this notebook to constrain code execution with a timeout, and the gurobipy package is a mathematical optimization software library for solving mixed-integer linear and quadratic optimization problems.</p> <div class="admonition info"> <p class=admonition-title>Requirements</p> <p>Some extra dependencies are needed for this notebook, which can be installed via pip:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>pip<span class=w> </span>install<span class=w> </span>ag2<span class=o>[</span>openai<span class=o>]</span><span class=w> </span>eventlet<span class=w> </span>gurobipy
</code></pre></div> <p>For more information, please refer to the <a href=https://docs.ag2.ai/latest/docs/user-guide/basic-concepts/installing-ag2>installation guide</a>.</p> </div> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>import</span><span class=w> </span><span class=nn>re</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Union</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=c1># import auxiliary packages</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>  <span class=c1># for loading the example source code</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=kn>from</span><span class=w> </span><span class=nn>eventlet.timeout</span><span class=w> </span><span class=kn>import</span> <span class=n>Timeout</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=c1># test Gurobi installation</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=kn>from</span><span class=w> </span><span class=nn>gurobipy</span><span class=w> </span><span class=kn>import</span> <span class=n>GRB</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=kn>from</span><span class=w> </span><span class=nn>termcolor</span><span class=w> </span><span class=kn>import</span> <span class=n>colored</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=kn>import</span><span class=w> </span><span class=nn>autogen</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.code_utils</span><span class=w> </span><span class=kn>import</span> <span class=n>extract_code</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>autogen</span><span class=o>.</span><span class=n>LLMConfig</span><span class=o>.</span><span class=n>from_json</span><span class=p>(</span><span class=n>path</span><span class=o>=</span><span class=s2>&quot;OAI_CONFIG_LIST&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>    <span class=n>model</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;gpt-4&quot;</span><span class=p>,</span> <span class=s2>&quot;gpt4&quot;</span><span class=p>,</span> <span class=s2>&quot;gpt-3.5-turbogpt-4-32k&quot;</span><span class=p>,</span> <span class=s2>&quot;gpt-4-32k-0314&quot;</span><span class=p>,</span> <span class=s2>&quot;gpt-4-32k-v0314&quot;</span><span class=p>]</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=p>)</span>
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Learn more about configuring LLMs for agents <a href=https://docs.ag2.ai/latest/docs/user-guide/basic-concepts/llm-configuration>here</a>.</p> </div> <p>Intended agent orchestration in OptiGuide.</p> <p><img alt src=../optiGuide_new_design.png></p> <h2 id=step-0-prepare-helper-functions>Step 0. Prepare Helper Functions<a class=headerlink href=#step-0-prepare-helper-functions title="Permanent link">#</a></h2> <p>The code cell below includes several helper functions to be used by agents. The helper functions are adopted directly from <a href=https://github.com/microsoft/OptiGuide>OptiGuide</a>.</p> <h3 id=utility-functions>Utility Functions<a class=headerlink href=#utility-functions title="Permanent link">#</a></h3> <p>Several utility functions (replace, insert_code, run_with_exec) are defined to manipulate and execute the source code dynamically:</p> <ul> <li> <p><strong>replace(src_code, old_code, new_code) -&gt; str:</strong><br>Replaces a specified block of code within the source code with new code. This is essential for updating the code dynamically based on chatbot and user interactions.</p> </li> <li> <p><strong>insert_code(src_code, new_lines) -&gt; str:</strong><br>Determines where to insert new lines of code based on specific markers in the source code. Itâ€™s used to seamlessly integrate generated code snippets.</p> </li> <li> <p><strong>run_with_exec(src_code) -&gt; Union[str, Exception]:</strong><br>Executes the modified source code within a controlled environment, capturing and returning the output or any errors that occur. This function is crucial for testing the feasibility and correctness of the generated code solutions.</p> </li> </ul> <h3 id=functions-external-code-retrieval>Functions External Code Retrieval<a class=headerlink href=#functions-external-code-retrieval title="Permanent link">#</a></h3> <p>The cell also includes logic to retrieve example source code from a remote repository using the requests library. This example code serves as a base for the chatbot to work with, allowing users to see real-life applications of the concepts discussed.</p> <p>The retrieved code is then displayed, showing both the beginning and the end of the source code to give a glimpse of its structure and content.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>def</span><span class=w> </span><span class=nf>replace</span><span class=p>(</span><span class=n>src_code</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>old_code</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_code</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Inserts new code into the source code by replacing a specified old</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=sd>    code block.</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=sd>    Args:</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=sd>        src_code (str): The source code to modify.</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=sd>        old_code (str): The code block to be replaced.</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=sd>        new_code (str): The new code block to insert.</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=sd>    Returns:</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=sd>        str: The modified source code with the new code inserted.</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=sd>    Raises:</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=sd>        None</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=sd>    Example:</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=sd>        src_code = &#39;def hello_world():\n    print(&quot;Hello, world!&quot;)\n\n# Some</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=sd>        other code here&#39;</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=sd>        old_code = &#39;print(&quot;Hello, world!&quot;)&#39;</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=sd>        new_code = &#39;print(&quot;Bonjour, monde!&quot;)\nprint(&quot;Hola, mundo!&quot;)&#39;</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=sd>        modified_code = _replace(src_code, old_code, new_code)</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=sd>        print(modified_code)</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=sd>        # Output:</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=sd>        # def hello_world():</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=sd>        #     print(&quot;Bonjour, monde!&quot;)</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=sd>        #     print(&quot;Hola, mundo!&quot;)</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=sd>        # Some other code here</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>    <span class=n>pattern</span> <span class=o>=</span> <span class=sa>rf</span><span class=s2>&quot;( *)</span><span class=si>{</span><span class=n>old_code</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>    <span class=n>head_spaces</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>src_code</span><span class=p>,</span> <span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>DOTALL</span><span class=p>)</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>    <span class=n>new_code</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>head_spaces</span> <span class=o>+</span> <span class=n>line</span> <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>new_code</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)])</span>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>    <span class=n>rst</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>new_code</span><span class=p>,</span> <span class=n>src_code</span><span class=p>)</span>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>    <span class=k>return</span> <span class=n>rst</span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=k>def</span><span class=w> </span><span class=nf>insert_code</span><span class=p>(</span><span class=n>src_code</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_lines</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Insert a code patch into the source code.</span>
<a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>
<a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a><span class=sd>    Args:</span>
<a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a><span class=sd>        src_code (str): the full source code</span>
<a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a><span class=sd>        new_lines (str): The new code.</span>
<a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a>
<a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a><span class=sd>    Returns:</span>
<a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=sd>        str: the full source code after insertion (replacement).</span>
<a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>    <span class=k>if</span> <span class=n>new_lines</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;addConstr&quot;</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a>        <span class=k>return</span> <span class=n>replace</span><span class=p>(</span><span class=n>src_code</span><span class=p>,</span> <span class=n>CONSTRAINT_CODE_STR</span><span class=p>,</span> <span class=n>new_lines</span><span class=p>)</span>
<a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a>        <span class=k>return</span> <span class=n>replace</span><span class=p>(</span><span class=n>src_code</span><span class=p>,</span> <span class=n>DATA_CODE_STR</span><span class=p>,</span> <span class=n>new_lines</span><span class=p>)</span>
<a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a>
<a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a><span class=k>def</span><span class=w> </span><span class=nf>run_with_exec</span><span class=p>(</span><span class=n>src_code</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=ne>Exception</span><span class=p>]:</span>
<a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Run the code snippet with exec.</span>
<a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a>
<a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a><span class=sd>    Args:</span>
<a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a><span class=sd>        src_code (str): The source code to run.</span>
<a id=__codelineno-2-55 name=__codelineno-2-55 href=#__codelineno-2-55></a>
<a id=__codelineno-2-56 name=__codelineno-2-56 href=#__codelineno-2-56></a><span class=sd>    Returns:</span>
<a id=__codelineno-2-57 name=__codelineno-2-57 href=#__codelineno-2-57></a><span class=sd>        object: The result of the code snippet.</span>
<a id=__codelineno-2-58 name=__codelineno-2-58 href=#__codelineno-2-58></a><span class=sd>            If the code succeed, returns the objective value (float or string).</span>
<a id=__codelineno-2-59 name=__codelineno-2-59 href=#__codelineno-2-59></a><span class=sd>            else, return the error (exception)</span>
<a id=__codelineno-2-60 name=__codelineno-2-60 href=#__codelineno-2-60></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-2-61 name=__codelineno-2-61 href=#__codelineno-2-61></a>    <span class=n>locals_dict</span> <span class=o>=</span> <span class=p>{}</span>
<a id=__codelineno-2-62 name=__codelineno-2-62 href=#__codelineno-2-62></a>    <span class=n>locals_dict</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>globals</span><span class=p>())</span>
<a id=__codelineno-2-63 name=__codelineno-2-63 href=#__codelineno-2-63></a>    <span class=n>locals_dict</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>locals</span><span class=p>())</span>
<a id=__codelineno-2-64 name=__codelineno-2-64 href=#__codelineno-2-64></a>
<a id=__codelineno-2-65 name=__codelineno-2-65 href=#__codelineno-2-65></a>    <span class=n>timeout</span> <span class=o>=</span> <span class=n>Timeout</span><span class=p>(</span>
<a id=__codelineno-2-66 name=__codelineno-2-66 href=#__codelineno-2-66></a>        <span class=mi>60</span><span class=p>,</span>
<a id=__codelineno-2-67 name=__codelineno-2-67 href=#__codelineno-2-67></a>        <span class=ne>TimeoutError</span><span class=p>(</span><span class=s2>&quot;This is a timeout exception, in case GPT&#39;s code falls into infinite loop.&quot;</span><span class=p>),</span>
<a id=__codelineno-2-68 name=__codelineno-2-68 href=#__codelineno-2-68></a>    <span class=p>)</span>
<a id=__codelineno-2-69 name=__codelineno-2-69 href=#__codelineno-2-69></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-2-70 name=__codelineno-2-70 href=#__codelineno-2-70></a>        <span class=n>exec</span><span class=p>(</span><span class=n>src_code</span><span class=p>,</span> <span class=n>locals_dict</span><span class=p>,</span> <span class=n>locals_dict</span><span class=p>)</span>
<a id=__codelineno-2-71 name=__codelineno-2-71 href=#__codelineno-2-71></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-2-72 name=__codelineno-2-72 href=#__codelineno-2-72></a>        <span class=k>return</span> <span class=n>e</span>
<a id=__codelineno-2-73 name=__codelineno-2-73 href=#__codelineno-2-73></a>    <span class=k>finally</span><span class=p>:</span>
<a id=__codelineno-2-74 name=__codelineno-2-74 href=#__codelineno-2-74></a>        <span class=n>timeout</span><span class=o>.</span><span class=n>cancel</span><span class=p>()</span>
<a id=__codelineno-2-75 name=__codelineno-2-75 href=#__codelineno-2-75></a>
<a id=__codelineno-2-76 name=__codelineno-2-76 href=#__codelineno-2-76></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-2-77 name=__codelineno-2-77 href=#__codelineno-2-77></a>        <span class=n>status</span> <span class=o>=</span> <span class=n>locals_dict</span><span class=p>[</span><span class=s2>&quot;m&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>Status</span>
<a id=__codelineno-2-78 name=__codelineno-2-78 href=#__codelineno-2-78></a>        <span class=k>if</span> <span class=n>status</span> <span class=o>!=</span> <span class=n>GRB</span><span class=o>.</span><span class=n>OPTIMAL</span><span class=p>:</span>
<a id=__codelineno-2-79 name=__codelineno-2-79 href=#__codelineno-2-79></a>            <span class=k>if</span> <span class=n>status</span> <span class=o>==</span> <span class=n>GRB</span><span class=o>.</span><span class=n>UNBOUNDED</span><span class=p>:</span>
<a id=__codelineno-2-80 name=__codelineno-2-80 href=#__codelineno-2-80></a>                <span class=n>ans</span> <span class=o>=</span> <span class=s2>&quot;unbounded&quot;</span>
<a id=__codelineno-2-81 name=__codelineno-2-81 href=#__codelineno-2-81></a>            <span class=k>elif</span> <span class=n>status</span> <span class=o>==</span> <span class=n>GRB</span><span class=o>.</span><span class=n>INF_OR_UNBD</span><span class=p>:</span>
<a id=__codelineno-2-82 name=__codelineno-2-82 href=#__codelineno-2-82></a>                <span class=n>ans</span> <span class=o>=</span> <span class=s2>&quot;inf_or_unbound&quot;</span>
<a id=__codelineno-2-83 name=__codelineno-2-83 href=#__codelineno-2-83></a>            <span class=k>elif</span> <span class=n>status</span> <span class=o>==</span> <span class=n>GRB</span><span class=o>.</span><span class=n>INFEASIBLE</span><span class=p>:</span>
<a id=__codelineno-2-84 name=__codelineno-2-84 href=#__codelineno-2-84></a>                <span class=n>ans</span> <span class=o>=</span> <span class=s2>&quot;infeasible&quot;</span>
<a id=__codelineno-2-85 name=__codelineno-2-85 href=#__codelineno-2-85></a>                <span class=n>m</span> <span class=o>=</span> <span class=n>locals_dict</span><span class=p>[</span><span class=s2>&quot;m&quot;</span><span class=p>]</span>
<a id=__codelineno-2-86 name=__codelineno-2-86 href=#__codelineno-2-86></a>                <span class=n>m</span><span class=o>.</span><span class=n>computeIIS</span><span class=p>()</span>
<a id=__codelineno-2-87 name=__codelineno-2-87 href=#__codelineno-2-87></a>                <span class=n>constrs</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>ConstrName</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>m</span><span class=o>.</span><span class=n>getConstrs</span><span class=p>()</span> <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>IISConstr</span><span class=p>]</span>
<a id=__codelineno-2-88 name=__codelineno-2-88 href=#__codelineno-2-88></a>                <span class=n>ans</span> <span class=o>+=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Conflicting Constraints:</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>constrs</span><span class=p>)</span>
<a id=__codelineno-2-89 name=__codelineno-2-89 href=#__codelineno-2-89></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-2-90 name=__codelineno-2-90 href=#__codelineno-2-90></a>                <span class=n>ans</span> <span class=o>=</span> <span class=s2>&quot;Model Status:&quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>status</span><span class=p>)</span>
<a id=__codelineno-2-91 name=__codelineno-2-91 href=#__codelineno-2-91></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-2-92 name=__codelineno-2-92 href=#__codelineno-2-92></a>            <span class=n>ans</span> <span class=o>=</span> <span class=s2>&quot;Optimization problem solved. The objective value is: &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>locals_dict</span><span class=p>[</span><span class=s2>&quot;m&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>objVal</span><span class=p>)</span>
<a id=__codelineno-2-93 name=__codelineno-2-93 href=#__codelineno-2-93></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-2-94 name=__codelineno-2-94 href=#__codelineno-2-94></a>        <span class=k>return</span> <span class=n>e</span>
<a id=__codelineno-2-95 name=__codelineno-2-95 href=#__codelineno-2-95></a>
<a id=__codelineno-2-96 name=__codelineno-2-96 href=#__codelineno-2-96></a>    <span class=k>return</span> <span class=n>ans</span>
</code></pre></div> <h2 id=step-1-agent-construction>Step 1. Agent Construction<a class=headerlink href=#step-1-agent-construction title="Permanent link">#</a></h2> <p>This cell introduces the Writer and OptiGuide agent classes and their instances to manage the interaction between the user, the chatbot, and the optimization solver. This streamlines the process of generating, evaluating, and integrating code solutions for supply chain optimization problems.</p> <h3 id=classes-defined>Classes Defined<a class=headerlink href=#classes-defined title="Permanent link">#</a></h3> <ul> <li> <p><strong><code>OptiGuide</code></strong>: Inherits from <code>autogen.AssistantAgent</code> and serves as the main class for handling the supply chain optimization logic. It maintains state information like the source code, debugging attempts left, success status, and user chat history. Key methods include <code>set_success</code> and <code>update_debug_times</code>, which are used to update the agentâ€™s state based on the outcomes of interactions.</p> </li> <li> <p><strong><code>Writer</code></strong>: Also inherits from <code>autogen.AssistantAgent</code>, this class is tailored to manage the generation and explanation of Python code solutions. It keeps track of the source code and example Q&amp;A to assist in generating responses to user queries.</p> </li> </ul> <h3 id=agent-instances>Agent Instances<a class=headerlink href=#agent-instances title="Permanent link">#</a></h3> <ul> <li> <p><strong><code>writer</code></strong>, <strong><code>safeguard</code></strong>, and <strong><code>optiguide_commander</code></strong>: Instances of the classes defined above, each configured with specific roles in the code generation and evaluation process. These agents work together to ensure that the userâ€™s questions are answered with safe, optimized, and understandable Python code solutions.</p> </li> <li> <p><strong><code>user</code></strong>: An instance of <code>autogen.UserProxyAgent</code>, representing the end-user interacting with the notebook. Itâ€™s configured to simulate user inputs and responses, facilitating an interactive and engaging learning experience.</p> </li> </ul> <h4 id=agent-system-messages>Agent System Messages<a class=headerlink href=#agent-system-messages title="Permanent link">#</a></h4> <p>Each agent is associated with a corresponding system message. Those system messages are adopted directly from <a href=https://github.com/microsoft/OptiGuide>OptiGuide</a>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># %% System Messages</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>WRITER_SYSTEM_MSG</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;You are a chatbot to:</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=s2>(1) write Python code to answer users questions for supply chain-related coding</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=s2>project;</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=s2>(2) explain solutions from a Gurobi/Python solver.</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=s2>--- SOURCE CODE ---</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=si>{source_code}</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=s2>--- DOC STR ---</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=si>{doc_str}</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=s2>---</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=s2>Here are some example questions and their answers and codes:</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=s2>--- EXAMPLES ---</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=si>{example_qa}</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=s2>---</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=s2>The execution result of the original source code is below.</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=s2>--- Original Result ---</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=si>{execution_result}</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=s2>Note that your written code will be added to the lines with substring:</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=s2>&quot;# OPTIGUIDE *** CODE GOES HERE&quot;</span>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=s2>So, you don&#39;t need to write other code, such as m.optimize() or m.update().</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=s2>You just need to write code snippet in ```python ...``` block.</span>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a><span class=n>SAFEGUARD_SYSTEM_MSG</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a><span class=s2>Given the source code:</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=si>{source_code}</span>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=s2>Is the source code safe (not malicious code to break security</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a><span class=s2>and privacy) to run?</span>
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a><span class=s2>Answer only one word.</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a><span class=s2>If not safe, answer `DANGER`; else, answer `SAFE`.</span>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a><span class=c1># %% Constant strings to match code lines in the source code.</span>
<a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a><span class=n>DATA_CODE_STR</span> <span class=o>=</span> <span class=s2>&quot;# OPTIGUIDE DATA CODE GOES HERE&quot;</span>
<a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a><span class=n>CONSTRAINT_CODE_STR</span> <span class=o>=</span> <span class=s2>&quot;# OPTIGUIDE CONSTRAINT CODE GOES HERE&quot;</span>
<a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a>
<a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a><span class=c1># In-context learning examples.</span>
<a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a><span class=n>example_qa</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a><span class=s2>----------</span>
<a id=__codelineno-3-46 name=__codelineno-3-46 href=#__codelineno-3-46></a><span class=s2>Question: Why is it not recommended to use just one supplier for roastery 2?</span>
<a id=__codelineno-3-47 name=__codelineno-3-47 href=#__codelineno-3-47></a><span class=s2>Answer Code:</span>
<a id=__codelineno-3-48 name=__codelineno-3-48 href=#__codelineno-3-48></a><span class=s2>```python</span>
<a id=__codelineno-3-49 name=__codelineno-3-49 href=#__codelineno-3-49></a><span class=s2>z = m.addVars(suppliers, vtype=GRB.BINARY, name=&quot;z&quot;)</span>
<a id=__codelineno-3-50 name=__codelineno-3-50 href=#__codelineno-3-50></a><span class=s2>m.addConstr(sum(z[s] for s in suppliers) &lt;= 1, &quot;_&quot;)</span>
<a id=__codelineno-3-51 name=__codelineno-3-51 href=#__codelineno-3-51></a><span class=s2>for s in suppliers:</span>
<a id=__codelineno-3-52 name=__codelineno-3-52 href=#__codelineno-3-52></a><span class=s2>    m.addConstr(x[s,&#39;roastery2&#39;] &lt;= capacity_in_supplier[s] * z[s], &quot;_&quot;)</span>
<a id=__codelineno-3-53 name=__codelineno-3-53 href=#__codelineno-3-53></a><span class=s2>```</span>
<a id=__codelineno-3-54 name=__codelineno-3-54 href=#__codelineno-3-54></a>
<a id=__codelineno-3-55 name=__codelineno-3-55 href=#__codelineno-3-55></a><span class=s2>----------</span>
<a id=__codelineno-3-56 name=__codelineno-3-56 href=#__codelineno-3-56></a><span class=s2>Question: What if there&#39;s a 13% jump in the demand for light coffee at cafe1?</span>
<a id=__codelineno-3-57 name=__codelineno-3-57 href=#__codelineno-3-57></a><span class=s2>Answer Code:</span>
<a id=__codelineno-3-58 name=__codelineno-3-58 href=#__codelineno-3-58></a><span class=s2>```python</span>
<a id=__codelineno-3-59 name=__codelineno-3-59 href=#__codelineno-3-59></a><span class=s2>light_coffee_needed_for_cafe[&quot;cafe1&quot;] = light_coffee_needed_for_cafe[&quot;cafe1&quot;] * (1 + 13/100)</span>
<a id=__codelineno-3-60 name=__codelineno-3-60 href=#__codelineno-3-60></a><span class=s2>```</span>
<a id=__codelineno-3-61 name=__codelineno-3-61 href=#__codelineno-3-61></a>
<a id=__codelineno-3-62 name=__codelineno-3-62 href=#__codelineno-3-62></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-63 name=__codelineno-3-63 href=#__codelineno-3-63></a>
<a id=__codelineno-3-64 name=__codelineno-3-64 href=#__codelineno-3-64></a><span class=n>CODE_PROMPT</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-65 name=__codelineno-3-65 href=#__codelineno-3-65></a><span class=s2>Answer Code:</span>
<a id=__codelineno-3-66 name=__codelineno-3-66 href=#__codelineno-3-66></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-67 name=__codelineno-3-67 href=#__codelineno-3-67></a>
<a id=__codelineno-3-68 name=__codelineno-3-68 href=#__codelineno-3-68></a><span class=n>DEBUG_PROMPT</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-69 name=__codelineno-3-69 href=#__codelineno-3-69></a>
<a id=__codelineno-3-70 name=__codelineno-3-70 href=#__codelineno-3-70></a><span class=s2>While running the code you suggested, I encountered the </span><span class=si>{error_type}</span><span class=s2>:</span>
<a id=__codelineno-3-71 name=__codelineno-3-71 href=#__codelineno-3-71></a><span class=s2>--- ERROR MESSAGE ---</span>
<a id=__codelineno-3-72 name=__codelineno-3-72 href=#__codelineno-3-72></a><span class=si>{error_message}</span>
<a id=__codelineno-3-73 name=__codelineno-3-73 href=#__codelineno-3-73></a>
<a id=__codelineno-3-74 name=__codelineno-3-74 href=#__codelineno-3-74></a><span class=s2>Please try to resolve this bug, and rewrite the code snippet.</span>
<a id=__codelineno-3-75 name=__codelineno-3-75 href=#__codelineno-3-75></a><span class=s2>--- NEW CODE ---</span>
<a id=__codelineno-3-76 name=__codelineno-3-76 href=#__codelineno-3-76></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-77 name=__codelineno-3-77 href=#__codelineno-3-77></a>
<a id=__codelineno-3-78 name=__codelineno-3-78 href=#__codelineno-3-78></a><span class=n>SAFEGUARD_PROMPT</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-79 name=__codelineno-3-79 href=#__codelineno-3-79></a><span class=s2>--- Code ---</span>
<a id=__codelineno-3-80 name=__codelineno-3-80 href=#__codelineno-3-80></a><span class=si>{code}</span>
<a id=__codelineno-3-81 name=__codelineno-3-81 href=#__codelineno-3-81></a>
<a id=__codelineno-3-82 name=__codelineno-3-82 href=#__codelineno-3-82></a><span class=s2>--- One-Word Answer: SAFE or DANGER ---</span>
<a id=__codelineno-3-83 name=__codelineno-3-83 href=#__codelineno-3-83></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-84 name=__codelineno-3-84 href=#__codelineno-3-84></a>
<a id=__codelineno-3-85 name=__codelineno-3-85 href=#__codelineno-3-85></a><span class=n>INTERPRETER_PROMPT</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;Here are the execution results: </span><span class=si>{execution_rst}</span>
<a id=__codelineno-3-86 name=__codelineno-3-86 href=#__codelineno-3-86></a>
<a id=__codelineno-3-87 name=__codelineno-3-87 href=#__codelineno-3-87></a><span class=s2>Can you organize these information to a human readable answer?</span>
<a id=__codelineno-3-88 name=__codelineno-3-88 href=#__codelineno-3-88></a><span class=s2>Remember to compare the new results to the original results you obtained in the</span>
<a id=__codelineno-3-89 name=__codelineno-3-89 href=#__codelineno-3-89></a><span class=s2>beginning.</span>
<a id=__codelineno-3-90 name=__codelineno-3-90 href=#__codelineno-3-90></a>
<a id=__codelineno-3-91 name=__codelineno-3-91 href=#__codelineno-3-91></a><span class=s2>--- HUMAN READABLE ANSWER ---</span>
<a id=__codelineno-3-92 name=__codelineno-3-92 href=#__codelineno-3-92></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-3-93 name=__codelineno-3-93 href=#__codelineno-3-93></a>
<a id=__codelineno-3-94 name=__codelineno-3-94 href=#__codelineno-3-94></a><span class=c1># Get the source code of the coffee example from OptiGuide&#39;s official repo</span>
<a id=__codelineno-3-95 name=__codelineno-3-95 href=#__codelineno-3-95></a><span class=n>code_url</span> <span class=o>=</span> <span class=s2>&quot;https://raw.githubusercontent.com/microsoft/OptiGuide/main/benchmark/application/coffee.py&quot;</span>
<a id=__codelineno-3-96 name=__codelineno-3-96 href=#__codelineno-3-96></a><span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>code_url</span><span class=p>)</span>
<a id=__codelineno-3-97 name=__codelineno-3-97 href=#__codelineno-3-97></a><span class=c1># Check if the request was successful</span>
<a id=__codelineno-3-98 name=__codelineno-3-98 href=#__codelineno-3-98></a><span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
<a id=__codelineno-3-99 name=__codelineno-3-99 href=#__codelineno-3-99></a>    <span class=c1># Get the text content from the response</span>
<a id=__codelineno-3-100 name=__codelineno-3-100 href=#__codelineno-3-100></a>    <span class=n>code</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span>
<a id=__codelineno-3-101 name=__codelineno-3-101 href=#__codelineno-3-101></a><span class=k>else</span><span class=p>:</span>
<a id=__codelineno-3-102 name=__codelineno-3-102 href=#__codelineno-3-102></a>    <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;Failed to retrieve the file.&quot;</span><span class=p>)</span>
<a id=__codelineno-3-103 name=__codelineno-3-103 href=#__codelineno-3-103></a><span class=c1># code = open(code_url, &quot;r&quot;).read() # for local files</span>
<a id=__codelineno-3-104 name=__codelineno-3-104 href=#__codelineno-3-104></a>
<a id=__codelineno-3-105 name=__codelineno-3-105 href=#__codelineno-3-105></a><span class=c1># show the first head and tail of the source code</span>
<a id=__codelineno-3-106 name=__codelineno-3-106 href=#__codelineno-3-106></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>code</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)[:</span><span class=mi>10</span><span class=p>]))</span>
<a id=__codelineno-3-107 name=__codelineno-3-107 href=#__codelineno-3-107></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;.</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=o>*</span> <span class=mi>3</span><span class=p>)</span>
<a id=__codelineno-3-108 name=__codelineno-3-108 href=#__codelineno-3-108></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>code</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>10</span><span class=p>:]))</span>
<a id=__codelineno-3-109 name=__codelineno-3-109 href=#__codelineno-3-109></a>
<a id=__codelineno-3-110 name=__codelineno-3-110 href=#__codelineno-3-110></a><span class=n>writer_system_msg</span> <span class=o>=</span> <span class=n>WRITER_SYSTEM_MSG</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
<a id=__codelineno-3-111 name=__codelineno-3-111 href=#__codelineno-3-111></a>    <span class=n>source_code</span><span class=o>=</span><span class=n>code</span><span class=p>,</span>
<a id=__codelineno-3-112 name=__codelineno-3-112 href=#__codelineno-3-112></a>    <span class=n>doc_str</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-3-113 name=__codelineno-3-113 href=#__codelineno-3-113></a>    <span class=n>example_qa</span><span class=o>=</span><span class=n>example_qa</span><span class=p>,</span>
<a id=__codelineno-3-114 name=__codelineno-3-114 href=#__codelineno-3-114></a>    <span class=n>execution_result</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-3-115 name=__codelineno-3-115 href=#__codelineno-3-115></a><span class=p>)</span>
<a id=__codelineno-3-116 name=__codelineno-3-116 href=#__codelineno-3-116></a><span class=n>safeguard_system_msg</span> <span class=o>=</span> <span class=n>SAFEGUARD_SYSTEM_MSG</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_code</span><span class=o>=</span><span class=n>code</span><span class=p>)</span>
<a id=__codelineno-3-117 name=__codelineno-3-117 href=#__codelineno-3-117></a>
<a id=__codelineno-3-118 name=__codelineno-3-118 href=#__codelineno-3-118></a><span class=k>class</span><span class=w> </span><span class=nc>OptiGuide</span><span class=p>(</span><span class=n>autogen</span><span class=o>.</span><span class=n>AssistantAgent</span><span class=p>):</span>
<a id=__codelineno-3-119 name=__codelineno-3-119 href=#__codelineno-3-119></a>    <span class=n>source_code</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>code</span>
<a id=__codelineno-3-120 name=__codelineno-3-120 href=#__codelineno-3-120></a>    <span class=n>debug_times</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span>
<a id=__codelineno-3-121 name=__codelineno-3-121 href=#__codelineno-3-121></a>    <span class=n>debug_times_left</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span>
<a id=__codelineno-3-122 name=__codelineno-3-122 href=#__codelineno-3-122></a>    <span class=n>example_qa</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-3-123 name=__codelineno-3-123 href=#__codelineno-3-123></a>    <span class=n>success</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-3-124 name=__codelineno-3-124 href=#__codelineno-3-124></a>    <span class=n>user_chat_history</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-3-125 name=__codelineno-3-125 href=#__codelineno-3-125></a>
<a id=__codelineno-3-126 name=__codelineno-3-126 href=#__codelineno-3-126></a><span class=k>class</span><span class=w> </span><span class=nc>Writer</span><span class=p>(</span><span class=n>autogen</span><span class=o>.</span><span class=n>AssistantAgent</span><span class=p>):</span>
<a id=__codelineno-3-127 name=__codelineno-3-127 href=#__codelineno-3-127></a>    <span class=n>source_code</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>code</span>
<a id=__codelineno-3-128 name=__codelineno-3-128 href=#__codelineno-3-128></a>    <span class=n>example_qa</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-3-129 name=__codelineno-3-129 href=#__codelineno-3-129></a>    <span class=n>user_chat_history</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-3-130 name=__codelineno-3-130 href=#__codelineno-3-130></a>
<a id=__codelineno-3-131 name=__codelineno-3-131 href=#__codelineno-3-131></a><span class=n>writer</span> <span class=o>=</span> <span class=n>Writer</span><span class=p>(</span><span class=s2>&quot;writer&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-3-132 name=__codelineno-3-132 href=#__codelineno-3-132></a><span class=n>safeguard</span> <span class=o>=</span> <span class=n>autogen</span><span class=o>.</span><span class=n>AssistantAgent</span><span class=p>(</span><span class=s2>&quot;safeguard&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-3-133 name=__codelineno-3-133 href=#__codelineno-3-133></a><span class=n>optiguide_commander</span> <span class=o>=</span> <span class=n>OptiGuide</span><span class=p>(</span><span class=s2>&quot;commander&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>)</span>
<a id=__codelineno-3-134 name=__codelineno-3-134 href=#__codelineno-3-134></a>
<a id=__codelineno-3-135 name=__codelineno-3-135 href=#__codelineno-3-135></a><span class=n>user</span> <span class=o>=</span> <span class=n>autogen</span><span class=o>.</span><span class=n>UserProxyAgent</span><span class=p>(</span>
<a id=__codelineno-3-136 name=__codelineno-3-136 href=#__codelineno-3-136></a>    <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=n>max_consecutive_auto_reply</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span> <span class=n>code_execution_config</span><span class=o>=</span><span class=kc>False</span>
<a id=__codelineno-3-137 name=__codelineno-3-137 href=#__codelineno-3-137></a><span class=p>)</span>
</code></pre></div> <h2 id=step-2-orchestrate-nested-chats>Step 2. Orchestrate Nested Chats<a class=headerlink href=#step-2-orchestrate-nested-chats title="Permanent link">#</a></h2> <p>These three agent instances are orchestrated in the following way with the <code>writer</code> and <code>safeguard</code> nested into the <code>commander</code> agent as the inner monologue.</p> <p>This next cell defines critical functions that manage the interactions between the <code>OptiGuide</code> system, the user, and the internal logic for processing and responding to queries. Each function plays a specific role in guiding the conversation, handling code generation requests, ensuring code safety, and summarizing outcomes. This ensures that agents receive clear instructions, immediate feedback, and a secure environment for exploring supply chain optimization problems through code.</p> <p>Information about the sequence of chats can be specified in the <code>chat_queue</code> argument of the <code>register_nested_chats</code> function. The following fields are especially useful: - <code>recipient</code> (required) specifies the nested agent; - <code>message</code> specifies what message to send to the nested recipient agent. In a sequence of nested chats, if the <code>message</code> field is not specified, we will use the last message the registering agent received as the initial message in the first chat and will skip any subsequent chat in the queue that does not have the <code>message</code> field. You can either provide a string or define a callable that returns a string. - <code>summary_method</code> decides what to get out of the nested chat. You can either select from existing options including â€œlast_msgâ€ and â€œreflection_with_llmâ€, or or define your own way on what to get from the nested chat with a Callable. - <code>max_turns</code> determines how many turns of conversation to have between the concerned agent pairs.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>def</span><span class=w> </span><span class=nf>writer_init_message</span><span class=p>(</span><span class=n>recipient</span><span class=p>,</span> <span class=n>messages</span><span class=p>,</span> <span class=n>sender</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=k>if</span> <span class=n>recipient</span><span class=o>.</span><span class=n>success</span><span class=p>:</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>        <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>msg_content</span> <span class=o>=</span> <span class=n>messages</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=c1># board = config</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>    <span class=c1># get execution result of the original source code</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=n>sender_history</span> <span class=o>=</span> <span class=n>recipient</span><span class=o>.</span><span class=n>chat_messages</span><span class=p>[</span><span class=n>sender</span><span class=p>]</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=n>user_chat_history</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Here are the history of discussions:</span><span class=se>\n</span><span class=si>{</span><span class=n>sender_history</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>    <span class=c1># TODO: get the execution result of the original source code</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>    <span class=n>execution_result</span> <span class=o>=</span> <span class=n>msg_content</span> <span class=k>if</span> <span class=n>sender</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&quot;user&quot;</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>    <span class=n>writer_sys_msg</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>        <span class=n>WRITER_SYSTEM_MSG</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>            <span class=n>source_code</span><span class=o>=</span><span class=n>recipient</span><span class=o>.</span><span class=n>source_code</span><span class=p>,</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>            <span class=n>doc_str</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>            <span class=n>example_qa</span><span class=o>=</span><span class=n>example_qa</span><span class=p>,</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>            <span class=n>execution_result</span><span class=o>=</span><span class=n>execution_result</span><span class=p>,</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>        <span class=p>)</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>        <span class=o>+</span> <span class=n>user_chat_history</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>    <span class=p>)</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>    <span class=c1># safeguard.reset() #TODO: reset safeguard</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>    <span class=n>recipient</span><span class=o>.</span><span class=n>debug_times_left</span> <span class=o>=</span> <span class=n>recipient</span><span class=o>.</span><span class=n>debug_times</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>    <span class=n>recipient</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>    <span class=k>return</span> <span class=n>writer_sys_msg</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=o>+</span> <span class=n>CODE_PROMPT</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=k>def</span><span class=w> </span><span class=nf>writer_success_summary</span><span class=p>(</span><span class=n>recipient</span><span class=p>,</span> <span class=n>sender</span><span class=p>):</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>    <span class=k>if</span> <span class=n>sender</span><span class=o>.</span><span class=n>success</span><span class=p>:</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>        <span class=k>return</span> <span class=n>sender</span><span class=o>.</span><span class=n>last_message</span><span class=p>(</span><span class=n>recipient</span><span class=p>)[</span><span class=s2>&quot;content&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;TERMINATE&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>        <span class=k>return</span> <span class=s2>&quot;Sorry. I cannot answer your question.&quot;</span>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=k>def</span><span class=w> </span><span class=nf>safeguard_init_message</span><span class=p>(</span><span class=n>recipient</span><span class=p>,</span> <span class=n>messages</span><span class=p>,</span> <span class=n>sender</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>    <span class=k>if</span> <span class=n>recipient</span><span class=o>.</span><span class=n>success</span><span class=p>:</span>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>        <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>    <span class=n>last_msg_content</span> <span class=o>=</span> <span class=n>messages</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>    <span class=n>_</span><span class=p>,</span> <span class=n>code</span> <span class=o>=</span> <span class=n>extract_code</span><span class=p>(</span><span class=n>last_msg_content</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>    <span class=k>if</span> <span class=n>_</span> <span class=o>!=</span> <span class=s2>&quot;unknown&quot;</span><span class=p>:</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>        <span class=k>return</span> <span class=n>SAFEGUARD_SYSTEM_MSG</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>source_code</span><span class=o>=</span><span class=n>code</span><span class=p>)</span> <span class=o>+</span> <span class=n>sender</span><span class=o>.</span><span class=n>user_chat_history</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>        <span class=k>return</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>        <span class=c1># return SAFEGUARD_SYSTEM_MSG.format(source_code=recipient.source_code)</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a><span class=k>def</span><span class=w> </span><span class=nf>safeguard_summary</span><span class=p>(</span><span class=n>recipient</span><span class=p>,</span> <span class=n>sender</span><span class=p>):</span>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>    <span class=n>safe_msg</span> <span class=o>=</span> <span class=n>sender</span><span class=o>.</span><span class=n>last_message</span><span class=p>(</span><span class=n>recipient</span><span class=p>)[</span><span class=s2>&quot;content&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;TERMINATE&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a>    <span class=k>if</span> <span class=n>safe_msg</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;DANGER&quot;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a>        <span class=c1># Step 4 and 5: Run the code and obtain the results</span>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a>        <span class=n>src_code</span> <span class=o>=</span> <span class=n>insert_code</span><span class=p>(</span><span class=n>sender</span><span class=o>.</span><span class=n>source_code</span><span class=p>,</span> <span class=n>code</span><span class=p>)</span>
<a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a>        <span class=n>execution_rst</span> <span class=o>=</span> <span class=n>run_with_exec</span><span class=p>(</span><span class=n>src_code</span><span class=p>)</span>
<a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a>        <span class=nb>print</span><span class=p>(</span><span class=n>colored</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>execution_rst</span><span class=p>),</span> <span class=s2>&quot;yellow&quot;</span><span class=p>))</span>
<a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a>        <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>execution_rst</span><span class=p>)</span> <span class=ow>in</span> <span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
<a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a>            <span class=c1># we successfully run the code and get the result</span>
<a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a>            <span class=n>sender</span><span class=o>.</span><span class=n>success</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a>            <span class=c1># Step 6: request to interpret results</span>
<a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a>            <span class=k>return</span> <span class=n>INTERPRETER_PROMPT</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>execution_rst</span><span class=o>=</span><span class=n>execution_rst</span><span class=p>)</span>
<a id=__codelineno-4-58 name=__codelineno-4-58 href=#__codelineno-4-58></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-4-59 name=__codelineno-4-59 href=#__codelineno-4-59></a>        <span class=c1># DANGER: If not safe, try to debug. Redo coding</span>
<a id=__codelineno-4-60 name=__codelineno-4-60 href=#__codelineno-4-60></a>        <span class=n>execution_rst</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-4-61 name=__codelineno-4-61 href=#__codelineno-4-61></a><span class=s2>        Sorry, this new code is not safe to run. I would not allow you to execute it.</span>
<a id=__codelineno-4-62 name=__codelineno-4-62 href=#__codelineno-4-62></a><span class=s2>        Please try to find a new way (coding) to answer the question.&quot;&quot;&quot;</span>
<a id=__codelineno-4-63 name=__codelineno-4-63 href=#__codelineno-4-63></a>        <span class=k>if</span> <span class=n>sender</span><span class=o>.</span><span class=n>debug_times_left</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-4-64 name=__codelineno-4-64 href=#__codelineno-4-64></a>            <span class=c1># Try to debug and write code again (back to step 2)</span>
<a id=__codelineno-4-65 name=__codelineno-4-65 href=#__codelineno-4-65></a>            <span class=n>sender</span><span class=o>.</span><span class=n>debug_times_left</span> <span class=o>-=</span> <span class=mi>1</span>
<a id=__codelineno-4-66 name=__codelineno-4-66 href=#__codelineno-4-66></a>            <span class=k>return</span> <span class=n>DEBUG_PROMPT</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>error_type</span><span class=o>=</span><span class=nb>type</span><span class=p>(</span><span class=n>execution_rst</span><span class=p>),</span> <span class=n>error_message</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>execution_rst</span><span class=p>))</span>
<a id=__codelineno-4-67 name=__codelineno-4-67 href=#__codelineno-4-67></a>
<a id=__codelineno-4-68 name=__codelineno-4-68 href=#__codelineno-4-68></a><span class=n>writer_chat_queue</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>writer</span><span class=p>,</span> <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=n>writer_init_message</span><span class=p>,</span> <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=n>writer_success_summary</span><span class=p>}]</span>
<a id=__codelineno-4-69 name=__codelineno-4-69 href=#__codelineno-4-69></a><span class=n>safeguard_chat_queue</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-4-70 name=__codelineno-4-70 href=#__codelineno-4-70></a>    <span class=p>{</span><span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>safeguard</span><span class=p>,</span> <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=n>safeguard_init_message</span><span class=p>,</span> <span class=s2>&quot;max_turns&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;summary_method&quot;</span><span class=p>:</span> <span class=n>safeguard_summary</span><span class=p>}</span>
<a id=__codelineno-4-71 name=__codelineno-4-71 href=#__codelineno-4-71></a><span class=p>]</span>
<a id=__codelineno-4-72 name=__codelineno-4-72 href=#__codelineno-4-72></a><span class=c1># safeguard is triggered only when receiving a message from the writer</span>
<a id=__codelineno-4-73 name=__codelineno-4-73 href=#__codelineno-4-73></a><span class=n>optiguide_commander</span><span class=o>.</span><span class=n>register_nested_chats</span><span class=p>(</span><span class=n>safeguard_chat_queue</span><span class=p>,</span> <span class=n>trigger</span><span class=o>=</span><span class=s2>&quot;writer&quot;</span><span class=p>)</span>
<a id=__codelineno-4-74 name=__codelineno-4-74 href=#__codelineno-4-74></a><span class=c1># writer is triggered only when receiving a message from the user</span>
<a id=__codelineno-4-75 name=__codelineno-4-75 href=#__codelineno-4-75></a><span class=n>optiguide_commander</span><span class=o>.</span><span class=n>register_nested_chats</span><span class=p>(</span><span class=n>writer_chat_queue</span><span class=p>,</span> <span class=n>trigger</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=let-the-agents-talk>Let the agents talk<a class=headerlink href=#let-the-agents-talk title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>chat_res</span> <span class=o>=</span> <span class=n>user</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=n>optiguide_commander</span><span class=p>,</span> <span class=n>message</span><span class=o>=</span><span class=s2>&quot;What if we prohibit shipping from supplier 1 to roastery 2?&quot;</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=p>)</span>
</code></pre></div> <h3 id=get-final-results-from-the-returned-chatresult-object>Get Final Results from the Returned ChatResult Object<a class=headerlink href=#get-final-results-from-the-returned-chatresult-object title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nb>print</span><span class=p>(</span><span class=n>chat_res</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-05-08T13:42:09+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-05-08</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../autogen_uniformed_api_calling/ class="md-footer__link md-footer__link--prev" aria-label="Previous: A Uniform interface to call different LLMs"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> A Uniform interface to call different LLMs </div> </div> </a> <a href=../agentchat_nested_chats_chess_altmodels/ class="md-footer__link md-footer__link--next" aria-label="Next: Conversational Chess using non-OpenAI clients"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Conversational Chess using non-OpenAI clients </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../../../js/timeago.min.js></script> <script src=../../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>