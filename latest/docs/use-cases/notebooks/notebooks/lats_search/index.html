<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Language Agent Tree Search."><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://docs.ag2.ai/latest/docs/use-cases/notebooks/notebooks/lats_search/ rel=canonical><link href=../agentchat_tabular_data_rag_workflow/ rel=prev><link href=../config_loader_utility_functions/ rel=next><link rel=icon href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>Language Agent Tree Search - AG2</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../css/timeago.css><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../stylesheets/extra.ff0633.min.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - Language Agent Tree Search"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://docs.ag2.ai/latest/docs/use-cases/notebooks/notebooks/lats_search/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - Language Agent Tree Search"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon-dark.svg type=image/x-icon media="(prefers-color-scheme: light)"><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon media="(prefers-color-scheme: dark)"><link href=../../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#language-agent-tree-search class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Language Agent Tree Search </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../quick-start/ class=md-tabs__link> Quick Start </a> </li> <li class=md-tabs__item> <a href=../../../../user-guide/basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../../api-reference/autogen/Agent/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../use-cases/customer-service/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-tabs__link> Community Insights </a> </li> <li class=md-tabs__item> <a href=../../../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../user-guide/basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../api-reference/autogen/Agent/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../use-cases/customer-service/ class=md-nav__link> <span class=md-ellipsis> Use cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2 checked> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> Notebooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=true> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Notebooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Notebooks/ class=md-nav__link> <span class=md-ellipsis> All Notebooks </span> </a> </li> <li class=md-nav__item> <a href=../tools_perplexity_search/ class=md-nav__link> <span class=md-ellipsis> Perplexity Search Tool </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_human_feedback/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Task Solving with Code Generation, Execution, Debugging & Human Feedback </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_graphrag_telemetry_trip_planner/ class=md-nav__link> <span class=md-ellipsis> Using a local Telemetry server to monitor a GraphRAG agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Task Solving with Provided Tools as Functions </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_gemini_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent with gemini client </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_tabular_data_rag_workflow/ class=md-nav__link> <span class=md-ellipsis> Agentic RAG workflow on tabular data from a PDF file </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Language Agent Tree Search </span> </a> </li> <li class=md-nav__item> <a href=../config_loader_utility_functions/ class=md-nav__link> <span class=md-ellipsis> Config loader utility functions </span> </a> </li> <li class=md-nav__item> <a href=../agents_wikipedia/ class=md-nav__link> <span class=md-ellipsis> Wikipedia Agent </span> </a> </li> <li class=md-nav__item> <a href=../tools_google_drive/ class=md-nav__link> <span class=md-ellipsis> Google Drive Tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_finite_state_machine/ class=md-nav__link> <span class=md-ellipsis> FSM - User can input speaker transition constraints </span> </a> </li> <li class=md-nav__item> <a href=../agents_deep_researcher/ class=md-nav__link> <span class=md-ellipsis> DeepResearchAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_RAG/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Retrieval Augmented Generation </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_agentoptimizer/ class=md-nav__link> <span class=md-ellipsis> AgentOptimizer: An Agentic Way to Train Your LLM Agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_qdrant/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat with Qdrant for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_webrtc/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent with WebRTC connection </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_memory_using_mem0/ class=md-nav__link> <span class=md-ellipsis> Agent with memory using Mem0 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_transform_messages/ class=md-nav__link> <span class=md-ellipsis> Preprocessing Chat History with TransformMessages </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_swarm_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_retrieval/ class=md-nav__link> <span class=md-ellipsis> RAG OpenAI Assistants in AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_guidance/ class=md-nav__link> <span class=md-ellipsis> Using Guidance with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_mongodb/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat Powered by MongoDB Atlas for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_graph_rag_neo4j/ class=md-nav__link> <span class=md-ellipsis> Using Neo4j's graph database with AG2 agents for Question & Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_databricks_dbrx/ class=md-nav__link> <span class=md-ellipsis> Use AG2 in Databricks with DBRX </span> </a> </li> <li class=md-nav__item> <a href=../tools_wikipedia_search/ class=md-nav__link> <span class=md-ellipsis> Wikipedia Search Tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nestedchat/ class=md-nav__link> <span class=md-ellipsis> Solving Complex Tasks with Nested Chats </span> </a> </li> <li class=md-nav__item> <a href=../tools_browser_use_deepseek/ class=md-nav__link> <span class=md-ellipsis> DeepSeek: Adding Browsing Capabilities to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nested_sequential_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Complex Tasks with A Sequence of Nested Chats </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nested_chats_chess/ class=md-nav__link> <span class=md-ellipsis> Nested Chats for Tool Use in Conversational Chess </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_twoagents_basic/ class=md-nav__link> <span class=md-ellipsis> OpenAI Assistants in AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_vis/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Coder and Visualization Critic </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_lmm_llava/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with Multimodal Models: LLaVA </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_society_of_mind/ class=md-nav__link> <span class=md-ellipsis> SocietyOfMindAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_mcp_filesystem/ class=md-nav__link> <span class=md-ellipsis> Conversational Workflows with MCP: A Marie Antoinette Take on The Eiffel Tower </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_dalle_and_gpt4v/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with Multimodal Models: DALLE and GPT-4V </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_stateflow/ class=md-nav__link> <span class=md-ellipsis> StateFlow: Build Workflows through State-Oriented Actions </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_small_llm_rag_planning/ class=md-nav__link> <span class=md-ellipsis> Small, Local Model (IBM Granite) Multi-Agent RAG </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_tools/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Tools </span> </a> </li> <li class=md-nav__item> <a href=../tools_duckduckgo_search/ class=md-nav__link> <span class=md-ellipsis> DuckDuckGo Search Tool </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_quickstart_examples/ class=md-nav__link> <span class=md-ellipsis> Load the configuration including the response format </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_gemini_swarm_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../mcp_client/ class=md-nav__link> <span class=md-ellipsis> MCP Clients </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_agentops/ class=md-nav__link> <span class=md-ellipsis> Agent Tracking with AgentOps </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_sql_spider/ class=md-nav__link> <span class=md-ellipsis> SQL Agent for Spider text-to-SQL benchmark </span> </a> </li> <li class=md-nav__item> <a href=../autobuild_basic/ class=md-nav__link> <span class=md-ellipsis> AutoBuild </span> </a> </li> <li class=md-nav__item> <a href=../autobuild_agent_library/ class=md-nav__link> <span class=md-ellipsis> Automatically Build Multi-agent System from Agent Library </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_image_generation_capability/ class=md-nav__link> <span class=md-ellipsis> Generate Dalle Images With Conversable Agents </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_openlit/ class=md-nav__link> <span class=md-ellipsis> Agent Observability with OpenLIT </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_couchbase/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat Powered by Couchbase Capella for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../autogen_uniformed_api_calling/ class=md-nav__link> <span class=md-ellipsis> A Uniform interface to call different LLMs </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nestedchat_optiguide/ class=md-nav__link> <span class=md-ellipsis> OptiGuide with Nested Chats in AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_nested_chats_chess_altmodels/ class=md-nav__link> <span class=md-ellipsis> Conversational Chess using non-OpenAI clients </span> </a> </li> <li class=md-nav__item> <a href=../tools_chat_context_dependency_injection/ class=md-nav__link> <span class=md-ellipsis> Chat Context Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_with_memory/ class=md-nav__link> <span class=md-ellipsis> Agent with memory using Mem0 </span> </a> </li> <li class=md-nav__item> <a href=../run_and_event_processing/ class=md-nav__link> <span class=md-ellipsis> run function examples with event processing </span> </a> </li> <li class=md-nav__item> <a href=../gpt_assistant_agent_function_call/ class=md-nav__link> <span class=md-ellipsis> From Dad Jokes To Sad Jokes: Function Calling with GPTAssistantAgent </span> </a> </li> <li class=md-nav__item> <a href=../JSON_mode_example/ class=md-nav__link> <span class=md-ellipsis> Mitigating Prompt hacking with JSON Mode in Autogen </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_customized/ class=md-nav__link> <span class=md-ellipsis> Group Chat with Customized Speaker Selection Method </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_graphrag_trip_planner/ class=md-nav__link> <span class=md-ellipsis> Trip planning with a FalkorDB GraphRAG agent using a Swarm </span> </a> </li> <li class=md-nav__item> <a href=../tools_tavily_search/ class=md-nav__link> <span class=md-ellipsis> Tavily Search Tool </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_structured_outputs/ class=md-nav__link> <span class=md-ellipsis> Structured output </span> </a> </li> <li class=md-nav__item> <a href=../tools_google_search/ class=md-nav__link> <span class=md-ellipsis> Adding Google Search Capability to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call_async/ class=md-nav__link> <span class=md-ellipsis> Task Solving with Provided Tools as Functions (Asynchronous Function Calls) </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_mcp_wikipedia/ class=md-nav__link> <span class=md-ellipsis> Conversational Workflows with MCP: A French joke on a random Wikipedia article </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_MathChat/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Using MathChat to Solve Math Problems </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_custom_model/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with custom model loading </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_inception_function/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Function Inception </span> </a> </li> <li class=md-nav__item> <a href=../oai_chatgpt_gpt4/ class=md-nav__link> <span class=md-ellipsis> Use AG2 to Tune ChatGPT </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_groupchat/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Group Chat with GPTAssistantAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_graph_rag_falkordb/ class=md-nav__link> <span class=md-ellipsis> Using FalkorGraphRagCapability with agents for GraphRAG Question & Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_multi_task_async_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Multiple Tasks in a Sequence of Async Chats </span> </a> </li> <li class=md-nav__item> <a href=../tools_commsplatforms/ class=md-nav__link> <span class=md-ellipsis> Discord, Slack, and Telegram messaging tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_swarm_webrtc/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration using WebRTC </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_logging/ class=md-nav__link> <span class=md-ellipsis> Runtime Logging with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agents_websurfer/ class=md-nav__link> <span class=md-ellipsis> WebSurferAgent </span> </a> </li> <li class=md-nav__item> <a href=../mongodb_query_engine/ class=md-nav__link> <span class=md-ellipsis> Use MongoDBQueryEngine to query Markdown files </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_mcp_arxiv/ class=md-nav__link> <span class=md-ellipsis> Conversational Workflows with MCP: A Shakespearean Take on arXiv Abstracts </span> </a> </li> <li class=md-nav__item> <a href=../agents_docagent/ class=md-nav__link> <span class=md-ellipsis> RAG with DocAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_multi_task_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Multiple Tasks in a Sequence of Chats </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_captainagent_crosstool/ class=md-nav__link> <span class=md-ellipsis> Cross-Framework LLM Tool for CaptainAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_webscraping_with_apify/ class=md-nav__link> <span class=md-ellipsis> Web Scraping using Apify Tools </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_planning/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Collaborative Task Solving with Coding and Planning Agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call_currency_calculator/ class=md-nav__link> <span class=md-ellipsis> Currency Calculator: Task Solving with Provided Tools as Functions </span> </a> </li> <li class=md-nav__item> <a href=../Chromadb_query_engine/ class=md-nav__link> <span class=md-ellipsis> Use ChromaDBQueryEngine to query Markdown files </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_function_call_code_writing/ class=md-nav__link> <span class=md-ellipsis> Writing a software application using function calls </span> </a> </li> <li class=md-nav__item> <a href=../tools_web_search_preview/ class=md-nav__link> <span class=md-ellipsis> Using OpenAI’s Web Search Tool with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_RetrieveChat_pgvector/ class=md-nav__link> <span class=md-ellipsis> Using RetrieveChat Powered by PGVector for Retrieve Augmented Code Generation and Question Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_enhanced/ class=md-nav__link> <span class=md-ellipsis> Enhanced Swarm Orchestration with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat_research/ class=md-nav__link> <span class=md-ellipsis> Perform Research with Multi-Agent Group Chat </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_teaching/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Teaching AI New Skills via Natural Language Interaction </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_cost_token_tracking/ class=md-nav__link> <span class=md-ellipsis> Usage tracking with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_graph_rag_neo4j_native/ class=md-nav__link> <span class=md-ellipsis> Using Neo4j's native GraphRAG SDK with AG2 agents for Question & Answering </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_group_chat_with_llamaindex_agents/ class=md-nav__link> <span class=md-ellipsis> Groupchat with Llamaindex agents </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_azr_ai_search/ class=md-nav__link> <span class=md-ellipsis> Assistants with Azure Cognitive Search and Azure Identity </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm/ class=md-nav__link> <span class=md-ellipsis> Swarm Orchestration with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../tools_dependency_injection/ class=md-nav__link> <span class=md-ellipsis> Tools with Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_structured_outputs_from_config/ class=md-nav__link> <span class=md-ellipsis> Structured output from json configuration </span> </a> </li> <li class=md-nav__item> <a href=../agentchats_sequential_chats/ class=md-nav__link> <span class=md-ellipsis> Solving Multiple Tasks in a Sequence of Chats with Different Conversable Agent Pairs </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_assistant_function_call/ class=md-nav__link> <span class=md-ellipsis> Chat with OpenAI Assistant using function call in AG2: OSS Insights for Advanced GitHub Data Analysis </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_two_users/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Collaborative Task Solving with Multiple Agents and Human Users </span> </a> </li> <li class=md-nav__item> <a href=../tools_youtube_search/ class=md-nav__link> <span class=md-ellipsis> Adding YouTube Search Capability to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_teachability/ class=md-nav__link> <span class=md-ellipsis> Chatting with a teachable agent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_teachable_oai_assistants/ class=md-nav__link> <span class=md-ellipsis> Making OpenAI Assistants Teachable </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_swarm/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent in a Swarm Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_video_transcript_translate_with_whisper/ class=md-nav__link> <span class=md-ellipsis> Translating Video audio using Whisper and GPT-3.5-turbo </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_assistant_agent_standalone/ class=md-nav__link> <span class=md-ellipsis> Run a standalone AssistantAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_langchain/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Task Solving with Langchain Provided Tools as Functions </span> </a> </li> <li class=md-nav__item> <a href=../LlamaIndex_query_engine/ class=md-nav__link> <span class=md-ellipsis> Use LLamaIndexQueryEngine to query Markdown files </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_oai_code_interpreter/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: GPTAssistant with Code Interpreter </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_stream/ class=md-nav__link> <span class=md-ellipsis> Interactive LLM Agent Dealing with Data Stream </span> </a> </li> <li class=md-nav__item> <a href=../async_human_input/ class=md-nav__link> <span class=md-ellipsis> Agent Chat with Async Human Inputs </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_reasoning_agent/ class=md-nav__link> <span class=md-ellipsis> ReasoningAgent - Advanced LLM Reasoning with Multiple Search Strategies </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_web_info/ class=md-nav__link> <span class=md-ellipsis> Auto Generated Agent Chat: Solving Tasks Requiring Web Info </span> </a> </li> <li class=md-nav__item> <a href=../oai_completion/ class=md-nav__link> <span class=md-ellipsis> Use AG2 to Tune OpenAI Models </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_lmm_gpt-4v/ class=md-nav__link> <span class=md-ellipsis> Engaging with Multimodal Models: GPT-4V in AG2 </span> </a> </li> <li class=md-nav__item> <a href=../tools_crawl4ai/ class=md-nav__link> <span class=md-ellipsis> Supercharging Web Crawling with Crawl4AI </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_microsoft_fabric/ class=md-nav__link> <span class=md-ellipsis> Use AG2 in Microsoft Fabric </span> </a> </li> <li class=md-nav__item> <a href=../tools_interoperability/ class=md-nav__link> <span class=md-ellipsis> Cross-Framework LLM Tool Integration with AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agenteval_cq_math/ class=md-nav__link> <span class=md-ellipsis> Demonstrating the AgentEval framework using the task of solving math problems as an example </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_groupchat/ class=md-nav__link> <span class=md-ellipsis> Group Chat </span> </a> </li> <li class=md-nav__item> <a href=../tools_browser_use/ class=md-nav__link> <span class=md-ellipsis> Adding Browsing Capabilities to AG2 </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_captainagent/ class=md-nav__link> <span class=md-ellipsis> CaptainAgent </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_swarm_w_groupchat_legacy/ class=md-nav__link> <span class=md-ellipsis> (Legacy) Implement Swarm-style orchestration with GroupChat </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_auto_feedback_from_code_execution/ class=md-nav__link> <span class=md-ellipsis> Task Solving with Code Generation, Execution and Debugging </span> </a> </li> <li class=md-nav__item> <a href=../agentchat_realtime_websocket/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent with local websocket connection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../community-gallery/community-gallery/ class=md-nav__link> <span class=md-ellipsis> Community Gallery </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-nav__link> <span class=md-ellipsis> Community Insights </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/edit/main/website/docs/use-cases/notebooks/notebooks/lats_search.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg> </a> <h1 id=language-agent-tree-search>Language Agent Tree Search<a class=headerlink href=#language-agent-tree-search title="Permanent link">#</a></h1> <p><a href=https://colab.research.google.com/github/ag2ai/ag2/blob/main/notebook/lats_search.ipynb class=colab-badge target=_blank><img nozoom src=https://colab.research.google.com/assets/colab-badge.svg alt="Open In Colab"></a> <a href=https://github.com/ag2ai/ag2/blob/main/notebook/lats_search.ipynb class=github-badge target=_blank><img nozoom src="https://img.shields.io/badge/Open%20on%20GitHub-grey?logo=github" alt="Open on GitHub"></a></p> <p><a href=https://arxiv.org/abs/2310.04406>Language Agent Tree Search</a> (LATS), by Zhou, et. al, is a general LLM agent search algorithm that combines reflection/evaluation and search (specifically Monte-Carlo tree search) to achieve stronger overall task performance by leveraging inference-time compute.</p> <p>It has four main phases consisting of six steps:</p> <ol> <li>Select: pick the best next state to progress from, based on its aggregate value.</li> <li>Expand and simulate: sample n potential actions to take and execute them in parallel.</li> <li>Reflect + Evaluate: observe the outcomes of these actions and score the decisions based on reflection (and possibly external feedback if available)</li> <li>Backpropagate: update the scores of the root trajectories based on the outcomes.</li> </ol> <figure> <img src=https://i.postimg.cc/NjQScLTv/image.png alt=lats> <figcaption aria-hidden=true>lats</figcaption> </figure> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>AssistantAgent</span><span class=p>,</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>UserProxyAgent</span>
</code></pre></div> <h1 id=configure-logging>Configure logging<a class=headerlink href=#configure-logging title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</code></pre></div> <h1 id=set-environment-variables>Set environment variables<a class=headerlink href=#set-environment-variables title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;AUTOGEN_USE_DOCKER&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;0&quot;</span>  <span class=c1># Disable Docker usage globally for Autogen</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&quot;OPENAI_API_KEY&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;YOUR_API_KEY&quot;</span>
</code></pre></div> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">#</a></h2> <p>Install <code>autogen</code> (for the LLM framework and agents)</p> <p>Required packages: autogen</p> <p>Please ensure these packages are installed before running this script</p> <h1 id=directly-create-the-config_list-with-the-api-key>Directly create the config_list with the API key<a class=headerlink href=#directly-create-the-config_list-with-the-api-key title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>config_list</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>,</span> <span class=s2>&quot;api_key&quot;</span><span class=p>:</span> <span class=s2>&quot;YOUR_API_KEY&quot;</span><span class=p>}]</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>if</span> <span class=ow>not</span> <span class=n>config_list</span><span class=p>:</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Failed to create configuration. Please check the API key.&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=reflection-class>Reflection Class<a class=headerlink href=#reflection-class title="Permanent link">#</a></h3> <p>The reflection chain will score agent outputs based on the decision and the tool responses.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>Field</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=k>class</span><span class=w> </span><span class=nc>Reflection</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>reflections</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>        <span class=n>description</span><span class=o>=</span><span class=s2>&quot;The critique and reflections on the sufficiency, superfluency, and general quality of the response&quot;</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=p>)</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    <span class=n>score</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>        <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Score from 0-10 on the quality of the candidate response.&quot;</span><span class=p>,</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>        <span class=n>gte</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>        <span class=n>lte</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=p>)</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    <span class=n>found_solution</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s2>&quot;Whether the response has fully solved the question or task.&quot;</span><span class=p>)</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>as_message</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;human&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Reasoning: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>reflections</span><span class=si>}</span><span class=se>\n</span><span class=s2>Score: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>score</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>}</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>    <span class=nd>@property</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>    <span class=k>def</span><span class=w> </span><span class=nf>normalized_score</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>score</span> <span class=o>/</span> <span class=mf>10.0</span>
</code></pre></div> <h2 id=tree-state>Tree State<a class=headerlink href=#tree-state title="Permanent link">#</a></h2> <p>LATS is based on a (greedy) Monte-Carlo tree search. For each search steps, it picks the node with the highest “upper confidence bound”, which is a metric that balances exploitation (highest average reward) and exploration (lowest visits). Starting from that node, it generates N (5 in this case) new candidate actions to take, and adds them to the tree. It stops searching either when it has generated a valid solution OR when it has reached the maximum number of rollouts (search tree depth).</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kn>import</span><span class=w> </span><span class=nn>math</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=kn>from</span><span class=w> </span><span class=nn>collections</span><span class=w> </span><span class=kn>import</span> <span class=n>deque</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Optional</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>class</span><span class=w> </span><span class=nc>Node</span><span class=p>:</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>        <span class=bp>self</span><span class=p>,</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>        <span class=n>reflection</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Reflection</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>        <span class=n>parent</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=s2>&quot;Node&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=p>):</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>messages</span> <span class=o>=</span> <span class=n>messages</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>parent</span> <span class=o>=</span> <span class=n>parent</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>        <span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Node</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>        <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=mf>0.0</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>        <span class=bp>self</span><span class=o>.</span><span class=n>visits</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>        <span class=bp>self</span><span class=o>.</span><span class=n>reflection</span> <span class=o>=</span> <span class=n>reflection</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>        <span class=bp>self</span><span class=o>.</span><span class=n>depth</span> <span class=o>=</span> <span class=n>parent</span><span class=o>.</span><span class=n>depth</span> <span class=o>+</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>parent</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=mi>1</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_is_solved</span> <span class=o>=</span> <span class=n>reflection</span><span class=o>.</span><span class=n>found_solution</span> <span class=k>if</span> <span class=n>reflection</span> <span class=k>else</span> <span class=kc>False</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_solved</span><span class=p>:</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_mark_tree_as_solved</span><span class=p>()</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>        <span class=k>if</span> <span class=n>reflection</span><span class=p>:</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>            <span class=bp>self</span><span class=o>.</span><span class=n>backpropagate</span><span class=p>(</span><span class=n>reflection</span><span class=o>.</span><span class=n>normalized_score</span><span class=p>)</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;&lt;Node value=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>value</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>, visits=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>visits</span><span class=si>}</span><span class=s2>, depth=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>depth</span><span class=si>}</span><span class=s2>, is_solved=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_is_solved</span><span class=si>}</span><span class=s2>&gt;&quot;</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a>    <span class=nd>@property</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a>    <span class=k>def</span><span class=w> </span><span class=nf>is_solved</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;If any solutions exist, we can end the search.&quot;&quot;&quot;</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_solved</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>    <span class=nd>@property</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>    <span class=k>def</span><span class=w> </span><span class=nf>is_terminal</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>        <span class=k>return</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>children</span>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>    <span class=nd>@property</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>    <span class=k>def</span><span class=w> </span><span class=nf>best_child</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Select the child with the highest UCT to search next.&quot;&quot;&quot;</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=p>:</span>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>        <span class=n>all_nodes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_all_children</span><span class=p>()</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>        <span class=k>return</span> <span class=nb>max</span><span class=p>(</span><span class=n>all_nodes</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>child</span><span class=p>:</span> <span class=n>child</span><span class=o>.</span><span class=n>upper_confidence_bound</span><span class=p>())</span>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a>
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a>    <span class=nd>@property</span>
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>    <span class=k>def</span><span class=w> </span><span class=nf>best_child_score</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Return the child with the highest value.&quot;&quot;&quot;</span>
<a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=p>:</span>
<a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a>            <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>        <span class=k>return</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>child</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>child</span><span class=o>.</span><span class=n>is_solved</span><span class=p>)</span> <span class=o>*</span> <span class=n>child</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
<a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a>
<a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a>    <span class=nd>@property</span>
<a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a>    <span class=k>def</span><span class=w> </span><span class=nf>height</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
<a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check for how far we&#39;ve rolled out the tree.&quot;&quot;&quot;</span>
<a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=p>:</span>
<a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a>            <span class=k>return</span> <span class=mi>1</span> <span class=o>+</span> <span class=nb>max</span><span class=p>([</span><span class=n>child</span><span class=o>.</span><span class=n>height</span> <span class=k>for</span> <span class=n>child</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>children</span><span class=p>])</span>
<a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>        <span class=k>return</span> <span class=mi>1</span>
<a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a>
<a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a>    <span class=k>def</span><span class=w> </span><span class=nf>upper_confidence_bound</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exploration_weight</span><span class=o>=</span><span class=mf>1.0</span><span class=p>):</span>
<a id=__codelineno-7-56 name=__codelineno-7-56 href=#__codelineno-7-56></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Return the UCT score. This helps balance exploration vs. exploitation of a branch.&quot;&quot;&quot;</span>
<a id=__codelineno-7-57 name=__codelineno-7-57 href=#__codelineno-7-57></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>parent</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-7-58 name=__codelineno-7-58 href=#__codelineno-7-58></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Cannot obtain UCT from root node&quot;</span><span class=p>)</span>
<a id=__codelineno-7-59 name=__codelineno-7-59 href=#__codelineno-7-59></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>visits</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-7-60 name=__codelineno-7-60 href=#__codelineno-7-60></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>value</span>
<a id=__codelineno-7-61 name=__codelineno-7-61 href=#__codelineno-7-61></a>        <span class=c1># Encourages exploitation of high-value trajectories</span>
<a id=__codelineno-7-62 name=__codelineno-7-62 href=#__codelineno-7-62></a>        <span class=n>average_reward</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>value</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>visits</span>
<a id=__codelineno-7-63 name=__codelineno-7-63 href=#__codelineno-7-63></a>        <span class=n>exploration_term</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>visits</span><span class=p>)</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>visits</span><span class=p>)</span>
<a id=__codelineno-7-64 name=__codelineno-7-64 href=#__codelineno-7-64></a>        <span class=k>return</span> <span class=n>average_reward</span> <span class=o>+</span> <span class=n>exploration_weight</span> <span class=o>*</span> <span class=n>exploration_term</span>
<a id=__codelineno-7-65 name=__codelineno-7-65 href=#__codelineno-7-65></a>
<a id=__codelineno-7-66 name=__codelineno-7-66 href=#__codelineno-7-66></a>    <span class=k>def</span><span class=w> </span><span class=nf>backpropagate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>reward</span><span class=p>:</span> <span class=nb>float</span><span class=p>):</span>
<a id=__codelineno-7-67 name=__codelineno-7-67 href=#__codelineno-7-67></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Update the score of this node and its parents.&quot;&quot;&quot;</span>
<a id=__codelineno-7-68 name=__codelineno-7-68 href=#__codelineno-7-68></a>        <span class=n>node</span> <span class=o>=</span> <span class=bp>self</span>
<a id=__codelineno-7-69 name=__codelineno-7-69 href=#__codelineno-7-69></a>        <span class=k>while</span> <span class=n>node</span><span class=p>:</span>
<a id=__codelineno-7-70 name=__codelineno-7-70 href=#__codelineno-7-70></a>            <span class=n>node</span><span class=o>.</span><span class=n>visits</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-7-71 name=__codelineno-7-71 href=#__codelineno-7-71></a>            <span class=n>node</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>value</span> <span class=o>*</span> <span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>visits</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>reward</span><span class=p>)</span> <span class=o>/</span> <span class=n>node</span><span class=o>.</span><span class=n>visits</span>
<a id=__codelineno-7-72 name=__codelineno-7-72 href=#__codelineno-7-72></a>            <span class=n>node</span> <span class=o>=</span> <span class=n>node</span><span class=o>.</span><span class=n>parent</span>
<a id=__codelineno-7-73 name=__codelineno-7-73 href=#__codelineno-7-73></a>
<a id=__codelineno-7-74 name=__codelineno-7-74 href=#__codelineno-7-74></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_messages</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>include_reflections</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>):</span>
<a id=__codelineno-7-75 name=__codelineno-7-75 href=#__codelineno-7-75></a>        <span class=k>if</span> <span class=n>include_reflections</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>reflection</span><span class=p>:</span>
<a id=__codelineno-7-76 name=__codelineno-7-76 href=#__codelineno-7-76></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>messages</span> <span class=o>+</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>reflection</span><span class=o>.</span><span class=n>as_message</span><span class=p>()]</span>
<a id=__codelineno-7-77 name=__codelineno-7-77 href=#__codelineno-7-77></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>messages</span>
<a id=__codelineno-7-78 name=__codelineno-7-78 href=#__codelineno-7-78></a>
<a id=__codelineno-7-79 name=__codelineno-7-79 href=#__codelineno-7-79></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_trajectory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>include_reflections</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
<a id=__codelineno-7-80 name=__codelineno-7-80 href=#__codelineno-7-80></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get messages representing this search branch.&quot;&quot;&quot;</span>
<a id=__codelineno-7-81 name=__codelineno-7-81 href=#__codelineno-7-81></a>        <span class=n>messages</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-7-82 name=__codelineno-7-82 href=#__codelineno-7-82></a>        <span class=n>node</span> <span class=o>=</span> <span class=bp>self</span>
<a id=__codelineno-7-83 name=__codelineno-7-83 href=#__codelineno-7-83></a>        <span class=k>while</span> <span class=n>node</span><span class=p>:</span>
<a id=__codelineno-7-84 name=__codelineno-7-84 href=#__codelineno-7-84></a>            <span class=n>messages</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>get_messages</span><span class=p>(</span><span class=n>include_reflections</span><span class=o>=</span><span class=n>include_reflections</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
<a id=__codelineno-7-85 name=__codelineno-7-85 href=#__codelineno-7-85></a>            <span class=n>node</span> <span class=o>=</span> <span class=n>node</span><span class=o>.</span><span class=n>parent</span>
<a id=__codelineno-7-86 name=__codelineno-7-86 href=#__codelineno-7-86></a>        <span class=c1># Reverse the final back-tracked trajectory to return in the correct order</span>
<a id=__codelineno-7-87 name=__codelineno-7-87 href=#__codelineno-7-87></a>        <span class=k>return</span> <span class=n>messages</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># root solution, reflection, child 1, ...</span>
<a id=__codelineno-7-88 name=__codelineno-7-88 href=#__codelineno-7-88></a>
<a id=__codelineno-7-89 name=__codelineno-7-89 href=#__codelineno-7-89></a>    <span class=k>def</span><span class=w> </span><span class=nf>_get_all_children</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-7-90 name=__codelineno-7-90 href=#__codelineno-7-90></a>        <span class=n>all_nodes</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-7-91 name=__codelineno-7-91 href=#__codelineno-7-91></a>        <span class=n>nodes</span> <span class=o>=</span> <span class=n>deque</span><span class=p>()</span>
<a id=__codelineno-7-92 name=__codelineno-7-92 href=#__codelineno-7-92></a>        <span class=n>nodes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a id=__codelineno-7-93 name=__codelineno-7-93 href=#__codelineno-7-93></a>        <span class=k>while</span> <span class=n>nodes</span><span class=p>:</span>
<a id=__codelineno-7-94 name=__codelineno-7-94 href=#__codelineno-7-94></a>            <span class=n>node</span> <span class=o>=</span> <span class=n>nodes</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
<a id=__codelineno-7-95 name=__codelineno-7-95 href=#__codelineno-7-95></a>            <span class=n>all_nodes</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>children</span><span class=p>)</span>
<a id=__codelineno-7-96 name=__codelineno-7-96 href=#__codelineno-7-96></a>            <span class=k>for</span> <span class=n>n</span> <span class=ow>in</span> <span class=n>node</span><span class=o>.</span><span class=n>children</span><span class=p>:</span>
<a id=__codelineno-7-97 name=__codelineno-7-97 href=#__codelineno-7-97></a>                <span class=n>nodes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
<a id=__codelineno-7-98 name=__codelineno-7-98 href=#__codelineno-7-98></a>        <span class=k>return</span> <span class=n>all_nodes</span>
<a id=__codelineno-7-99 name=__codelineno-7-99 href=#__codelineno-7-99></a>
<a id=__codelineno-7-100 name=__codelineno-7-100 href=#__codelineno-7-100></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_best_solution</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-7-101 name=__codelineno-7-101 href=#__codelineno-7-101></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Return the best solution from within the current sub-tree.&quot;&quot;&quot;</span>
<a id=__codelineno-7-102 name=__codelineno-7-102 href=#__codelineno-7-102></a>        <span class=n>all_nodes</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=p>]</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_all_children</span><span class=p>()</span>
<a id=__codelineno-7-103 name=__codelineno-7-103 href=#__codelineno-7-103></a>        <span class=n>best_node</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span>
<a id=__codelineno-7-104 name=__codelineno-7-104 href=#__codelineno-7-104></a>            <span class=n>all_nodes</span><span class=p>,</span>
<a id=__codelineno-7-105 name=__codelineno-7-105 href=#__codelineno-7-105></a>            <span class=c1># We filter out all non-terminal, non-solution trajectories</span>
<a id=__codelineno-7-106 name=__codelineno-7-106 href=#__codelineno-7-106></a>            <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>node</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>is_terminal</span> <span class=ow>and</span> <span class=n>node</span><span class=o>.</span><span class=n>is_solved</span><span class=p>)</span> <span class=o>*</span> <span class=n>node</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
<a id=__codelineno-7-107 name=__codelineno-7-107 href=#__codelineno-7-107></a>        <span class=p>)</span>
<a id=__codelineno-7-108 name=__codelineno-7-108 href=#__codelineno-7-108></a>        <span class=k>return</span> <span class=n>best_node</span>
<a id=__codelineno-7-109 name=__codelineno-7-109 href=#__codelineno-7-109></a>
<a id=__codelineno-7-110 name=__codelineno-7-110 href=#__codelineno-7-110></a>    <span class=k>def</span><span class=w> </span><span class=nf>_mark_tree_as_solved</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-7-111 name=__codelineno-7-111 href=#__codelineno-7-111></a>        <span class=n>parent</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>parent</span>
<a id=__codelineno-7-112 name=__codelineno-7-112 href=#__codelineno-7-112></a>        <span class=k>while</span> <span class=n>parent</span><span class=p>:</span>
<a id=__codelineno-7-113 name=__codelineno-7-113 href=#__codelineno-7-113></a>            <span class=n>parent</span><span class=o>.</span><span class=n>_is_solved</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-7-114 name=__codelineno-7-114 href=#__codelineno-7-114></a>            <span class=n>parent</span> <span class=o>=</span> <span class=n>parent</span><span class=o>.</span><span class=n>parent</span>
</code></pre></div> <p>The main component is the tree, represented by the root node.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>typing_extensions</span><span class=w> </span><span class=kn>import</span> <span class=n>TypedDict</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>class</span><span class=w> </span><span class=nc>TreeState</span><span class=p>(</span><span class=n>TypedDict</span><span class=p>):</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=c1># The full tree</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>    <span class=n>root</span><span class=p>:</span> <span class=n>Node</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>    <span class=c1># The original input</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    <span class=nb>input</span><span class=p>:</span> <span class=nb>str</span>
</code></pre></div> <h2 id=define-language-agent>Define Language Agent<a class=headerlink href=#define-language-agent title="Permanent link">#</a></h2> <p>Our agent will have three primary LLM-powered processes:</p> <ol> <li>Reflect: score the action based on the tool response.</li> <li>Initial response: to create the root node and start the search.</li> <li>Expand: generate 5 candidate “next steps” from the best spot in the current tree</li> </ol> <p>For more “Grounded” tool applications (such as code synthesis), you could integrate code execution into the reflection/reward step. This type of external feedback is very useful.</p> <h4 id=tools>Tools<a class=headerlink href=#tools title="Permanent link">#</a></h4> <p>For our example, we will give the language agent a search engine.</p> <p>Define the UserProxyAgent with web search / tool-use capability</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>user_proxy</span> <span class=o>=</span> <span class=n>UserProxyAgent</span><span class=p>(</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>,</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>max_consecutive_auto_reply</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=n>code_execution_config</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>        <span class=s2>&quot;work_dir&quot;</span><span class=p>:</span> <span class=s2>&quot;web&quot;</span><span class=p>,</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>        <span class=s2>&quot;use_docker&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>    <span class=p>},</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=p>)</span>
</code></pre></div> <p>Create a ConversableAgent without tools</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>assistant_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;assistant_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are an AI assistant capable of helping with various tasks.&quot;</span><span class=p>,</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    <span class=n>code_execution_config</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=p>)</span>
</code></pre></div> <h3 id=reflection>Reflection<a class=headerlink href=#reflection title="Permanent link">#</a></h3> <p>Self-reflection allows the agent to bootstrap, improving its future responses based on the outcome of previous ones. In agents this is more powerful since it can use external feedback to improve.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>reflection_prompt</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=s2>Reflect and grade the assistant response to the user question below.</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=s2>User question: </span><span class=si>{input}</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=s2>Assistant response: </span><span class=si>{candidate}</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=s2>Provide your reflection in the following format:</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=s2>Reflections: [Your detailed critique and reflections]</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=s2>Score: [A score from 0-10]</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=s2>Found Solution: [true/false]</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=s2>&quot;&quot;&quot;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>reflection_agent</span> <span class=o>=</span> <span class=n>AssistantAgent</span><span class=p>(</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;reflection_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;You are an AI assistant that reflects on and grades responses.&quot;</span><span class=p>,</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>        <span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=n>config_list</span><span class=p>,</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>        <span class=s2>&quot;temperature&quot;</span><span class=p>:</span> <span class=mf>0.2</span><span class=p>,</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=p>},</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=k>def</span><span class=w> </span><span class=nf>reflection_chain</span><span class=p>(</span><span class=n>inputs</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Reflection</span><span class=p>:</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>        <span class=n>candidate_content</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>        <span class=k>if</span> <span class=s2>&quot;candidate&quot;</span> <span class=ow>in</span> <span class=n>inputs</span><span class=p>:</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>            <span class=n>candidate</span> <span class=o>=</span> <span class=n>inputs</span><span class=p>[</span><span class=s2>&quot;candidate&quot;</span><span class=p>]</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>candidate</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>                <span class=n>candidate_content</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>                    <span class=n>candidate</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>]</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>candidate</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;content&quot;</span> <span class=ow>in</span> <span class=n>candidate</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>                    <span class=k>else</span> <span class=nb>str</span><span class=p>(</span><span class=n>candidate</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>                <span class=p>)</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>candidate</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a>                <span class=n>candidate_content</span> <span class=o>=</span> <span class=n>candidate</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>candidate</span><span class=p>))</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>candidate</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>                <span class=n>candidate_content</span> <span class=o>=</span> <span class=n>candidate</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>                <span class=n>candidate_content</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>candidate</span><span class=p>)</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>        <span class=n>formatted_prompt</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>            <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;system&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;You are an AI assistant that reflects on and grades responses.&quot;</span><span class=p>},</span>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a>            <span class=p>{</span>
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
<a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>reflection_prompt</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>input</span><span class=o>=</span><span class=n>inputs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;input&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span> <span class=n>candidate</span><span class=o>=</span><span class=n>candidate_content</span><span class=p>),</span>
<a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a>            <span class=p>},</span>
<a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a>        <span class=p>]</span>
<a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>reflection_agent</span><span class=o>.</span><span class=n>generate_reply</span><span class=p>(</span><span class=n>formatted_prompt</span><span class=p>)</span>
<a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a>
<a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a>        <span class=c1># Parse the response</span>
<a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a>        <span class=n>response_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
<a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a>        <span class=n>lines</span> <span class=o>=</span> <span class=n>response_str</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a>        <span class=n>reflections</span> <span class=o>=</span> <span class=nb>next</span><span class=p>((</span><span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;: &quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span> <span class=k>if</span> <span class=n>line</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;Reflections:&quot;</span><span class=p>)),</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a>        <span class=n>score_str</span> <span class=o>=</span> <span class=nb>next</span><span class=p>((</span><span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;: &quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span> <span class=k>if</span> <span class=n>line</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;Score:&quot;</span><span class=p>)),</span> <span class=s2>&quot;0&quot;</span><span class=p>)</span>
<a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a>            <span class=k>if</span> <span class=s2>&quot;/&quot;</span> <span class=ow>in</span> <span class=n>score_str</span><span class=p>:</span>
<a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a>                <span class=n>numerator</span><span class=p>,</span> <span class=n>denominator</span> <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=n>score_str</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>))</span>
<a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a>                <span class=n>score</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>numerator</span> <span class=o>/</span> <span class=n>denominator</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
<a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a>                <span class=n>score</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>score_str</span><span class=p>)</span>
<a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
<a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a>            <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid score value: </span><span class=si>{</span><span class=n>score_str</span><span class=si>}</span><span class=s2>. Defaulting to 0.&quot;</span><span class=p>)</span>
<a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a>        <span class=n>score</span> <span class=o>=</span> <span class=mi>0</span>
<a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a>
<a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a>        <span class=n>found_solution</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
<a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a>            <span class=p>(</span><span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;: &quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;true&quot;</span> <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>lines</span> <span class=k>if</span> <span class=n>line</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;Found Solution:&quot;</span><span class=p>)),</span> <span class=kc>False</span>
<a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a>        <span class=p>)</span>
<a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a>
<a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>reflections</span><span class=p>:</span>
<a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a>            <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;No reflections found in the response. Using default values.&quot;</span><span class=p>)</span>
<a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a>            <span class=n>reflections</span> <span class=o>=</span> <span class=s2>&quot;No reflections provided.&quot;</span>
<a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a>
<a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a>        <span class=k>return</span> <span class=n>Reflection</span><span class=p>(</span><span class=n>reflections</span><span class=o>=</span><span class=n>reflections</span><span class=p>,</span> <span class=n>score</span><span class=o>=</span><span class=n>score</span><span class=p>,</span> <span class=n>found_solution</span><span class=o>=</span><span class=n>found_solution</span><span class=p>)</span>
<a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a>        <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error in reflection_chain: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a>        <span class=k>return</span> <span class=n>Reflection</span><span class=p>(</span><span class=n>reflections</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Error in reflection: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>score</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>found_solution</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> <h3 id=initial-response>Initial Response<a class=headerlink href=#initial-response title="Permanent link">#</a></h3> <p>We start with a single root node, generated by this first step. It responds to the user input either with a tool invocation or a response.</p> <h1 id=create-autogen-agents>Create Autogen agents<a class=headerlink href=#create-autogen-agents title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>assistant</span> <span class=o>=</span> <span class=n>AssistantAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=n>config_list</span><span class=p>},</span> <span class=n>code_execution_config</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=n>user</span> <span class=o>=</span> <span class=n>UserProxyAgent</span><span class=p>(</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>    <span class=n>name</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>,</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>    <span class=n>max_consecutive_auto_reply</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=n>code_execution_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;work_dir&quot;</span><span class=p>:</span> <span class=s2>&quot;web&quot;</span><span class=p>,</span> <span class=s2>&quot;use_docker&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>},</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=p>)</span>
</code></pre></div> <h1 id=define-a-function-to-create-the-initial-prompt>Define a function to create the initial prompt<a class=headerlink href=#define-a-function-to-create-the-initial-prompt title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>def</span><span class=w> </span><span class=nf>create_initial_prompt</span><span class=p>(</span><span class=n>input_text</span><span class=p>):</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    <span class=k>return</span> <span class=p>[</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>        <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;system&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;You are an AI assistant.&quot;</span><span class=p>},</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>        <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>input_text</span><span class=p>},</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>    <span class=p>]</span>
</code></pre></div> <h1 id=function-to-generate-initial-response>Function to generate initial response<a class=headerlink href=#function-to-generate-initial-response title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>def</span><span class=w> </span><span class=nf>generate_initial_response</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>TreeState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TreeState</span><span class=p>:</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>    <span class=n>chat_messages</span> <span class=o>=</span> <span class=n>create_initial_prompt</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>])</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>        <span class=c1># Ensure chat_messages is a list of dictionaries</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>chat_messages</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>            <span class=n>chat_messages</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>chat_messages</span><span class=p>}]</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Generating initial response for input: </span><span class=si>{</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;input&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Chat messages: </span><span class=si>{</span><span class=n>chat_messages</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>assistant</span><span class=o>.</span><span class=n>generate_reply</span><span class=p>(</span><span class=n>chat_messages</span><span class=p>)</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Raw response from assistant: </span><span class=si>{</span><span class=n>response</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>        <span class=c1># Ensure response is properly formatted as a string</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>response</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;content&quot;</span> <span class=ow>in</span> <span class=n>response</span><span class=p>:</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>]</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>response</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]))</span>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>            <span class=n>content</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>content</span><span class=p>:</span>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Generated content is empty after processing&quot;</span><span class=p>)</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a>
<a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Processed content: </span><span class=si>{</span><span class=n>content</span><span class=p>[:</span><span class=mi>100</span><span class=p>]</span><span class=si>}</span><span class=s2>...&quot;</span><span class=p>)</span>  <span class=c1># Log first 100 chars</span>
<a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a>
<a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a>        <span class=c1># Generate reflection</span>
<a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a>        <span class=n>reflection_input</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>],</span> <span class=s2>&quot;candidate&quot;</span><span class=p>:</span> <span class=n>content</span><span class=p>}</span>
<a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Generating reflection on the initial response&quot;</span><span class=p>)</span>
<a id=__codelineno-16-33 name=__codelineno-16-33 href=#__codelineno-16-33></a>        <span class=n>reflection</span> <span class=o>=</span> <span class=n>reflection_chain</span><span class=p>(</span><span class=n>reflection_input</span><span class=p>)</span>
<a id=__codelineno-16-34 name=__codelineno-16-34 href=#__codelineno-16-34></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Reflection generated: </span><span class=si>{</span><span class=n>reflection</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-16-35 name=__codelineno-16-35 href=#__codelineno-16-35></a>
<a id=__codelineno-16-36 name=__codelineno-16-36 href=#__codelineno-16-36></a>        <span class=c1># Create Node with messages as a list containing a single dict</span>
<a id=__codelineno-16-37 name=__codelineno-16-37 href=#__codelineno-16-37></a>        <span class=n>messages</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>content</span><span class=p>}]</span>
<a id=__codelineno-16-38 name=__codelineno-16-38 href=#__codelineno-16-38></a>        <span class=n>root</span> <span class=o>=</span> <span class=n>Node</span><span class=p>(</span><span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span> <span class=n>reflection</span><span class=o>=</span><span class=n>reflection</span><span class=p>)</span>
<a id=__codelineno-16-39 name=__codelineno-16-39 href=#__codelineno-16-39></a>
<a id=__codelineno-16-40 name=__codelineno-16-40 href=#__codelineno-16-40></a>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Initial response and reflection generated successfully&quot;</span><span class=p>)</span>
<a id=__codelineno-16-41 name=__codelineno-16-41 href=#__codelineno-16-41></a>        <span class=k>return</span> <span class=n>TreeState</span><span class=p>(</span><span class=n>root</span><span class=o>=</span><span class=n>root</span><span class=p>,</span> <span class=nb>input</span><span class=o>=</span><span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>])</span>
<a id=__codelineno-16-42 name=__codelineno-16-42 href=#__codelineno-16-42></a>
<a id=__codelineno-16-43 name=__codelineno-16-43 href=#__codelineno-16-43></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-16-44 name=__codelineno-16-44 href=#__codelineno-16-44></a>        <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error in generate_initial_response: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-16-45 name=__codelineno-16-45 href=#__codelineno-16-45></a>        <span class=k>return</span> <span class=n>TreeState</span><span class=p>(</span><span class=n>root</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=nb>input</span><span class=o>=</span><span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>])</span>
</code></pre></div> <h1 id=example-usage-of-the-generate_initial_response-function>Example usage of the generate_initial_response function<a class=headerlink href=#example-usage-of-the-generate_initial_response-function title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=n>initial_prompt</span> <span class=o>=</span> <span class=s2>&quot;Why is the sky blue?&quot;</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=n>initial_state</span> <span class=o>=</span> <span class=n>TreeState</span><span class=p>(</span><span class=nb>input</span><span class=o>=</span><span class=n>initial_prompt</span><span class=p>,</span> <span class=n>root</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=n>result_state</span> <span class=o>=</span> <span class=n>generate_initial_response</span><span class=p>(</span><span class=n>initial_state</span><span class=p>)</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=k>if</span> <span class=n>result_state</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>    <span class=nb>print</span><span class=p>(</span><span class=n>result_state</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>messages</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>])</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=k>else</span><span class=p>:</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Failed to generate initial response.&quot;</span><span class=p>)</span>
</code></pre></div> <h4 id=starting-node>Starting Node<a class=headerlink href=#starting-node title="Permanent link">#</a></h4> <p>We will package up the candidate generation and reflection in a single node of our graph. This is represented by the following function:</p> <h1 id=define-the-function-to-generate-the-initial-response>Define the function to generate the initial response<a class=headerlink href=#define-the-function-to-generate-the-initial-response title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Define the function to generate the initial response</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=k>def</span><span class=w> </span><span class=nf>generate_initial_response</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>TreeState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TreeState</span><span class=p>:</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generate the initial candidate response using Autogen components.&quot;&quot;&quot;</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>    <span class=n>assistant</span> <span class=o>=</span> <span class=n>AssistantAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=n>config_list</span><span class=p>},</span> <span class=n>code_execution_config</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>    <span class=c1># Generate initial response</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>    <span class=n>initial_message</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>        <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;system&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;You are an AI assistant.&quot;</span><span class=p>},</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>        <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>]},</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>    <span class=p>]</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Generating initial response for input: </span><span class=si>{</span><span class=n>state</span><span class=p>[</span><span class=s1>&#39;input&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>assistant</span><span class=o>.</span><span class=n>generate_reply</span><span class=p>(</span><span class=n>initial_message</span><span class=p>)</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Raw response from assistant: </span><span class=si>{</span><span class=n>response</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>        <span class=c1># Ensure response is properly formatted as a string</span>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>response</span>
<a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
<a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>content</span><span class=p>:</span>
<a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a>                <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
<a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
<a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a>            <span class=n>content</span> <span class=o>=</span> <span class=s2>&quot; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>response</span><span class=p>)</span>
<a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a>            <span class=n>content</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
<a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a>
<a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a>        <span class=c1># Ensure content is always a string and not empty</span>
<a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
<a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>content</span><span class=p>:</span>
<a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Generated content is empty after processing&quot;</span><span class=p>)</span>
<a id=__codelineno-18-34 name=__codelineno-18-34 href=#__codelineno-18-34></a>
<a id=__codelineno-18-35 name=__codelineno-18-35 href=#__codelineno-18-35></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Final processed content (first 100 chars): </span><span class=si>{</span><span class=n>content</span><span class=p>[:</span><span class=mi>100</span><span class=p>]</span><span class=si>}</span><span class=s2>...&quot;</span><span class=p>)</span>
<a id=__codelineno-18-36 name=__codelineno-18-36 href=#__codelineno-18-36></a>
<a id=__codelineno-18-37 name=__codelineno-18-37 href=#__codelineno-18-37></a>        <span class=c1># Generate reflection</span>
<a id=__codelineno-18-38 name=__codelineno-18-38 href=#__codelineno-18-38></a>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Generating reflection on the initial response&quot;</span><span class=p>)</span>
<a id=__codelineno-18-39 name=__codelineno-18-39 href=#__codelineno-18-39></a>        <span class=n>reflection_input</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>],</span> <span class=s2>&quot;candidate&quot;</span><span class=p>:</span> <span class=n>content</span><span class=p>}</span>
<a id=__codelineno-18-40 name=__codelineno-18-40 href=#__codelineno-18-40></a>        <span class=n>reflection</span> <span class=o>=</span> <span class=n>reflection_chain</span><span class=p>(</span><span class=n>reflection_input</span><span class=p>)</span>
<a id=__codelineno-18-41 name=__codelineno-18-41 href=#__codelineno-18-41></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Reflection generated: </span><span class=si>{</span><span class=n>reflection</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-18-42 name=__codelineno-18-42 href=#__codelineno-18-42></a>
<a id=__codelineno-18-43 name=__codelineno-18-43 href=#__codelineno-18-43></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>reflection</span><span class=p>,</span> <span class=n>Reflection</span><span class=p>):</span>
<a id=__codelineno-18-44 name=__codelineno-18-44 href=#__codelineno-18-44></a>            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid reflection type: </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>reflection</span><span class=p>)</span><span class=si>}</span><span class=s2>. Expected Reflection, got </span><span class=si>{</span><span class=nb>type</span><span class=p>(</span><span class=n>reflection</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-18-45 name=__codelineno-18-45 href=#__codelineno-18-45></a>
<a id=__codelineno-18-46 name=__codelineno-18-46 href=#__codelineno-18-46></a>        <span class=c1># Create Node with messages as a list containing a single dict</span>
<a id=__codelineno-18-47 name=__codelineno-18-47 href=#__codelineno-18-47></a>        <span class=n>messages</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>content</span><span class=p>}]</span>
<a id=__codelineno-18-48 name=__codelineno-18-48 href=#__codelineno-18-48></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Creating Node with messages: </span><span class=si>{</span><span class=n>messages</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-18-49 name=__codelineno-18-49 href=#__codelineno-18-49></a>        <span class=n>root</span> <span class=o>=</span> <span class=n>Node</span><span class=p>(</span><span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span> <span class=n>reflection</span><span class=o>=</span><span class=n>reflection</span><span class=p>)</span>
<a id=__codelineno-18-50 name=__codelineno-18-50 href=#__codelineno-18-50></a>        <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Initial response and reflection generated successfully&quot;</span><span class=p>)</span>
<a id=__codelineno-18-51 name=__codelineno-18-51 href=#__codelineno-18-51></a>        <span class=n>logging</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Created root node: </span><span class=si>{</span><span class=n>root</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-18-52 name=__codelineno-18-52 href=#__codelineno-18-52></a>        <span class=k>return</span> <span class=n>TreeState</span><span class=p>(</span><span class=n>root</span><span class=o>=</span><span class=n>root</span><span class=p>,</span> <span class=nb>input</span><span class=o>=</span><span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>])</span>
<a id=__codelineno-18-53 name=__codelineno-18-53 href=#__codelineno-18-53></a>
<a id=__codelineno-18-54 name=__codelineno-18-54 href=#__codelineno-18-54></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-18-55 name=__codelineno-18-55 href=#__codelineno-18-55></a>        <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error in generate_initial_response: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-18-56 name=__codelineno-18-56 href=#__codelineno-18-56></a>        <span class=k>return</span> <span class=n>TreeState</span><span class=p>(</span><span class=n>root</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=nb>input</span><span class=o>=</span><span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>])</span>
</code></pre></div> <h3 id=candidate-generation>Candidate Generation<a class=headerlink href=#candidate-generation title="Permanent link">#</a></h3> <p>The following code prompts the same LLM to generate N additional candidates to check.</p> <p>This generates N candidate values for a single input to sample actions from the environment</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>def</span><span class=w> </span><span class=nf>generate_candidates</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=nb>dict</span><span class=p>):</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>    <span class=n>n</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;N&quot;</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>    <span class=n>assistant</span> <span class=o>=</span> <span class=n>AssistantAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=n>config_list</span><span class=p>},</span> <span class=n>code_execution_config</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    <span class=n>candidates</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>            <span class=c1># Use the assistant to generate a response</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>            <span class=n>last_message</span> <span class=o>=</span> <span class=n>messages</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>]</span> <span class=k>if</span> <span class=n>messages</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>messages</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=nb>dict</span><span class=p>)</span> <span class=k>else</span> <span class=nb>str</span><span class=p>(</span><span class=n>messages</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>assistant</span><span class=o>.</span><span class=n>generate_reply</span><span class=p>([{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>last_message</span><span class=p>}])</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>                <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;content&quot;</span> <span class=ow>in</span> <span class=n>response</span><span class=p>:</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>                <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>response</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>])</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>            <span class=k>elif</span> <span class=p>(</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>                <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=ow>and</span> <span class=n>response</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>response</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;content&quot;</span> <span class=ow>in</span> <span class=n>response</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>            <span class=p>):</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>                <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>response</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>])</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>                <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>response</span><span class=p>))</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a>            <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error generating candidate: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a>            <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;Failed to generate candidate.&quot;</span><span class=p>)</span>
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a>
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>candidates</span><span class=p>:</span>
<a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a>        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;No candidates were generated.&quot;</span><span class=p>)</span>
<a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a>
<a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a>    <span class=k>return</span> <span class=n>candidates</span>
<a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a>
<a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a><span class=n>expansion_chain</span> <span class=o>=</span> <span class=n>generate_candidates</span>
</code></pre></div> <h4 id=candidate-generation-node>Candidate generation node<a class=headerlink href=#candidate-generation-node title="Permanent link">#</a></h4> <p>We will package the candidate generation and reflection steps in the following “expand” node. We do all the operations as a batch process to speed up execution.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=k>def</span><span class=w> </span><span class=nf>expand</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>TreeState</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>    <span class=n>root</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>    <span class=n>best_candidate</span><span class=p>:</span> <span class=n>Node</span> <span class=o>=</span> <span class=n>root</span><span class=o>.</span><span class=n>best_child</span> <span class=k>if</span> <span class=n>root</span><span class=o>.</span><span class=n>children</span> <span class=k>else</span> <span class=n>root</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>    <span class=n>messages</span> <span class=o>=</span> <span class=n>best_candidate</span><span class=o>.</span><span class=n>get_trajectory</span><span class=p>()</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>    <span class=c1># Generate N candidates using Autogen&#39;s generate_candidates function</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>    <span class=n>new_candidates</span> <span class=o>=</span> <span class=n>generate_candidates</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>config</span><span class=p>)</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>    <span class=c1># Reflect on each candidate using Autogen&#39;s AssistantAgent</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>    <span class=n>reflections</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>    <span class=k>for</span> <span class=n>candidate</span> <span class=ow>in</span> <span class=n>new_candidates</span><span class=p>:</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a>        <span class=n>reflection</span> <span class=o>=</span> <span class=n>reflection_chain</span><span class=p>({</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>],</span> <span class=s2>&quot;candidate&quot;</span><span class=p>:</span> <span class=n>candidate</span><span class=p>})</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>        <span class=n>reflections</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>reflection</span><span class=p>)</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a>    <span class=c1># Grow tree</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>    <span class=n>child_nodes</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a>        <span class=n>Node</span><span class=p>([{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>candidate</span><span class=p>}],</span> <span class=n>parent</span><span class=o>=</span><span class=n>best_candidate</span><span class=p>,</span> <span class=n>reflection</span><span class=o>=</span><span class=n>reflection</span><span class=p>)</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a>        <span class=k>for</span> <span class=n>candidate</span><span class=p>,</span> <span class=n>reflection</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>new_candidates</span><span class=p>,</span> <span class=n>reflections</span><span class=p>)</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a>    <span class=p>]</span>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a>    <span class=n>best_candidate</span><span class=o>.</span><span class=n>children</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>child_nodes</span><span class=p>)</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a>    <span class=c1># We have already extended the tree directly, so we just return the state</span>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a>    <span class=k>return</span> <span class=n>state</span>
</code></pre></div> <h2 id=create-tree>Create Tree<a class=headerlink href=#create-tree title="Permanent link">#</a></h2> <p>With those two nodes defined, we are ready to define the tree. After each agent step, we have the option of finishing.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Literal</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=k>def</span><span class=w> </span><span class=nf>should_loop</span><span class=p>(</span><span class=n>state</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;expand&quot;</span><span class=p>,</span> <span class=s2>&quot;end&quot;</span><span class=p>]:</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Determine whether to continue the tree search.&quot;&quot;&quot;</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>    <span class=n>root</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>    <span class=k>if</span> <span class=n>root</span><span class=o>.</span><span class=n>is_solved</span><span class=p>:</span>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>        <span class=k>return</span> <span class=s2>&quot;end&quot;</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>    <span class=k>if</span> <span class=n>root</span><span class=o>.</span><span class=n>height</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>:</span>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>        <span class=k>return</span> <span class=s2>&quot;end&quot;</span>
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>    <span class=k>return</span> <span class=s2>&quot;expand&quot;</span>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=k>def</span><span class=w> </span><span class=nf>run_lats</span><span class=p>(</span><span class=n>input_query</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>max_iterations</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>):</span>
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>    <span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>    <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>    <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>        <span class=n>state</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>input_query</span><span class=p>,</span> <span class=s2>&quot;root&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>}</span>
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>        <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>            <span class=n>state</span> <span class=o>=</span> <span class=n>generate_initial_response</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>            <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>or</span> <span class=s2>&quot;root&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>state</span> <span class=ow>or</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Initial response generation failed or returned invalid state&quot;</span><span class=p>)</span>
<a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a>                <span class=k>return</span> <span class=s2>&quot;Failed to generate initial response.&quot;</span>
<a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Initial response generated successfully&quot;</span><span class=p>)</span>
<a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error generating initial response: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a>            <span class=k>return</span> <span class=s2>&quot;Failed to generate initial response due to an unexpected error.&quot;</span>
<a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a>
<a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a>        <span class=k>for</span> <span class=n>iteration</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>max_iterations</span><span class=p>):</span>
<a id=__codelineno-21-31 name=__codelineno-21-31 href=#__codelineno-21-31></a>            <span class=n>action</span> <span class=o>=</span> <span class=n>should_loop</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
<a id=__codelineno-21-32 name=__codelineno-21-32 href=#__codelineno-21-32></a>            <span class=k>if</span> <span class=n>action</span> <span class=o>==</span> <span class=s2>&quot;end&quot;</span><span class=p>:</span>
<a id=__codelineno-21-33 name=__codelineno-21-33 href=#__codelineno-21-33></a>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Search ended after </span><span class=si>{</span><span class=n>iteration</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=si>}</span><span class=s2> iterations&quot;</span><span class=p>)</span>
<a id=__codelineno-21-34 name=__codelineno-21-34 href=#__codelineno-21-34></a>                <span class=k>break</span>
<a id=__codelineno-21-35 name=__codelineno-21-35 href=#__codelineno-21-35></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-21-36 name=__codelineno-21-36 href=#__codelineno-21-36></a>                <span class=n>state</span> <span class=o>=</span> <span class=n>expand</span><span class=p>(</span>
<a id=__codelineno-21-37 name=__codelineno-21-37 href=#__codelineno-21-37></a>                    <span class=n>state</span><span class=p>,</span>
<a id=__codelineno-21-38 name=__codelineno-21-38 href=#__codelineno-21-38></a>                    <span class=p>{</span>
<a id=__codelineno-21-39 name=__codelineno-21-39 href=#__codelineno-21-39></a>                        <span class=s2>&quot;N&quot;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-21-40 name=__codelineno-21-40 href=#__codelineno-21-40></a>                        <span class=s2>&quot;input_query&quot;</span><span class=p>:</span> <span class=n>input_query</span><span class=p>,</span>
<a id=__codelineno-21-41 name=__codelineno-21-41 href=#__codelineno-21-41></a>                    <span class=p>},</span>
<a id=__codelineno-21-42 name=__codelineno-21-42 href=#__codelineno-21-42></a>                <span class=p>)</span>
<a id=__codelineno-21-43 name=__codelineno-21-43 href=#__codelineno-21-43></a>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Completed iteration </span><span class=si>{</span><span class=n>iteration</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-21-44 name=__codelineno-21-44 href=#__codelineno-21-44></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-21-45 name=__codelineno-21-45 href=#__codelineno-21-45></a>                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error during iteration </span><span class=si>{</span><span class=n>iteration</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-21-46 name=__codelineno-21-46 href=#__codelineno-21-46></a>                <span class=k>continue</span>
<a id=__codelineno-21-47 name=__codelineno-21-47 href=#__codelineno-21-47></a>
<a id=__codelineno-21-48 name=__codelineno-21-48 href=#__codelineno-21-48></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>or</span> <span class=s2>&quot;root&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>state</span> <span class=ow>or</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-21-49 name=__codelineno-21-49 href=#__codelineno-21-49></a>            <span class=k>return</span> <span class=s2>&quot;No valid solution found due to an error in the search process.&quot;</span>
<a id=__codelineno-21-50 name=__codelineno-21-50 href=#__codelineno-21-50></a>
<a id=__codelineno-21-51 name=__codelineno-21-51 href=#__codelineno-21-51></a>        <span class=n>solution_node</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&quot;root&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get_best_solution</span><span class=p>()</span>
<a id=__codelineno-21-52 name=__codelineno-21-52 href=#__codelineno-21-52></a>        <span class=n>best_trajectory</span> <span class=o>=</span> <span class=n>solution_node</span><span class=o>.</span><span class=n>get_trajectory</span><span class=p>(</span><span class=n>include_reflections</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-21-53 name=__codelineno-21-53 href=#__codelineno-21-53></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>best_trajectory</span><span class=p>:</span>
<a id=__codelineno-21-54 name=__codelineno-21-54 href=#__codelineno-21-54></a>            <span class=k>return</span> <span class=s2>&quot;No solution found in the search process.&quot;</span>
<a id=__codelineno-21-55 name=__codelineno-21-55 href=#__codelineno-21-55></a>
<a id=__codelineno-21-56 name=__codelineno-21-56 href=#__codelineno-21-56></a>        <span class=n>result</span> <span class=o>=</span> <span class=p>(</span>
<a id=__codelineno-21-57 name=__codelineno-21-57 href=#__codelineno-21-57></a>            <span class=n>best_trajectory</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>best_trajectory</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=nb>dict</span><span class=p>)</span> <span class=k>else</span> <span class=nb>str</span><span class=p>(</span><span class=n>best_trajectory</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
<a id=__codelineno-21-58 name=__codelineno-21-58 href=#__codelineno-21-58></a>        <span class=p>)</span>
<a id=__codelineno-21-59 name=__codelineno-21-59 href=#__codelineno-21-59></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;LATS search completed successfully&quot;</span><span class=p>)</span>
<a id=__codelineno-21-60 name=__codelineno-21-60 href=#__codelineno-21-60></a>        <span class=k>return</span> <span class=n>result</span>
<a id=__codelineno-21-61 name=__codelineno-21-61 href=#__codelineno-21-61></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-21-62 name=__codelineno-21-62 href=#__codelineno-21-62></a>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An unexpected error occurred during LATS execution: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-21-63 name=__codelineno-21-63 href=#__codelineno-21-63></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;An unexpected error occurred: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span>
</code></pre></div> <p>Example usage:</p> <p>result = run_lats(“Write a research report on deep learning.”)</p> <p>print(result)</p> <h1 id=example-usage-of-the-lats-algorithm-with-autogen>Example usage of the LATS algorithm with Autogen<a class=headerlink href=#example-usage-of-the-lats-algorithm-with-autogen title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>%(asctime)s</span><span class=s2> - </span><span class=si>%(levelname)s</span><span class=s2> - </span><span class=si>%(message)s</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=k>def</span><span class=w> </span><span class=nf>run_lats_example</span><span class=p>(</span><span class=n>question</span><span class=p>):</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Processing question: </span><span class=si>{</span><span class=n>question</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>run_lats</span><span class=p>(</span><span class=n>question</span><span class=p>)</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;LATS algorithm completed. Result: </span><span class=si>{</span><span class=n>result</span><span class=p>[:</span><span class=mi>100</span><span class=p>]</span><span class=si>}</span><span class=s2>...&quot;</span><span class=p>)</span>  <span class=c1># Log first 100 chars of result</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Question: </span><span class=si>{</span><span class=n>question</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Answer: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An error occurred while processing the question: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An error occurred: </span><span class=si>{</span><span class=n>e</span><span class=si>!s}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>    <span class=k>finally</span><span class=p>:</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;---&quot;</span><span class=p>)</span>
</code></pre></div> <h1 id=list-of-example-questions>List of example questions<a class=headerlink href=#list-of-example-questions title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=n>questions</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>    <span class=s2>&quot;Explain how epigenetic modifications can influence gene expression across generations and the implications for evolution.&quot;</span><span class=p>,</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>    <span class=s2>&quot;Discuss the challenges of grounding ethical theories in moral realism, especially in light of the is-ought problem introduced by Hume.&quot;</span><span class=p>,</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>    <span class=s2>&quot;How does the Riemann Hypothesis relate to the distribution of prime numbers, and why is it significant in number theory?&quot;</span><span class=p>,</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>    <span class=s2>&quot;Describe the challenges and theoretical underpinnings of unifying general relativity with quantum mechanics, particularly focusing on string theory and loop quantum gravity.&quot;</span><span class=p>,</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=p>]</span>
</code></pre></div> <h1 id=run-lats-algorithm-for-each-question>Run LATS algorithm for each question<a class=headerlink href=#run-lats-algorithm-for-each-question title="Permanent link">#</a></h1> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>question</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>questions</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Example </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>:&quot;</span><span class=p>)</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>    <span class=n>run_lats_example</span><span class=p>(</span><span class=n>question</span><span class=p>)</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;All examples processed.&quot;</span><span class=p>)</span>
</code></pre></div> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">#</a></h2> <p>Congrats on implementing LATS! This is a technique that can be reasonably fast and effective at solving complex agent tasks. A few notes that you probably observed above:</p> <ol> <li> <p>While LATS is effective, the tree rollout process can require additional inference compute time. If you plan to integrate this into a production application, consider streaming intermediate steps to allow users to see the thought process and access intermediate results. Alternatively, you could use it to generate fine-tuning data to enhance single-shot accuracy and avoid lengthy rollouts. The cost of using LATS has significantly decreased since its initial proposal and is expected to continue decreasing.</p> </li> <li> <p>The effectiveness of the candidate selection process depends on the quality of the rewards generated. In this example, we exclusively use self-reflection as feedback, but if you have access to external feedback sources (such as code test execution), those should be incorporated as suggested above.</p> </li> </ol> <h1 id=_1><a class=headerlink href=#_1 title="Permanent link">#</a></h1> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-05-08T13:42:13+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-05-08</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../agentchat_tabular_data_rag_workflow/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Agentic RAG workflow on tabular data from a PDF file"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Agentic RAG workflow on tabular data from a PDF file </div> </div> </a> <a href=../config_loader_utility_functions/ class="md-footer__link md-footer__link--next" aria-label="Next: Config loader utility functions"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Config loader utility functions </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../../../js/timeago.min.js></script> <script src=../../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>