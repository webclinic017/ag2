<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Websockets facilitate real-time, bidirectional communication between web clients and servers, enhancing the responsiveness and interactivity of AG2-powered applications."><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://docs.ag2.ai/latest/docs/use-cases/notebooks/notebooks/agentchat_websockets/ rel=canonical><link rel=icon href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>Websockets: Streaming input and output using websockets - AG2</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../css/timeago.css><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../stylesheets/extra.ff0633.min.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - Websockets: Streaming input and output using websockets"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://docs.ag2.ai/latest/docs/use-cases/notebooks/notebooks/agentchat_websockets/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - Websockets: Streaming input and output using websockets"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon-dark.svg type=image/x-icon media="(prefers-color-scheme: light)"><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon media="(prefers-color-scheme: dark)"><link href=../../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#websockets-streaming-input-and-output-using-websockets class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Websockets: Streaming input and output using websockets </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../quick-start/ class=md-tabs__link> Quick Start </a> </li> <li class=md-tabs__item> <a href=../../../../user-guide/basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../../api-reference/autogen/Agent/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> <li class=md-tabs__item> <a href=../../../use-cases/customer-service/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-tabs__link> Community Insights </a> </li> <li class=md-tabs__item> <a href=../../../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../user-guide/basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../api-reference/autogen/Agent/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../use-cases/customer-service/ class=md-nav__link> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-nav__link> <span class=md-ellipsis> Community Insights </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requirements class=md-nav__link> <span class=md-ellipsis> Requirements </span> </a> </li> <li class=md-nav__item> <a href=#set-your-api-endpoint class=md-nav__link> <span class=md-ellipsis> Set your API Endpoint </span> </a> </li> <li class=md-nav__item> <a href=#defining-on_connect-function class=md-nav__link> <span class=md-ellipsis> Defining on_connect function </span> </a> </li> <li class=md-nav__item> <a href=#testing-websockets-server-with-python-client class=md-nav__link> <span class=md-ellipsis> Testing websockets server with Python client </span> </a> </li> <li class=md-nav__item> <a href=#testing-websockets-server-running-inside-fastapi-server-with-htmljs-client class=md-nav__link> <span class=md-ellipsis> Testing websockets server running inside FastAPI server with HTML/JS client </span> </a> </li> <li class=md-nav__item> <a href=#testing-websockets-server-with-htmljs-client class=md-nav__link> <span class=md-ellipsis> Testing websockets server with HTML/JS client </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/edit/main/website/docs/use-cases/notebooks/notebooks/agentchat_websockets.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg> </a> <h1 id=websockets-streaming-input-and-output-using-websockets>Websockets: Streaming input and output using websockets<a class=headerlink href=#websockets-streaming-input-and-output-using-websockets title="Permanent link">#</a></h1> <p><a href=https://colab.research.google.com/github/ag2ai/ag2/blob/main/notebook/agentchat_websockets.ipynb class=colab-badge target=_blank><img nozoom src=https://colab.research.google.com/assets/colab-badge.svg alt="Open In Colab"></a> <a href=https://github.com/ag2ai/ag2/blob/main/notebook/agentchat_websockets.ipynb class=github-badge target=_blank><img nozoom src="https://img.shields.io/badge/Open%20on%20GitHub-grey?logo=github" alt="Open on GitHub"></a></p> <p>This notebook demonstrates how to use the <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOStream><code>IOStream</code></a> class to stream both input and output using websockets. The use of websockets allows you to build web clients that are more responsive than the one using web methods. The main difference is that the webosockets allows you to push data while you need to poll the server for new response using web methods.</p> <p>In this guide, we explore the capabilities of the <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOStream><code>IOStream</code></a> class. It is specifically designed to enhance the development of clients such as web clients which use websockets for streaming both input and output. The <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOStream><code>IOStream</code></a> stands out by enabling a more dynamic and interactive user experience for web applications.</p> <p>Websockets technology is at the core of this functionality, offering a significant advancement over traditional web methods by allowing data to be “pushed” to the client in real-time. This is a departure from the conventional approach where clients must repeatedly “poll” the server to check for any new responses. By employing the underlining <a href=https://websockets.readthedocs.io/ >websockets</a> library, the IOStream class facilitates a continuous, two-way communication channel between the server and client. This ensures that updates are received instantly, without the need for constant polling, thereby making web clients more efficient and responsive.</p> <p>The real power of websockets, leveraged through the <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOStream><code>IOStream</code></a> class, lies in its ability to create highly responsive web clients. This responsiveness is critical for applications requiring real-time data updates such as chat applications. By integrating the <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOStream><code>IOStream</code></a> class into your web application, you not only enhance user experience through immediate data transmission but also reduce the load on your server by eliminating unnecessary polling.</p> <p>In essence, the transition to using websockets through the <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOStream><code>IOStream</code></a> class marks a significant enhancement in web client development. This approach not only streamlines the data exchange process between clients and servers but also opens up new possibilities for creating more interactive and engaging web applications. By following this guide, developers can harness the full potential of websockets and the <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOStream><code>IOStream</code></a> class to push the boundaries of what is possible with web client responsiveness and interactivity.</p> <h2 id=requirements>Requirements<a class=headerlink href=#requirements title="Permanent link">#</a></h2> <div class="admonition info"> <p class=admonition-title>Requirements</p> <p>Some extra dependencies are needed for this notebook, which can be installed via pip:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>pip<span class=w> </span>install<span class=w> </span>-U<span class=w> </span>ag2<span class=o>[</span>openai,websockets<span class=o>]</span><span class=w> </span>fastapi<span class=w> </span>uvicorn
</code></pre></div> <blockquote> <p><strong>Note:</strong> If you have been using <code>autogen</code> or <code>ag2</code>, all you need to do is upgrade it using:<br> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>pip<span class=w> </span>install<span class=w> </span>-U<span class=w> </span>autogen<span class=o>[</span>openai,websockets<span class=o>]</span>
</code></pre></div> or<br> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>pip<span class=w> </span>install<span class=w> </span>-U<span class=w> </span>ag2<span class=o>[</span>openai,websockets<span class=o>]</span>
</code></pre></div> as <code>autogen</code>, and <code>ag2</code> are aliases for the same PyPI package. </p> </blockquote> <p>For more information, please refer to the <a href=https://docs.ag2.ai/latest/docs/user-guide/basic-concepts/installing-ag2>installation guide</a>.</p> </div> <h2 id=set-your-api-endpoint>Set your API Endpoint<a class=headerlink href=#set-your-api-endpoint title="Permanent link">#</a></h2> <p>The <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/config_list_from_json/#autogen.config_list_from_json><code>config_list_from_json</code></a> function loads a list of configurations from an environment variable or a json file.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=kn>from</span><span class=w> </span><span class=nn>tempfile</span><span class=w> </span><span class=kn>import</span> <span class=n>TemporaryDirectory</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=kn>from</span><span class=w> </span><span class=nn>websockets.sync.client</span><span class=w> </span><span class=kn>import</span> <span class=n>connect</span> <span class=k>as</span> <span class=n>ws_connect</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=kn>import</span><span class=w> </span><span class=nn>autogen</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.io.websockets</span><span class=w> </span><span class=kn>import</span> <span class=n>IOWebsockets</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=n>config_list</span> <span class=o>=</span> <span class=n>autogen</span><span class=o>.</span><span class=n>config_list_from_json</span><span class=p>(</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>    <span class=n>env_or_file</span><span class=o>=</span><span class=s2>&quot;OAI_CONFIG_LIST&quot;</span><span class=p>,</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>    <span class=n>filter_dict</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>],</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=p>},</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=p>)</span>
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Learn more about configuring LLMs for agents <a href=https://docs.ag2.ai/latest/docs/user-guide/basic-concepts/llm-configuration>here</a>.</p> </div> <h2 id=defining-on_connect-function>Defining <code>on_connect</code> function<a class=headerlink href=#defining-on_connect-function title="Permanent link">#</a></h2> <p>An <code>on_connect</code> function is a crucial part of applications that utilize websockets, acting as an event handler that is called whenever a new client connection is established. This function is designed to initiate any necessary setup, communication protocols, or data exchange procedures specific to the newly connected client. Essentially, it lays the groundwork for the interactive session that follows, configuring how the server and the client will communicate and what initial actions are to be taken once a connection is made. Now, let’s delve into the details of how to define this function, especially in the context of using the AG2 framework with websockets.</p> <p>Upon a client’s connection to the websocket server, the server automatically initiates a new instance of the <a href=https://docs.ag2.ai/latest/docs/api-reference/autogen/io/IOWebsockets/#autogen.io.IOWebsockets><code>IOWebsockets</code></a> class. This instance is crucial for managing the data flow between the server and the client. The <code>on_connect</code> function leverages this instance to set up the communication protocol, define interaction rules, and initiate any preliminary data exchanges or configurations required for the client-server interaction to proceed smoothly.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>def</span><span class=w> </span><span class=nf>on_connect</span><span class=p>(</span><span class=n>iostream</span><span class=p>:</span> <span class=n>IOWebsockets</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot; - on_connect(): Connected to client using IOWebsockets </span><span class=si>{</span><span class=n>iostream</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot; - on_connect(): Receiving message from client.&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>    <span class=c1># 1. Receive Initial Message</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=n>initial_msg</span> <span class=o>=</span> <span class=n>iostream</span><span class=o>.</span><span class=n>input</span><span class=p>()</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>initial_msg</span><span class=si>=}</span><span class=s2>&quot;</span><span class=p>)</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>        <span class=c1># 2. Instantiate ConversableAgent</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>        <span class=n>agent</span> <span class=o>=</span> <span class=n>autogen</span><span class=o>.</span><span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>            <span class=n>name</span><span class=o>=</span><span class=s2>&quot;chatbot&quot;</span><span class=p>,</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>            <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;Complete a task given to you and reply TERMINATE when the task is done. If asked about the weather, use tool &#39;weather_forecast(city)&#39; to get the weather forecast for a city.&quot;</span><span class=p>,</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>            <span class=n>llm_config</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>                <span class=s2>&quot;config_list&quot;</span><span class=p>:</span> <span class=n>config_list</span><span class=p>,</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>                <span class=s2>&quot;stream&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>            <span class=p>},</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>        <span class=p>)</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>        <span class=c1># 3. Define UserProxyAgent</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>        <span class=n>user_proxy</span> <span class=o>=</span> <span class=n>autogen</span><span class=o>.</span><span class=n>UserProxyAgent</span><span class=p>(</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>            <span class=n>name</span><span class=o>=</span><span class=s2>&quot;user_proxy&quot;</span><span class=p>,</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>            <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;A proxy for the user.&quot;</span><span class=p>,</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>            <span class=n>is_termination_msg</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>x</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;content&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;TERMINATE&quot;</span><span class=p>),</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>            <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;NEVER&quot;</span><span class=p>,</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>            <span class=n>max_consecutive_auto_reply</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>            <span class=n>code_execution_config</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>        <span class=p>)</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>        <span class=c1># 4. Define Agent-specific Functions</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>        <span class=k>def</span><span class=w> </span><span class=nf>weather_forecast</span><span class=p>(</span><span class=n>city</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>            <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;The weather forecast for </span><span class=si>{</span><span class=n>city</span><span class=si>}</span><span class=s2> at </span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=si>}</span><span class=s2> is sunny.&quot;</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>        <span class=n>autogen</span><span class=o>.</span><span class=n>register_function</span><span class=p>(</span>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>            <span class=n>weather_forecast</span><span class=p>,</span> <span class=n>caller</span><span class=o>=</span><span class=n>agent</span><span class=p>,</span> <span class=n>executor</span><span class=o>=</span><span class=n>user_proxy</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Weather forecast for a city&quot;</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>        <span class=p>)</span>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>        <span class=c1># 5. Initiate conversation</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>        <span class=nb>print</span><span class=p>(</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>            <span class=sa>f</span><span class=s2>&quot; - on_connect(): Initiating chat with agent </span><span class=si>{</span><span class=n>agent</span><span class=si>}</span><span class=s2> using message &#39;</span><span class=si>{</span><span class=n>initial_msg</span><span class=si>}</span><span class=s2>&#39;&quot;</span><span class=p>,</span>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>            <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>        <span class=p>)</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>        <span class=n>user_proxy</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>            <span class=n>agent</span><span class=p>,</span>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>            <span class=n>message</span><span class=o>=</span><span class=n>initial_msg</span><span class=p>,</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>        <span class=p>)</span>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot; - on_connect(): Exception: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a>        <span class=k>raise</span> <span class=n>e</span>
</code></pre></div> <p>Here’s an explanation on how a typical <code>on_connect</code> function such as the one in the example above is defined:</p> <ol> <li> <p><strong>Receive Initial Message</strong>: Immediately after establishing a connection, receive an initial message from the client. This step is crucial for understanding the client’s request or initiating the conversation flow.</p> </li> <li> <p><strong>Instantiate ConversableAgent</strong>: Create an instance of ConversableAgent with a specific system message and the LLM configuration. If you need more than one agent, make sure they don’t share the same <code>llm_config</code> as adding a function to one of them will also attempt to add it to another.</p> </li> <li> <p><strong>Instantiate UserProxyAgent</strong>: Similarly, create a UserProxyAgent instance, defining its termination condition, human input mode, and other relevant parameters. There is no need to define <code>llm_config</code> as the UserProxyAgent does not use LLM.</p> </li> <li> <p><strong>Define Agent-specific Functions</strong>: If your conversable agent requires executing specific tasks, such as fetching a weather forecast in the example above, define these functions within the on_connect scope. Decorate these functions accordingly to link them with your agents.</p> </li> <li> <p><strong>Initiate Conversation</strong>: Finally, use the <code>initiate_chat</code> method of your <code>UserProxyAgent</code> to start the interaction with the conversable agent, passing the initial message and a cache mechanism for efficiency.</p> </li> </ol> <h2 id=testing-websockets-server-with-python-client>Testing websockets server with Python client<a class=headerlink href=#testing-websockets-server-with-python-client title="Permanent link">#</a></h2> <p>Testing an <code>on_connect</code> function with a Python client involves simulating a client-server interaction to ensure the setup, data exchange, and communication protocols function as intended. Here’s a brief explanation on how to conduct this test using a Python client:</p> <ol> <li> <p><strong>Start the Websocket Server</strong>: Use the <code>IOWebsockets.run_server_in_thread method</code> to start the server in a separate thread, specifying the on_connect function and the port. This method returns the URI of the running websocket server.</p> </li> <li> <p><strong>Connect to the Server</strong>: Open a connection to the server using the returned URI. This simulates a client initiating a connection to your websocket server.</p> </li> <li> <p><strong>Send a Message to the Server</strong>: Once connected, send a message from the client to the server. This tests the server’s ability to receive messages through the established websocket connection.</p> </li> <li> <p><strong>Receive and Process Messages</strong>: Implement a loop to continuously receive messages from the server. Decode the messages if necessary, and process them accordingly. This step verifies the server’s ability to respond back to the client’s request.</p> </li> </ol> <p>This test scenario effectively evaluates the interaction between a client and a server using the <code>on_connect</code> function, by simulating a realistic message exchange. It ensures that the server can handle incoming connections, process messages, and communicate responses back to the client, all critical functionalities for a robust websocket-based application.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>with</span> <span class=n>IOWebsockets</span><span class=o>.</span><span class=n>run_server_in_thread</span><span class=p>(</span><span class=n>on_connect</span><span class=o>=</span><span class=n>on_connect</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8765</span><span class=p>)</span> <span class=k>as</span> <span class=n>uri</span><span class=p>:</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot; - test_setup() with websocket server running on </span><span class=si>{</span><span class=n>uri</span><span class=si>}</span><span class=s2>.&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=k>with</span> <span class=n>ws_connect</span><span class=p>(</span><span class=n>uri</span><span class=p>)</span> <span class=k>as</span> <span class=n>websocket</span><span class=p>:</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot; - Connected to server on </span><span class=si>{</span><span class=n>uri</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot; - Sending message to server.&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>        <span class=c1># websocket.send(&quot;2+2=?&quot;)</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>        <span class=n>websocket</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&quot;Check out the weather in Paris and write a poem about it.&quot;</span><span class=p>)</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>                <span class=n>message</span> <span class=o>=</span> <span class=n>websocket</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>                <span class=n>message</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=k>else</span> <span class=n>message</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>                <span class=nb>print</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>                <span class=c1># if &quot;TERMINATE&quot; in message:</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>                <span class=c1>#     print()</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>                <span class=c1>#     print(&quot; - Received TERMINATE message. Exiting.&quot;, flush=True)</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>                <span class=c1>#     break</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Connection closed:&quot;</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>                <span class=k>break</span>
</code></pre></div> <h2 id=testing-websockets-server-running-inside-fastapi-server-with-htmljs-client>Testing websockets server running inside FastAPI server with HTML/JS client<a class=headerlink href=#testing-websockets-server-running-inside-fastapi-server-with-htmljs-client title="Permanent link">#</a></h2> <p>The code snippets below outlines an approach for testing an <code>on_connect</code> function in a web environment using <a href=https://fastapi.tiangolo.com/ >FastAPI</a> to serve a simple interactive HTML page. This method allows users to send messages through a web interface, which are then processed by the server running the AG2 framework via websockets. Here’s a step-by-step explanation:</p> <ol> <li> <p><strong>FastAPI Application Setup</strong>: The code initiates by importing necessary libraries and setting up a FastAPI application. FastAPI is a modern, fast web framework for building APIs with Python 3.7+ based on standard Python type hints.</p> </li> <li> <p><strong>HTML Template for User Interaction</strong>: An HTML template is defined as a multi-line Python string, which includes a basic form for message input and a script for managing websocket communication. This template creates a user interface where messages can be sent to the server and responses are displayed dynamically.</p> </li> <li> <p><strong>Running the Websocket Server</strong>: The <code>run_websocket_server</code> async context manager starts the websocket server using <code>IOWebsockets.run_server_in_thread</code> with the specified <code>on_connect</code> function and port. This server listens for incoming websocket connections.</p> </li> <li> <p><strong>FastAPI Route for Serving HTML Page</strong>: A FastAPI route (<code>@app.get("/")</code>) is defined to serve the HTML page to users. When a user accesses the root URL, the HTML content for the websocket chat is returned, allowing them to interact with the websocket server.</p> </li> <li> <p><strong>Starting the FastAPI Application</strong>: Lastly, the FastAPI application is started using Uvicorn, an ASGI server, configured with the app and additional parameters as needed. The server is then launched to serve the FastAPI application, making the interactive HTML page accessible to users.</p> </li> </ol> <p>This method of testing allows for interactive communication between the user and the server, providing a practical way to demonstrate and evaluate the behavior of the on_connect function in real-time. Users can send messages through the webpage, and the server processes these messages as per the logic defined in the on_connect function, showcasing the capabilities and responsiveness of the AG2 framework’s websocket handling in a user-friendly manner.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kn>from</span><span class=w> </span><span class=nn>contextlib</span><span class=w> </span><span class=kn>import</span> <span class=n>asynccontextmanager</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=kn>from</span><span class=w> </span><span class=nn>fastapi</span><span class=w> </span><span class=kn>import</span> <span class=n>FastAPI</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=kn>from</span><span class=w> </span><span class=nn>fastapi.responses</span><span class=w> </span><span class=kn>import</span> <span class=n>HTMLResponse</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=n>PORT</span> <span class=o>=</span> <span class=mi>8000</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=n>html</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=s2>&lt;!DOCTYPE html&gt;</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=s2>&lt;html&gt;</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=s2>    &lt;head&gt;</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=s2>        &lt;title&gt;AG2 websocket test&lt;/title&gt;</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=s2>    &lt;/head&gt;</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=s2>    &lt;body&gt;</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=s2>        &lt;h1&gt;WebSocket Chat&lt;/h1&gt;</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=s2>        &lt;form action=&quot;&quot; onsubmit=&quot;sendMessage(event)&quot;&gt;</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=s2>            &lt;input type=&quot;text&quot; id=&quot;messageText&quot; autocomplete=&quot;off&quot;/&gt;</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=s2>            &lt;button&gt;Send&lt;/button&gt;</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=s2>        &lt;/form&gt;</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=s2>        &lt;ul id=&#39;messages&#39;&gt;</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=s2>        &lt;/ul&gt;</span>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=s2>        &lt;script&gt;</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=s2>            var ws = new WebSocket(&quot;ws://localhost:8080/ws&quot;);</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=s2>            ws.onmessage = function(event) {</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=s2>                var messages = document.getElementById(&#39;messages&#39;)</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=s2>                var message = document.createElement(&#39;li&#39;)</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=s2>                var content = document.createTextNode(event.data)</span>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=s2>                message.appendChild(content)</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=s2>                messages.appendChild(message)</span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=s2>            };</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=s2>            function sendMessage(event) {</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a><span class=s2>                var input = document.getElementById(&quot;messageText&quot;)</span>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=s2>                ws.send(input.value)</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=s2>                input.value = &#39;&#39;</span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=s2>                event.preventDefault()</span>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=s2>            }</span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=s2>        &lt;/script&gt;</span>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a><span class=s2>    &lt;/body&gt;</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a><span class=s2>&lt;/html&gt;</span>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a><span class=nd>@asynccontextmanager</span>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>run_websocket_server</span><span class=p>(</span><span class=n>app</span><span class=p>):</span>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a>    <span class=k>with</span> <span class=n>IOWebsockets</span><span class=o>.</span><span class=n>run_server_in_thread</span><span class=p>(</span><span class=n>on_connect</span><span class=o>=</span><span class=n>on_connect</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8080</span><span class=p>)</span> <span class=k>as</span> <span class=n>uri</span><span class=p>:</span>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Websocket server started at </span><span class=si>{</span><span class=n>uri</span><span class=si>}</span><span class=s2>.&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a>        <span class=k>yield</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=n>lifespan</span><span class=o>=</span><span class=n>run_websocket_server</span><span class=p>)</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>():</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a>    <span class=k>return</span> <span class=n>HTMLResponse</span><span class=p>(</span><span class=n>html</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>import</span><span class=w> </span><span class=nn>uvicorn</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>config</span> <span class=o>=</span> <span class=n>uvicorn</span><span class=o>.</span><span class=n>Config</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=n>server</span> <span class=o>=</span> <span class=n>uvicorn</span><span class=o>.</span><span class=n>Server</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=k>await</span> <span class=n>server</span><span class=o>.</span><span class=n>serve</span><span class=p>()</span>
</code></pre></div> <p>The testing setup described above, leveraging FastAPI and websockets, not only serves as a robust testing framework for the on_connect function but also lays the groundwork for developing real-world applications. This approach exemplifies how web-based interactions can be made dynamic and real-time, a critical aspect of modern application development.</p> <p>For instance, this setup can be directly applied or adapted to build interactive chat applications, real-time data dashboards, or live support systems. The integration of websockets enables the server to push updates to clients instantly, a key feature for applications that rely on the timely delivery of information. For example, a chat application built on this framework can support instantaneous messaging between users, enhancing user engagement and satisfaction.</p> <p>Moreover, the simplicity and interactivity of the HTML page used for testing reflect how user interfaces can be designed to provide seamless experiences. Developers can expand upon this foundation to incorporate more sophisticated elements such as user authentication, message encryption, and custom user interactions, further tailoring the application to meet specific use case requirements.</p> <p>The flexibility of the FastAPI framework, combined with the real-time communication enabled by websockets, provides a powerful toolset for developers looking to build scalable, efficient, and highly interactive web applications. Whether it’s for creating collaborative platforms, streaming services, or interactive gaming experiences, this testing setup offers a glimpse into the potential applications that can be developed with these technologies.</p> <h2 id=testing-websockets-server-with-htmljs-client>Testing websockets server with HTML/JS client<a class=headerlink href=#testing-websockets-server-with-htmljs-client title="Permanent link">#</a></h2> <p>The provided code snippet below is an example of how to create an interactive testing environment for an <code>on_connect</code> function using Python’s built-in <code>http.server</code> module. This setup allows for real-time interaction within a web browser, enabling developers to test the websocket functionality in a more user-friendly and practical manner. Here’s a breakdown of how this code operates and its potential applications:</p> <ol> <li> <p><strong>Serving a Simple HTML Page</strong>: The code starts by defining an HTML page that includes a form for sending messages and a list to display incoming messages. JavaScript is used to handle the form submission and websocket communication.</p> </li> <li> <p><strong>Temporary Directory for HTML File</strong>: A temporary directory is created to store the HTML file. This approach ensures that the testing environment is clean and isolated, minimizing conflicts with existing files or configurations.</p> </li> <li> <p><strong>Custom HTTP Request Handler</strong>: A custom subclass of <code>SimpleHTTPRequestHandler</code> is defined to serve the HTML file. This handler overrides the do_GET method to redirect the root path (<code>/</code>) to the <code>chat.html</code> page, ensuring that visitors to the server’s root URL are immediately presented with the chat interface.</p> </li> <li> <p><strong>Starting the Websocket Server</strong>: Concurrently, a websocket server is started on a different port using the <code>IOWebsockets.run_server_in_thread</code> method, with the previously defined <code>on_connect</code> function as the callback for new connections.</p> </li> <li> <p><strong>HTTP Server for the HTML Interface</strong>: An HTTP server is instantiated to serve the HTML chat interface, enabling users to interact with the websocket server through a web browser.</p> </li> </ol> <p>This setup showcases a practical application of integrating websockets with a simple HTTP server to create a dynamic and interactive web application. By using Python’s standard library modules, it demonstrates a low-barrier entry to developing real-time applications such as chat systems, live notifications, or interactive dashboards.</p> <p>The key takeaway from this code example is how easily Python’s built-in libraries can be leveraged to prototype and test complex web functionalities. For developers looking to build real-world applications, this approach offers a straightforward method to validate and refine websocket communication logic before integrating it into larger frameworks or systems. The simplicity and accessibility of this testing setup make it an excellent starting point for developing a wide range of interactive web applications.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>http.server</span><span class=w> </span><span class=kn>import</span> <span class=n>HTTPServer</span><span class=p>,</span> <span class=n>SimpleHTTPRequestHandler</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>PORT</span> <span class=o>=</span> <span class=mi>8000</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=c1># Format JSON-based messages for display</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=n>js_formatters</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=s2>function formatMessageContent(content) {</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=s2>    if (content &amp;&amp; typeof content === &#39;object&#39;) {</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=s2>        // Create a copy without uuid</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=s2>        const formatted = </span><span class=si>{}</span><span class=s2>;</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=s2>        for (const [key, value] of Object.entries(content)) {</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=s2>            if (key !== &#39;uuid&#39;) {</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=s2>                formatted[key] = value;</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=s2>            }</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=s2>        }</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=s2>        return JSON.stringify(formatted, null, 2);</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=s2>    }</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=s2>    return String(content);</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=s2>}</span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=s2>function format_message(data) {</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=s2>    try {</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=s2>        let msg = typeof data === &#39;string&#39; ? JSON.parse(data) : data;</span>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=s2>        let formatted = {</span>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=s2>            type: msg.type || &#39;&#39;,</span>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=s2>            content: formatMessageContent(msg.content)</span>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=s2>        };</span>
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=s2>        // Add any additional fields</span>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=s2>        for (const [key, value] of Object.entries(msg)) {</span>
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=s2>            if (key !== &#39;type&#39; &amp;&amp; key !== &#39;content&#39;) {</span>
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=s2>                formatted[key] = value;</span>
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=s2>            }</span>
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=s2>        }</span>
<a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a>
<a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a><span class=s2>        return JSON.stringify(formatted, null, 2);</span>
<a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=s2>    } catch (e) {</span>
<a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a><span class=s2>        return String(data);</span>
<a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=s2>    }</span>
<a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=s2>}</span>
<a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a>
<a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=n>html</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=s2>&lt;!DOCTYPE html&gt;</span>
<a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a><span class=s2>&lt;html&gt;</span>
<a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a><span class=s2>    &lt;head&gt;</span>
<a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a><span class=s2>        &lt;title&gt;AG2 websocket&lt;/title&gt;</span>
<a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a><span class=s2>        &lt;link href=&quot;https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;</span>
<a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a><span class=s2>        &lt;style&gt;</span>
<a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a><span class=s2>            body </span><span class=se>{{</span>
<a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a><span class=s2>                font-family: &#39;JetBrains Mono&#39;, monospace;</span>
<a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a><span class=s2>                max-width: 800px;</span>
<a id=__codelineno-8-53 name=__codelineno-8-53 href=#__codelineno-8-53></a><span class=s2>                margin: 20px auto;</span>
<a id=__codelineno-8-54 name=__codelineno-8-54 href=#__codelineno-8-54></a><span class=s2>                padding: 20px;</span>
<a id=__codelineno-8-55 name=__codelineno-8-55 href=#__codelineno-8-55></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-56 name=__codelineno-8-56 href=#__codelineno-8-56></a><span class=s2>            h1 </span><span class=se>{{</span>
<a id=__codelineno-8-57 name=__codelineno-8-57 href=#__codelineno-8-57></a><span class=s2>                text-align: center;</span>
<a id=__codelineno-8-58 name=__codelineno-8-58 href=#__codelineno-8-58></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-59 name=__codelineno-8-59 href=#__codelineno-8-59></a><span class=s2>            form </span><span class=se>{{</span>
<a id=__codelineno-8-60 name=__codelineno-8-60 href=#__codelineno-8-60></a><span class=s2>                margin: 20px 0;</span>
<a id=__codelineno-8-61 name=__codelineno-8-61 href=#__codelineno-8-61></a><span class=s2>                text-align: center;</span>
<a id=__codelineno-8-62 name=__codelineno-8-62 href=#__codelineno-8-62></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-63 name=__codelineno-8-63 href=#__codelineno-8-63></a><span class=s2>            input </span><span class=se>{{</span>
<a id=__codelineno-8-64 name=__codelineno-8-64 href=#__codelineno-8-64></a><span class=s2>                width: 80%;</span>
<a id=__codelineno-8-65 name=__codelineno-8-65 href=#__codelineno-8-65></a><span class=s2>                padding: 8px;</span>
<a id=__codelineno-8-66 name=__codelineno-8-66 href=#__codelineno-8-66></a><span class=s2>                margin-right: 10px;</span>
<a id=__codelineno-8-67 name=__codelineno-8-67 href=#__codelineno-8-67></a><span class=s2>                font-family: inherit;</span>
<a id=__codelineno-8-68 name=__codelineno-8-68 href=#__codelineno-8-68></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-69 name=__codelineno-8-69 href=#__codelineno-8-69></a><span class=s2>            button </span><span class=se>{{</span>
<a id=__codelineno-8-70 name=__codelineno-8-70 href=#__codelineno-8-70></a><span class=s2>                padding: 8px 20px;</span>
<a id=__codelineno-8-71 name=__codelineno-8-71 href=#__codelineno-8-71></a><span class=s2>                background: #4285f4;</span>
<a id=__codelineno-8-72 name=__codelineno-8-72 href=#__codelineno-8-72></a><span class=s2>                color: white;</span>
<a id=__codelineno-8-73 name=__codelineno-8-73 href=#__codelineno-8-73></a><span class=s2>                border: none;</span>
<a id=__codelineno-8-74 name=__codelineno-8-74 href=#__codelineno-8-74></a><span class=s2>                border-radius: 4px;</span>
<a id=__codelineno-8-75 name=__codelineno-8-75 href=#__codelineno-8-75></a><span class=s2>                cursor: pointer;</span>
<a id=__codelineno-8-76 name=__codelineno-8-76 href=#__codelineno-8-76></a><span class=s2>                font-family: inherit;</span>
<a id=__codelineno-8-77 name=__codelineno-8-77 href=#__codelineno-8-77></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-78 name=__codelineno-8-78 href=#__codelineno-8-78></a><span class=s2>            #messages </span><span class=se>{{</span>
<a id=__codelineno-8-79 name=__codelineno-8-79 href=#__codelineno-8-79></a><span class=s2>                list-style: none;</span>
<a id=__codelineno-8-80 name=__codelineno-8-80 href=#__codelineno-8-80></a><span class=s2>                padding: 0;</span>
<a id=__codelineno-8-81 name=__codelineno-8-81 href=#__codelineno-8-81></a><span class=s2>                margin: 0;</span>
<a id=__codelineno-8-82 name=__codelineno-8-82 href=#__codelineno-8-82></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-83 name=__codelineno-8-83 href=#__codelineno-8-83></a><span class=s2>            #messages li </span><span class=se>{{</span>
<a id=__codelineno-8-84 name=__codelineno-8-84 href=#__codelineno-8-84></a><span class=s2>                padding: 8px;</span>
<a id=__codelineno-8-85 name=__codelineno-8-85 href=#__codelineno-8-85></a><span class=s2>                margin: 4px 0;</span>
<a id=__codelineno-8-86 name=__codelineno-8-86 href=#__codelineno-8-86></a><span class=s2>                background: #f1f3f4;</span>
<a id=__codelineno-8-87 name=__codelineno-8-87 href=#__codelineno-8-87></a><span class=s2>                border-radius: 4px;</span>
<a id=__codelineno-8-88 name=__codelineno-8-88 href=#__codelineno-8-88></a><span class=s2>                white-space: pre-wrap;</span>
<a id=__codelineno-8-89 name=__codelineno-8-89 href=#__codelineno-8-89></a><span class=s2>                word-wrap: break-word;</span>
<a id=__codelineno-8-90 name=__codelineno-8-90 href=#__codelineno-8-90></a><span class=s2>                font-family: monospace;</span>
<a id=__codelineno-8-91 name=__codelineno-8-91 href=#__codelineno-8-91></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-92 name=__codelineno-8-92 href=#__codelineno-8-92></a><span class=s2>        &lt;/style&gt;</span>
<a id=__codelineno-8-93 name=__codelineno-8-93 href=#__codelineno-8-93></a><span class=s2>    &lt;/head&gt;</span>
<a id=__codelineno-8-94 name=__codelineno-8-94 href=#__codelineno-8-94></a><span class=s2>    &lt;body&gt;</span>
<a id=__codelineno-8-95 name=__codelineno-8-95 href=#__codelineno-8-95></a><span class=s2>        &lt;h1&gt;AG2 Structured Messages w/ websockets&lt;/h1&gt;</span>
<a id=__codelineno-8-96 name=__codelineno-8-96 href=#__codelineno-8-96></a><span class=s2>        &lt;form action=&quot;&quot; onsubmit=&quot;sendMessage(event)&quot;&gt;</span>
<a id=__codelineno-8-97 name=__codelineno-8-97 href=#__codelineno-8-97></a><span class=s2>            &lt;input type=&quot;text&quot; id=&quot;messageText&quot; autocomplete=&quot;off&quot;/&gt;</span>
<a id=__codelineno-8-98 name=__codelineno-8-98 href=#__codelineno-8-98></a><span class=s2>            &lt;button&gt;Send&lt;/button&gt;</span>
<a id=__codelineno-8-99 name=__codelineno-8-99 href=#__codelineno-8-99></a><span class=s2>        &lt;/form&gt;</span>
<a id=__codelineno-8-100 name=__codelineno-8-100 href=#__codelineno-8-100></a><span class=s2>        &lt;ul id=&#39;messages&#39;&gt;</span>
<a id=__codelineno-8-101 name=__codelineno-8-101 href=#__codelineno-8-101></a><span class=s2>        &lt;/ul&gt;</span>
<a id=__codelineno-8-102 name=__codelineno-8-102 href=#__codelineno-8-102></a><span class=s2>        &lt;script&gt;</span>
<a id=__codelineno-8-103 name=__codelineno-8-103 href=#__codelineno-8-103></a><span class=s2>            </span><span class=si>{</span><span class=n>js_formatters</span><span class=si>}</span>
<a id=__codelineno-8-104 name=__codelineno-8-104 href=#__codelineno-8-104></a>
<a id=__codelineno-8-105 name=__codelineno-8-105 href=#__codelineno-8-105></a><span class=s2>            var ws = new WebSocket(&quot;ws://localhost:8082&quot;);</span>
<a id=__codelineno-8-106 name=__codelineno-8-106 href=#__codelineno-8-106></a><span class=s2>            ws.onmessage = function(event) </span><span class=se>{{</span>
<a id=__codelineno-8-107 name=__codelineno-8-107 href=#__codelineno-8-107></a><span class=s2>                var messages = document.getElementById(&#39;messages&#39;)</span>
<a id=__codelineno-8-108 name=__codelineno-8-108 href=#__codelineno-8-108></a><span class=s2>                var message = document.createElement(&#39;li&#39;)</span>
<a id=__codelineno-8-109 name=__codelineno-8-109 href=#__codelineno-8-109></a><span class=s2>                var formattedContent = format_message(event.data)</span>
<a id=__codelineno-8-110 name=__codelineno-8-110 href=#__codelineno-8-110></a><span class=s2>                var content = document.createTextNode(formattedContent)</span>
<a id=__codelineno-8-111 name=__codelineno-8-111 href=#__codelineno-8-111></a><span class=s2>                message.appendChild(content)</span>
<a id=__codelineno-8-112 name=__codelineno-8-112 href=#__codelineno-8-112></a><span class=s2>                messages.appendChild(message)</span>
<a id=__codelineno-8-113 name=__codelineno-8-113 href=#__codelineno-8-113></a><span class=s2>            </span><span class=se>}}</span><span class=s2>;</span>
<a id=__codelineno-8-114 name=__codelineno-8-114 href=#__codelineno-8-114></a>
<a id=__codelineno-8-115 name=__codelineno-8-115 href=#__codelineno-8-115></a><span class=s2>            function sendMessage(event) </span><span class=se>{{</span>
<a id=__codelineno-8-116 name=__codelineno-8-116 href=#__codelineno-8-116></a><span class=s2>                var input = document.getElementById(&quot;messageText&quot;)</span>
<a id=__codelineno-8-117 name=__codelineno-8-117 href=#__codelineno-8-117></a><span class=s2>                ws.send(input.value)</span>
<a id=__codelineno-8-118 name=__codelineno-8-118 href=#__codelineno-8-118></a><span class=s2>                input.value = &#39;&#39;</span>
<a id=__codelineno-8-119 name=__codelineno-8-119 href=#__codelineno-8-119></a><span class=s2>                event.preventDefault()</span>
<a id=__codelineno-8-120 name=__codelineno-8-120 href=#__codelineno-8-120></a><span class=s2>            </span><span class=se>}}</span>
<a id=__codelineno-8-121 name=__codelineno-8-121 href=#__codelineno-8-121></a><span class=s2>        &lt;/script&gt;</span>
<a id=__codelineno-8-122 name=__codelineno-8-122 href=#__codelineno-8-122></a><span class=s2>    &lt;/body&gt;</span>
<a id=__codelineno-8-123 name=__codelineno-8-123 href=#__codelineno-8-123></a><span class=s2>&lt;/html&gt;</span>
<a id=__codelineno-8-124 name=__codelineno-8-124 href=#__codelineno-8-124></a><span class=s2>&quot;&quot;&quot;</span>
<a id=__codelineno-8-125 name=__codelineno-8-125 href=#__codelineno-8-125></a>
<a id=__codelineno-8-126 name=__codelineno-8-126 href=#__codelineno-8-126></a><span class=c1># The rest of the server setup code remains the same</span>
<a id=__codelineno-8-127 name=__codelineno-8-127 href=#__codelineno-8-127></a><span class=k>with</span> <span class=n>TemporaryDirectory</span><span class=p>()</span> <span class=k>as</span> <span class=n>temp_dir</span><span class=p>:</span>
<a id=__codelineno-8-128 name=__codelineno-8-128 href=#__codelineno-8-128></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>temp_dir</span><span class=p>)</span> <span class=o>/</span> <span class=s2>&quot;chat.html&quot;</span>
<a id=__codelineno-8-129 name=__codelineno-8-129 href=#__codelineno-8-129></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
<a id=__codelineno-8-130 name=__codelineno-8-130 href=#__codelineno-8-130></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>html</span><span class=p>)</span>
<a id=__codelineno-8-131 name=__codelineno-8-131 href=#__codelineno-8-131></a>
<a id=__codelineno-8-132 name=__codelineno-8-132 href=#__codelineno-8-132></a>    <span class=k>class</span><span class=w> </span><span class=nc>MyRequestHandler</span><span class=p>(</span><span class=n>SimpleHTTPRequestHandler</span><span class=p>):</span>
<a id=__codelineno-8-133 name=__codelineno-8-133 href=#__codelineno-8-133></a>        <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a id=__codelineno-8-134 name=__codelineno-8-134 href=#__codelineno-8-134></a>            <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=n>directory</span><span class=o>=</span><span class=n>temp_dir</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a id=__codelineno-8-135 name=__codelineno-8-135 href=#__codelineno-8-135></a>
<a id=__codelineno-8-136 name=__codelineno-8-136 href=#__codelineno-8-136></a>        <span class=k>def</span><span class=w> </span><span class=nf>do_GET</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: N802</span>
<a id=__codelineno-8-137 name=__codelineno-8-137 href=#__codelineno-8-137></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span> <span class=o>==</span> <span class=s2>&quot;/&quot;</span><span class=p>:</span>
<a id=__codelineno-8-138 name=__codelineno-8-138 href=#__codelineno-8-138></a>                <span class=bp>self</span><span class=o>.</span><span class=n>path</span> <span class=o>=</span> <span class=s2>&quot;/chat.html&quot;</span>
<a id=__codelineno-8-139 name=__codelineno-8-139 href=#__codelineno-8-139></a>            <span class=k>return</span> <span class=n>SimpleHTTPRequestHandler</span><span class=o>.</span><span class=n>do_GET</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a id=__codelineno-8-140 name=__codelineno-8-140 href=#__codelineno-8-140></a>
<a id=__codelineno-8-141 name=__codelineno-8-141 href=#__codelineno-8-141></a>    <span class=n>handler</span> <span class=o>=</span> <span class=n>MyRequestHandler</span>
<a id=__codelineno-8-142 name=__codelineno-8-142 href=#__codelineno-8-142></a>
<a id=__codelineno-8-143 name=__codelineno-8-143 href=#__codelineno-8-143></a>    <span class=k>with</span> <span class=n>IOWebsockets</span><span class=o>.</span><span class=n>run_server_in_thread</span><span class=p>(</span><span class=n>on_connect</span><span class=o>=</span><span class=n>on_connect</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8082</span><span class=p>)</span> <span class=k>as</span> <span class=n>uri</span><span class=p>:</span>
<a id=__codelineno-8-144 name=__codelineno-8-144 href=#__codelineno-8-144></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Websocket server started at </span><span class=si>{</span><span class=n>uri</span><span class=si>}</span><span class=s2>.&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-8-145 name=__codelineno-8-145 href=#__codelineno-8-145></a>
<a id=__codelineno-8-146 name=__codelineno-8-146 href=#__codelineno-8-146></a>        <span class=k>with</span> <span class=n>HTTPServer</span><span class=p>((</span><span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>PORT</span><span class=p>),</span> <span class=n>handler</span><span class=p>)</span> <span class=k>as</span> <span class=n>httpd</span><span class=p>:</span>
<a id=__codelineno-8-147 name=__codelineno-8-147 href=#__codelineno-8-147></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;HTTP server started at http://localhost:&quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>PORT</span><span class=p>))</span>
<a id=__codelineno-8-148 name=__codelineno-8-148 href=#__codelineno-8-148></a>            <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-8-149 name=__codelineno-8-149 href=#__codelineno-8-149></a>                <span class=n>httpd</span><span class=o>.</span><span class=n>serve_forever</span><span class=p>()</span>
<a id=__codelineno-8-150 name=__codelineno-8-150 href=#__codelineno-8-150></a>            <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
<a id=__codelineno-8-151 name=__codelineno-8-151 href=#__codelineno-8-151></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot; - HTTP server stopped.&quot;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-05-08T13:42:12+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-05-08</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../../../js/timeago.min.js></script> <script src=../../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>